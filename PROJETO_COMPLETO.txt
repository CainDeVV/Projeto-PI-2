
==================================================
CAMINHO: .\cadastro_equipamento.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Equipamento</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/pages/forms.css">
</head>
<body>

    <header id="app-header"></header>
    
    <aside id="app-sidebar">
        <div class="sidebar-title">Menu</div>
        <div id="tree-menu-container"></div>
    </aside>

    <main id="app-main" class="main-registration">
        <div class="form-container animate-fade">
            
            <div class="form-header-title">
                <h2>Cadastro de Equipamento</h2>
            </div>

            <div class="type-selector">
                <label>Tipo de Equipamento</label>
                <div class="custom-select-wrapper">
                    <select id="equip-type-select" class="custom-select">
                        <option value="computador">Computador</option>
                        <option value="impressora">Impressora</option>
                    </select>
                    <i class="fas fa-chevron-down select-icon"></i>
                </div>
            </div>

            <form id="cadastro-form">
                <div id="dynamic-fields">
                    </div>

                <div class="form-actions">
                    <button type="submit" class="btn-submit">
                        CADASTRAR <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </form>

        </div>
    </main>
    
    <script type="module" src="js/pages/cadastro_equipamento.js"></script>
</body>
</html>
==================================================
CAMINHO: .\cadastro_os.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de O.S.</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/pages/forms.css">
</head>
<body>
    <header id="app-header"></header>
    <aside id="app-sidebar"><div id="tree-menu-container"></div></aside>

    <main id="app-main" class="main-registration">
        <div class="form-container animate-fade">
            <div class="form-header-title">
                <h2>Nova Ordem de Serviço</h2>
            </div>

            <form id="cadastro-os-form">
                
                <div class="form-group">
                    <label>Equipamento</label>
                    <div class="custom-select-wrapper">
                        <select id="equipamento" name="equipamentoId" class="custom-select" required>
                            <option value="" disabled selected>Carregando...</option>
                        </select>
                        <i class="fas fa-chevron-down select-icon"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label>Setor</label>
                    <div class="custom-select-wrapper">
                        <select id="setor" name="setor" class="custom-select" required>
                            <option value="" disabled selected>Carregando...</option>
                        </select>
                        <i class="fas fa-chevron-down select-icon"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label>Descrição do Problema</label>
                    <textarea id="descricao" name="descricao" class="custom-input" rows="5" placeholder="Descreva detalhadamente o defeito..." required style="height: auto; resize: vertical;"></textarea>
                </div>

                <div class="form-group">
                    <label>Solicitante (Quem pediu)</label>
                    <div class="custom-select-wrapper">
                        <select id="solicitante" name="solicitante" class="custom-select" required>
                            <option value="" disabled selected>Carregando...</option>
                        </select>
                        <i class="fas fa-chevron-down select-icon"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label>Técnico Responsável (Opcional)</label>
                    <div class="custom-select-wrapper">
                        <select id="tecnico" name="tecnico" class="custom-select">
                            <option value="">-- Aguardando Técnico --</option>
                        </select>
                        <i class="fas fa-chevron-down select-icon"></i>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-submit">
                        ABRIR CHAMADO <i class="fas fa-check"></i>
                    </button>
                </div>
            </form>
        </div>
    </main>
    
    <script type="module" src="js/pages/cadastro_os.js"></script>
</body>
</html>
==================================================
CAMINHO: .\cadastro_setor.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Setor</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/pages/forms.css">
    <link rel="stylesheet" href="css/pages/setores.css">
</head>
<body>

    <header id="app-header"></header>
    <aside id="app-sidebar"></aside>

    <main id="app-main" class="main-registration">
        <div class="form-container animate-fade">
            <div class="form-header-title">
                <h2>Cadastro de Setor</h2>
            </div>

            <form id="sector-form">
                
                <div class="form-group">
                    <label>Cidade *</label>
                    <div class="input-with-action">
                        <select id="city-select" class="custom-select" required>
                            <option value="">Selecione uma cidade...</option>
                        </select>
                        <button type="button" id="btn-add-city" class="btn-icon-action" title="Nova Cidade">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Empresa *</label>
                    <div class="input-with-action">
                        <select id="company-select" class="custom-select" disabled required>
                            <option value="">Selecione a cidade primeiro...</option>
                        </select>
                        <button type="button" id="btn-add-company" class="btn-icon-action" title="Nova Empresa" disabled>
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>

                <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

                <div class="form-group">
                    <label>Nome do Setor *</label>
                    <input type="text" id="nome" placeholder="Ex: Financeiro, TI, RH" required>
                </div>

                <div class="form-group">
                    <label>Endereço / Localização *</label>
                    <input type="text" id="localizacao" placeholder="Ex: Bloco A, Sala 104" required>
                </div>

                <div class="form-group">
                    <label>Observação do Setor</label>
                    <textarea id="observacao" placeholder="Detalhes adicionais..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="history.back()">Cancelar</button>
                    <button type="submit" class="btn-save">Salvar Setor</button>
                </div>
            </form>
        </div>
    </main>

    <div id="modal-city" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3><i class="fas fa-map-marker-alt"></i> Nova Cidade</h3>
                <button type="button" class="modal-close" data-close="modal-city">&times;</button>
            </div>
            <form id="form-city-modal">
                <div class="form-row three-col" style="padding: 20px;">
                    <div>
                        <label>Nome da Cidade *</label>
                        <input type="text" id="modal-city-name" required placeholder="Ex: Crateús">
                    </div>
                    <div>
                        <label>UF *</label>
                        <input type="text" id="modal-city-uf" required maxlength="2" style="text-transform: uppercase;" placeholder="CE">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-cancel" data-close="modal-city">Cancelar</button>
                    <button type="submit" class="btn-save">Salvar Cidade</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-company" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3><i class="fas fa-building"></i> Nova Empresa</h3>
                <button type="button" class="modal-close" data-close="modal-company">&times;</button>
            </div>
            <form id="form-company-modal">
                <div style="padding: 20px;">
                    <div class="form-group">
                        <label>Cidade Vinculada</label>
                        <input type="text" id="modal-company-city-readonly" disabled style="background-color: #eee;">
                    </div>
                    <div class="form-row">
                        <div>
                            <label>Nome Fantasia *</label>
                            <input type="text" id="modal-company-name" required>
                        </div>
                        <div>
                            <label>CNPJ *</label>
                            <input type="text" id="modal-company-cnpj" required placeholder="00.000.000/0000-00">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Descrição</label>
                        <input type="text" id="modal-company-desc">
                    </div>
                    <div class="form-group">
                        <label>Observação</label>
                        <textarea id="modal-company-obs" rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-cancel" data-close="modal-company">Cancelar</button>
                    <button type="submit" class="btn-save">Salvar Empresa</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module" src="js/pages/cadastro_setor.js"></script>
</body>
</html>
==================================================
CAMINHO: .\cadastro_usuario.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Usuário</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="css/main.css">

    <link rel="stylesheet" href="css/pages/forms.css">
</head>
<body>

    <header id="app-header"></header>
    
    <aside id="app-sidebar">
        <div class="sidebar-title">Menu</div>
        <div id="tree-menu-container"></div>
    </aside>
    
    <main id="app-main" class="main-registration">
        <div class="form-container animate-fade">
            
            <div class="form-header-title">
                <h2>Cadastro de Usuário</h2>
            </div>

            <form id="cadastro-usuario-form">
                <div class="form-group">
                    <label>CPF</label>
                    <input type="text" id="cpf" name="cpf" class="custom-input" placeholder="000.000.000-00" data-mask="cpf" maxlength="14" required>
                    <span id="erro-cpf" style="color: var(--status-error); font-size: 12px; display: block; margin-top: 5px;"></span>
                </div>

                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" id="nome" name="nome" class="custom-input" placeholder="Digite o nome completo" required>
                </div>

                <div class="form-group">
                    <label>Senha</label>
                    <div style="position: relative;">
                        <input type="password" id="senha" name="senha" class="custom-input" placeholder="Mínimo 5 caracteres" required>
                        <i class="fas fa-eye select-icon" id="togglePassword" style="cursor: pointer; pointer-events: auto;"></i>
                    </div>
                    <span id="erro-senha" style="color: var(--status-error); font-size: 12px; display: block; margin-top: 5px;"></span>
                </div>

                <div class="form-group">
                    <label>Setor</label>
                    <div class="custom-select-wrapper">
                        <select id="setor" name="setor" class="custom-select" required>
                            <option value="" selected disabled>Carregando...</option>
                        </select>
                        <i class="fas fa-chevron-down select-icon"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label>Tipo de Acesso</label>
                    <div class="custom-select-wrapper">
                        <select id="tipo" name="tipo" class="custom-select" required>
                            <option value="" selected disabled>Selecione o tipo</option>
                            <option value="Admin">Administrador</option>
                            <option value="Técnico">Técnico</option>
                            <option value="Comum">Usuário Comum</option>
                        </select>
                        <i class="fas fa-chevron-down select-icon"></i>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-submit">
                        CADASTRAR <i class="fas fa-check"></i>
                    </button>
                </div>

            </form>

        </div>
    </main>
    
    <script type="module" src="js/pages/cadastro_usuario.js"></script>
</body>
</html>
==================================================
CAMINHO: .\dashboard.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Visão Geral</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/pages/dashboard.css">
</head>
<body>

    <header id="app-header"></header>
    
    <aside id="app-sidebar">
        <div id="tree-menu-container"></div>
    </aside>

    <main id="app-main">
        <section class="kpi-grid animate-fade">
            <div class="card kpi-card">
                <div class="kpi-icon"><i class="fas fa-desktop"></i></div>
                <div class="kpi-info">
                    <h3>Total PCs</h3>
                    <span id="total-pcs">...</span>
                </div>
            </div>
            <div class="card kpi-card">
                <div class="kpi-icon"><i class="fas fa-print"></i></div>
                <div class="kpi-info">
                    <h3>Total Impressoras</h3>
                    <span id="total-printers">...</span>
                </div>
            </div>
            <div class="card kpi-card">
                <div class="kpi-icon icon-error"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="kpi-info">
                    <h3>Erros Ativos</h3>
                    <span id="total-errors">...</span>
                </div>
            </div>
        </section>

        <section class="details-grid animate-fade" style="animation-delay: 0.1s;">
            
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-print"></i>
                    <h2>Mais Impressos</h2>
                </div>
                <div id="printer-list" class="list-container">Carregando...</div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-chart-bar"></i> <h2>Equipamentos por Cidade</h2>
                </div>
                <table class="city-table">
                    <thead>
                        <tr>
                            <th>Cidade</th>
                            <th class="text-center">PCs</th>
                            <th class="text-center">Imp.</th>
                        </tr>
                    </thead>
                    <tbody id="city-list">
                        <tr><td colspan="3">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-exclamation-circle"></i>
                    <h2>Erros Recentes</h2>
                </div>
                <div id="error-list" class="list-container">Carregando...</div>
            </div>

        </section>
    </main>

    <script type="module" src="js/pages/dashboard.js"></script>
</body>
</html>
==================================================
CAMINHO: .\equipamento.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Equipamentos</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components/tabs.css">
    <link rel="stylesheet" href="css/pages/equipamento.css">
    
</head>
<body>
    <header id="app-header"></header>
    <aside id="app-sidebar">
        <div class="sidebar-title">Menu</div>
        <div id="tree-menu-container"></div>
    </aside>
    <main id="app-main" class="main-transparent">
        <div class="split-container">
            <div class="top-list-section">
                <div class="table-header equip-grid">
                    <div class="th-col"></div> <div class="th-col">#</div>
                    <div class="th-col">Nº Série</div>
                    <div class="th-col">Modelo</div>
                    <div class="th-col">Sala</div>
                    <div class="th-col">Usuário</div>
                    <div class="th-col">Status</div>
                    <div class="th-col">Setor</div>
                    <div class="th-col">Contador</div>
                    <div class="th-col">Tonel</div>
                    <div class="th-col">Error</div>
                </div>
                <div class="table-content">
                    <div id="empty-state">Carregando...</div>
                    <div id="equipment-list" class="hidden"></div>
                </div>
            </div>
            <div class="bottom-panel-section">
                <div class="tabs-header">
                    <button class="tab-btn active" id="tab-impressoras" onclick="handleTabClick('impressoras')">Impressoras</button>
                    <button class="tab-btn" id="tab-erros" onclick="handleTabClick('erros')">Erros</button>
                    <button class="tab-btn" id="tab-opcoes" onclick="handleTabClick('opcoes')">Opções</button>
                </div>
                <div class="tab-content-area" id="tab-content-area"></div>
            </div>
        </div>
    </main>
    <script type="module" src="js/pages/equipamento.js"></script>
</body>
</html>
==================================================
CAMINHO: .\index.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components/inputs.css">
    <link rel="stylesheet" href="css/pages/login.css">
    <link rel="stylesheet" href="css/components/toast.css">
</head>
<body>
    <div class="container-login">
        <div class="caixa-esquerda"></div>
        <div class="caixa-direita">
            <div class="top-buttons">Login</div>
            <form id="loginForm">
                <div class="group-imput">
                    <label>CPF</label>
                    <div class="campo-cpf">
                        <input type="text" id="cpf" placeholder="Digite o seu CPF" maxlength="14" data-mask="cpf">
                        <span id="cpfErro" class="erro-msg"></span>
                    </div>
                </div>
                <div class="group-imput">
                    <label>Senha</label>
                    <div class="caixa-de-senha">
                        <input type="password" id="password" placeholder="Digite a sua senha">
                        <i class="fas fa-eye icone-do-olho" id="togglePassword"></i>
                    </div>
                </div>
                <div class="opcoes">
                    <label class="lembrar-se"><input type="checkbox"> Lembrar-se</label>
                    <a href="#" class="esquecida">Esqueceu a senha?</a>
                </div>
                <button type="submit" class="botão-de-login">Fazer Login</button>
            </form>
        </div>
    </div>
    <script type="module" src="js/pages/login.js"></script>
</body>
</html>
==================================================
CAMINHO: .\log.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log do Sistema</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/pages/log.css">
</head>
<body>

    <header id="app-header"></header>
    
    <aside id="app-sidebar" class="sidebar">
        <div class="sidebar-title">Menu</div>
        <div id="tree-menu-container"></div>
    </aside>

    <main id="app-main">
        
        <div class="table-header log-grid">
            <div class="th-col">Data/Hora</div>
            <div class="th-col">Usuário</div>
            <div class="th-col">Ação</div>
            <div class="th-col">Recurso</div>
            <div class="th-col">Detalhes</div>
        </div>

        <div class="table-content">
            <div id="empty-state">Carregando...</div>
            <div id="log-list" class="hidden"></div>
        </div>
    </main>
    
    <script type="module" src="js/pages/log.js"></script>
</body>
</html>
==================================================
CAMINHO: .\monitoramento.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoramento de Erros</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/pages/monitoramento.css">
</head>
<body>

    <header id="app-header"></header>
    
    <aside id="app-sidebar" class="sidebar">
        <div id="tree-menu-container"></div>
    </aside>

    <main id="app-main">
        <div class="table-header monitor-grid">
            <div class="th-col">Severidade</div>
            <div class="th-col">Data</div>
            <div class="th-col">Equipamento</div>
            <div class="th-col">Sala</div>
            <div class="th-col">Erro</div>
            <div class="th-col">Ação</div>
        </div>

        <div class="table-content">
            <div id="empty-state">Carregando...</div>
            <div id="monitor-list" class="hidden"></div>
        </div>
    </main>
    
    <script type="module" src="js/pages/monitoramento.js"></script>
</body>
</html>
==================================================
CAMINHO: .\os.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordens de Serviço</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/pages/equipamento.css"> <link rel="stylesheet" href="css/pages/os.css">
</head>
<body>

    <header id="app-header"></header>
    
    <aside id="app-sidebar" class="sidebar">
        <div class="sidebar-title">Menu</div>
        <div id="tree-menu-container"></div>
    </aside>

    <main id="app-main" class="main-transparent">
        <div class="split-container">
            <div class="top-list-section">
                <div class="table-header os-grid">
                    <div class="th-col">St</div>
                    <div class="th-col">#</div>
                    <div class="th-col">Equipamento</div>
                    <div class="th-col">Defeito</div>
                    <div class="th-col">Solicitante</div>
                    <div class="th-col">Responsável</div>
                    <div class="th-col">Setor</div>
                    <div class="th-col">Abertura</div>
                    <div class="th-col">Fechamento</div>
                </div>
                <div class="table-content">
                    <div id="empty-state">Carregando...</div>
                    <div id="os-list" class="hidden"></div>
                </div>
            </div>

            <div class="bottom-panel-section">
                <div class="tabs-header" style="background: var(--brand-primary); color: white;">
                    <div style="padding: 10px 20px; font-weight: bold; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-info-circle"></i> Detalhes da O.S.
                    </div>
                </div>
                <div class="tab-content-area centered padded" id="os-detail-content">
                    <div style="color:#888;">Selecione uma O.S. para ver os detalhes.</div>
                </div>
            </div>
        </div>
    </main>
    
    <script type="module" src="js/pages/os.js"></script>
</body>
</html>
==================================================
CAMINHO: .\setores.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setores</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/pages/forms.css">
    <link rel="stylesheet" href="css/pages/setores.css">
</head>
<body>

    <header id="app-header"></header>
    
    <aside id="app-sidebar" class="sidebar">
        <div class="sidebar-title">Menu</div>
        <div id="tree-menu-container"></div>
    </aside>

    <main id="app-main">
        
        <div class="table-header sectors-grid">
            <div class="th-col">Nome do Setor</div>
            <div class="th-col">Empresa</div>
            <div class="th-col">Cidade</div>
            </div>

        <div class="table-content">
            <div id="empty-state">Carregando...</div>
            <div id="sectors-list" class="hidden"></div>
        </div>
    </main>

    <div id="modal-manage-cities" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Gerenciar Cidades</h3>
                <button class="modal-close" data-close="modal-manage-cities">&times;</button>
            </div>
            <div id="list-cities-container" class="modal-list"></div>

            <div id="edit-city-form" class="edit-form-box hidden">
                <h5>Editar Cidade</h5>
                <input type="hidden" id="edit-city-id">
                
                <label>Nome da Cidade</label>
                <input type="text" id="edit-city-name">
                
                <label>UF</label>
                <input type="text" id="edit-city-uf" maxlength="2" style="text-transform: uppercase;">
                
                <div class="edit-actions">
                    <button type="button" id="btn-cancel-city-edit" class="btn-cancel">Cancelar</button>
                    <button type="button" id="btn-save-city-edit" class="btn-save">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-manage-companies" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Gerenciar Empresas</h3>
                <button class="modal-close" data-close="modal-manage-companies">&times;</button>
            </div>
            <div class="modal-list" id="list-companies-container"></div>
            <div id="edit-company-form" class="edit-form-box hidden">
                <h5>Editar Empresa</h5>
                <input type="hidden" id="edit-company-id">
                
                <label>Nome</label>
                <input type="text" id="edit-company-name" placeholder="Nome Fantasia">
                
                <label>CNPJ</label>
                <input type="text" id="edit-company-cnpj" placeholder="CNPJ">
                
                <label>Descrição</label>
                <input type="text" id="edit-company-desc" placeholder="Ex: Matriz, Filial...">
                
                <label>Observação</label>
                <textarea id="edit-company-obs" rows="2" class="custom-input" placeholder="Detalhes adicionais"></textarea>
                
                <div class="edit-actions">
                    <button type="button" id="btn-cancel-company-edit" class="btn-cancel">Cancelar</button>
                    <button type="button" id="btn-save-company-edit" class="btn-save">Salvar</button>
                </div>
            </div>
        </div>
    </div>
    
    <script type="module" src="js/pages/setores.js"></script>
</body>
</html>
==================================================
CAMINHO: .\user_panel.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histórico - Meus Chamados</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    
    <link rel="stylesheet" href="css/pages/equipamento.css"> 
    
    <link rel="stylesheet" href="css/pages/os.css"> 
</head>
<body>
    <header id="app-header"></header>
    
    <main id="app-main" class="main-transparent">
        <div class="split-container">
            <div class="top-list-section">
                <div class="table-header os-grid">
                    <div class="th-col">St</div>
                    <div class="th-col">#</div>
                    <div class="th-col">Equipamento</div>
                    <div class="th-col">Defeito</div>
                    <div class="th-col">Responsável</div>
                    <div class="th-col">Abertura</div>
                    <div class="th-col">Fechamento</div>
                </div>
                <div class="table-content">
                    <div id="empty-state">Carregando...</div>
                    <div id="os-list" class="hidden"></div>
                </div>
            </div>

            <div class="bottom-panel-section">
                <div class="tabs-header" style="background: var(--brand-primary); color: white;">
                    <div style="padding: 10px 20px; font-weight: bold; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-info-circle"></i> Detalhes da Solicitação
                    </div>
                </div>
                <div class="tab-content-area centered padded" id="os-detail-content">
                    <div style="color:#888;">Selecione um chamado para ver o andamento.</div>
                </div>
            </div>
        </div>
    </main>
    
    <script type="module" src="js/pages/user_panel.js"></script>
</body>
</html>
==================================================
CAMINHO: .\usuarios.html
==================================================
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Usuários</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <header id="app-header"></header>
    <aside id="app-sidebar">
        <div class="sidebar-title">Menu</div>
        <div id="tree-menu-container"></div>
    </aside>
    <main id="app-main">
        <div class="table-header users-grid">
            <div class="th-col">#</div>
            <div class="th-col">Nome</div>
            <div class="th-col">CPF</div>
            <div class="th-col">Tipo</div>
            <div class="th-col">Setor</div>
        </div>
        <div class="table-content">
            <div id="empty-state">Carregando...</div>
            <div id="users-list" class="hidden"></div>
        </div>
    </main>
    <script type="module" src="js/pages/usuarios.js"></script>
</body>
</html>
==================================================
CAMINHO: .\css\animations.css
==================================================
.animate-fade { animation: fadeIn 0.3s ease-out forwards; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
==================================================
CAMINHO: .\css\base.css
==================================================
/* css/base.css */

* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
ul { list-style-type: none; }
a { text-decoration: none; }

/* CORREÇÃO: Usando a variável em vez do hardcoded #f4f4f4 */
body { 
    background-color: var(--bg-body); 
    width: 100vw; 
    height: 100vh; 
    overflow: hidden; 
    position: relative; 
}

:root {
    /* Cores da Marca */
    --brand-primary: #92D6D6; 
    --brand-active: #49BBBD; 
    --brand-secondary: #7DD0D0;
    --brand-hover-dark: #3AA3A5; 
    --brand-hover-light: #EAFFFF;

    /* Fundos */
    --bg-body: #F4F4F4;
    --bg-surface: #FFFFFF;      /* Substitui 'white' em cards/inputs */
    --bg-header-gray: #E0E0E0;
    --bg-input: #FFFFFF;
    --bg-disabled: #CCCCCC;
    --bg-row-hover: #FAFAFA;
    --bg-overlay: rgba(0, 0, 0, 0.5); /* Para o backdrop mobile */

    /* Texto */
    --text-primary: #333333;
    --text-secondary: #555555;
    --text-muted: #666666;
    --text-inverse: #FFFFFF;    /* Substitui 'white' em textos sobre cor */
    --text-disabled: #888888;

    /* Bordas e Elementos de UI */
    --border-light: #F0F0F0;
    --border-medium: #DDDDDD;   /* Substitui #ddd */
    --border-input: #CCCCCC;
    
    /* Scrollbar (Novas Variáveis) */
    --scrollbar-thumb: #CCCCCC;
    --scrollbar-hover: #BBBBBB;

    /* Status */
    --status-success: #008000;
    --status-error: #FF0000;
    --status-warning: #FFA500;  /* Adicionado para Badges de Update */
    
    /* Layout & Sombras */
    --shadow-soft: 0 2px 5px rgba(0,0,0,0.03);
    --header-height: 70px; 
    --sidebar-width: 200px; 
    --gap-side: 20px; 
    --gap-top: 10px;  
}

/* Scrollbar Personalizada */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

/* CORREÇÃO: Usando variáveis */
::-webkit-scrollbar-thumb {
    background-color: var(--scrollbar-thumb);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background-color: var(--scrollbar-hover);
}

.hidden { display: none !important; }
==================================================
CAMINHO: .\css\main.css
==================================================
/* css/main.css - O Gerente de Estilos */

/* 1. Base do Sistema */
@import url('base.css');
@import url('animations.css');

/* 2. Variáveis (Se tivéssemos mantido separado, seria aqui) */
/* (Como suas variáveis estão no base.css, ok) */

/* 3. Componentes Globais (Usados em quase todas as telas) */
@import url('components/layout.css');
@import url('components/header.css');
@import url('components/sidebar.css');
@import url('components/buttons.css');
@import url('components/inputs.css');
@import url('components/toast.css');
@import url('components/modal.css');

/* Nota: Tabelas e Abas não são globais (Login não usa), 
   mas para simplificar, podemos colocar aqui ou deixar no HTML específico.
   Vamos colocar Tabelas aqui pois quase tudo usa. */
@import url('components/tables.css');
==================================================
CAMINHO: .\css\components\buttons.css
==================================================
.btn-action { width: 40px; height: 40px; border: 1px solid var(--text-secondary); background: transparent; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; color: var(--text-primary); transition: transform 0.1s; }
.btn-action:hover { background-color: rgba(255,255,255,0.4); border-color: var(--text-primary); transform: scale(1.05); }

.options-stack { display: flex; flex-direction: column; gap: 15px; width: 300px; }
.option-btn { width: 100%; padding: 15px 0; background-color: var(--brand-secondary); color: var(--text-inverse); border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; box-shadow: var(--shadow-soft); display: flex; align-items: center; justify-content: center; gap: 10px; transition: transform 0.1s; }
.option-btn:hover { background-color: var(--brand-active); transform: translateY(-2px); }
==================================================
CAMINHO: .\css\components\header.css
==================================================
.btn-mobile-toggle { display: none; font-size: 20px; color: var(--text-inverse); background: transparent; border: none; cursor: pointer; margin-right: 15px; }
.logo-circle { width: 45px; height: 45px; background: var(--bg-header-gray); border-radius: 50%; border: 2px solid var(--bg-surface); cursor: pointer; transition: transform 0.2s; flex-shrink: 0; }
.logo-circle:hover { transform: scale(1.05); border-color: var(--brand-active); }
.nav-menu { display: flex; gap: 15px; }
.nav-item { color: var(--text-inverse); font-weight: 500; padding: 8px 20px; border-radius: 20px; cursor: pointer; transition: background 0.3s; }
.nav-item:hover { background-color: rgba(255, 255, 255, 0.25); }
.nav-item.active { background-color: var(--brand-active); font-weight: bold; }

@media (max-width: 768px) {
    .btn-mobile-toggle { display: block; }
    .nav-menu { display: none; } /* Esconde menu texto no mobile */
    .search-container:not([style*="display: block"]) { display: none; }
}
==================================================
CAMINHO: .\css\components\inputs.css
==================================================
.search-container { display: none; flex: 1; max-width: 600px; position: relative; margin-left: 20px; animation: fadeIn 0.3s ease; }
#search-input { width: 100%; height: 40px; border-radius: 20px; border: none; padding: 0 40px 0 20px; font-size: 16px; outline: none; }
.search-close-btn { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--text-disabled); }
body.search-mode .nav-menu { display: none; }
body.search-mode .search-container { display: block; }

.custom-input, .custom-select { width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border-medium); background-color: var(--bg-input); font-size: 15px; color: var(--text-primary); transition: all 0.2s; }
.custom-input:focus, .custom-select:focus { background-color: var(--bg-surface); border-color: var(--brand-active); outline: none; box-shadow: 0 0 0 3px var(--brand-hover-light); }
==================================================
CAMINHO: .\css\components\layout.css
==================================================
/* HEADER */
#app-header {
    position: fixed; top: 0; left: 0; right: 0; height: var(--header-height);
    background-color: var(--brand-primary); display: flex; align-items: center; justify-content: space-between;
    padding: 0 25px; box-shadow: var(--shadow-soft); z-index: 10;
}
.header-left { display: flex; align-items: center; gap: 30px; flex: 1; }
.header-right { display: flex; gap: 10px; }

/* SIDEBAR */
#app-sidebar {
    position: fixed; left: 0; bottom: 0; width: var(--sidebar-width);
    top: calc(var(--header-height) + var(--gap-top)); 
    background-color: var(--bg-surface); display: flex; flex-direction: column;
    border-top-right-radius: 10px; box-shadow: var(--shadow-soft);
    transition: left 0.3s ease; z-index: 1000;
}

/* MAIN WRAPPER GENÉRICO */
#app-main {
    position: fixed; bottom: 0; top: calc(var(--header-height) + var(--gap-top));
    left: calc(var(--sidebar-width) + var(--gap-side)); right: var(--gap-side);
    background-color: var(--bg-surface); display: flex; flex-direction: column;
    border-top-left-radius: 10px; border-top-right-radius: 10px;
    box-shadow: -2px 0 5px rgba(0,0,0,0.03); overflow: hidden; 
    transition: left 0.3s ease, width 0.3s ease;
}

/* ESTILO ESPECÍFICO PARA TELAS DE CADASTRO (Full Width Desktop) */
#app-main.main-registration {
    left: var(--gap-side); /* Remove espaço da sidebar */
    width: calc(100% - (var(--gap-side) * 2));
    background-color: transparent; /* Fundo transparente para ver o cinza do body */
    box-shadow: none;
    overflow-y: auto; /* Permite rolar a página inteira */
    align-items: center; /* Centraliza o form */
}

/* Esconde sidebar no desktop APENAS nas telas de cadastro */
body:has(.main-registration) #app-sidebar {
    display: none;
}

/* MODIFICADOR TRANSPARENTE (Lista Equipamentos) */
#app-main.main-transparent { background-color: transparent; box-shadow: none; border-radius: 0; overflow: visible; }


/* --- RESPONSIVIDADE (MOBILE & TABLET) --- */
@media (max-width: 768px) {
    /* Mostra sidebar no mobile mesmo nas telas de cadastro (para funcionar o menu) */
    body:has(.main-registration) #app-sidebar {
        display: flex; 
    }

    #app-sidebar { 
        left: -100%; width: 80%; max-width: 300px; height: 100%; top: 0; z-index: 2000; 
        box-shadow: 2px 0 10px rgba(0,0,0,0.2);
    }
    #app-sidebar.sidebar-open { left: 0; }
    
    body.menu-active::before {
        content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5); z-index: 1500; animation: fadeIn 0.2s;
    }

    #app-main { 
        left: var(--gap-side) !important; 
        width: calc(100% - (var(--gap-side) * 2)); 
    }
    
    :root { --gap-side: 10px; }
}
==================================================
CAMINHO: .\css\components\modal.css
==================================================
/* css/components/modal.css */

/* Fundo Escuro */
.modal-overlay {
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%;
    background: rgba(0,0,0,0.6);
    display: none; /* Começa escondido */
    justify-content: center; 
    align-items: center;
    z-index: 10000 !important; /* Garante que fique acima de tudo */
    opacity: 0; 
    transition: opacity 0.2s;
}

/* ESTADO ATIVO (Corrigido para 'active') */
.modal-overlay.active { 
    display: flex; 
    opacity: 1; 
    visibility: visible !important; /* Força visibilidade */
}

/* Caixa do Modal */
.modal-box {
    background: white; 
    padding: 25px; 
    border-radius: 15px;
    width: 90%; 
    max-width: 400px;
    text-align: left;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    transform: scale(0.8); 
    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    font-family: 'Segoe UI', sans-serif;
}

/* Animação quando ativo */
.modal-overlay.active .modal-box { 
    transform: scale(1); 
}

/* Título */
.modal-title { 
    font-size: 24px;
    color: #444; 
    margin-bottom: 15px; 
    font-weight: 600; 
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

/* Texto do Corpo */
.modal-text { 
    color: #333;
    font-size: 16px;
    margin-bottom: 25px; 
    line-height: 1.5;
}

/* Área dos Botões */
.modal-actions { 
    display: flex; 
    justify-content: flex-end; /* Botões à direita */
    gap: 15px;
}

/* Botões Genéricos */
.btn-modal { 
    padding: 10px 25px; 
    border-radius: 8px;
    border: none; 
    cursor: pointer; 
    font-size: 16px;
    font-weight: 600;
    transition: opacity 0.2s, transform 0.1s;
}

.btn-modal:hover { opacity: 0.9; transform: translateY(-1px); }

/* Botão Não (Cinza) */
.btn-cancel { 
    background: #f0f0f0; 
    color: #666;
}

/* Botão Sim (Vermelho para ações destrutivas ou Cor da Marca) */
.btn-confirm { 
    background: var(--brand-primary, #92D6D6);
    color: white;
}
==================================================
CAMINHO: .\css\components\sidebar.css
==================================================
/* css/components/sidebar.css */

/* CONFIGURAÇÃO DO CONTAINER PRINCIPAL (FLEXBOX) */
#app-sidebar {
    display: flex;
    flex-direction: column;
    height: 100%; 
    background-color: var(--bg-surface);
    border-right: 1px solid var(--border-medium);
    border-top-right-radius: 10px;
    overflow: hidden; 
}

/* 1. TÍTULO FIXO */
.sidebar-title { 
    height: 44px; 
    background-color: var(--brand-primary); 
    color: var(--text-inverse); 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    font-weight: bold; 
    font-size: 18px; 
    border-top-right-radius: 10px;
    flex-shrink: 0; 
}

/* 2. ÁREA DE SCROLL (CENTRO - ÁRVORE) */
/* --- MUDANÇA AQUI --- */
#tree-menu-container { 
    /* Antes era flex: 1 (ocupava tudo). Agora é flex: 0 1 auto. */
    /* Grow: 0 (não cresce vazio), Shrink: 1 (encolhe se faltar espaço), Basis: auto */
    flex: 0 1 auto;
    
    /* min-height: 0 é crucial para o scroll funcionar dentro de um flex item encolhido */
    min-height: 0; 
    
    overflow-y: auto; 
    padding: 10px 0; 
}

/* 3. RODAPÉ DE ADMINISTRAÇÃO */
/* --- MUDANÇA AQUI --- */
.sidebar-footer-actions {
    padding: 20px;
    background-color: #f8f9fa; 
    border-top: 1px solid var(--border-medium);
    border-bottom: 1px solid var(--border-medium); /* Opcional: fecha o bloco visualmente */
    flex-shrink: 0; 
    
    /* Adiciona um espaço visual do menu, mas não empurra pro final da tela */
    margin-top: 10px; 
}

/* O resto continua igual... */

.sidebar-subtitle {
    font-size: 11px;
    text-transform: uppercase;
    color: var(--text-muted);
    font-weight: 700;
    margin-bottom: 10px;
    letter-spacing: 0.5px;
}

.sidebar-action-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 8px;
    background: white;
    border: 1px solid var(--border-medium);
    border-radius: 6px;
    color: var(--text-secondary);
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
}

.sidebar-action-btn i {
    color: var(--brand-primary);
    width: 16px;
    text-align: center;
}

.sidebar-action-btn:hover {
    background-color: var(--brand-hover-light);
    border-color: var(--brand-active);
    color: var(--brand-active);
}

/* --- ESTILOS DA ÁRVORE (TREE) --- */
.tree-item-content { 
    min-height: 40px; 
    display: flex; 
    align-items: center; 
    padding-left: 15px; 
    cursor: pointer; 
    color: var(--text-secondary); 
    font-size: 14px; 
    user-select: none; 
    border-left: 4px solid transparent; 
    transition: background 0.2s; 
}

.tree-item-content:hover { 
    background-color: var(--brand-hover-light); 
    color: var(--brand-active); 
}

.active-sector,
.leaf-node.active-sector,
.folder-node.active-sector { 
    background-color: var(--brand-hover-light); 
    color: var(--brand-active); 
    font-weight: bold; 
    border-left: 4px solid var(--brand-active); 
}

.tree-children { 
    display: none; 
    padding-left: 15px; 
}

.expanded > .tree-children { 
    display: block; 
    animation: fadeIn 0.2s; 
}

.arrow { 
    margin-right: 8px; 
    font-size: 10px; 
    width: 10px; 
    transition: transform 0.2s; 
}

.expanded > .tree-item-content .arrow { 
    transform: rotate(90deg); 
}

/* --- NAVEGAÇÃO MOBILE --- */
.sidebar-mobile-nav {
    display: none; 
    list-style: none;
    padding: 10px 0;
    margin: 0;
    background-color: var(--bg-surface);
}

.sidebar-mobile-nav li {
    padding: 15px 20px;
    font-size: 16px;
    color: var(--text-primary);
    border-bottom: 1px solid var(--border-light);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: background 0.2s, color 0.2s;
}

.sidebar-mobile-nav li:hover:not(.disabled) {
    background-color: var(--brand-hover-light);
    color: var(--brand-active);
    font-weight: 500;
}

.sidebar-mobile-nav li i {
    width: 24px;
    text-align: center;
    color: var(--brand-active);
    font-size: 18px;
}

.sidebar-divider {
    border: 0;
    border-top: 1px solid var(--border-medium);
    margin: 10px 20px;
}

/* RESPONSIVIDADE */
@media (max-width: 768px) {
    .sidebar-mobile-nav { display: block; }
    #app-sidebar, .sidebar-title { border-radius: 0; }
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
}
==================================================
CAMINHO: .\css\components\tables.css
==================================================
/* css/components/tables.css */

/* --- DEFINIÇÃO DOS GRIDS (Desktop) --- */
:root {
    /* EQUIPAMENTOS (11 Colunas agora) 
       1. Icon (40px)
       2. # (60px)
       3. Série (140px) - Reduzi um pouco para caber a sala
       4. Modelo (1.5fr)
       5. Sala (1.2fr) - NOVA COLUNA
       6. Usuário (1.2fr)
       7. Status (90px)
       8. Setor (110px)
       9. Cont (90px)
       10. Ton (80px)
       11. Erro (1fr)
    */
    --grid-equip: 40px 60px 140px 1.5fr 1.2fr 1.2fr 90px 110px 90px 80px 1fr;

    /* USUÁRIOS (5 Colunas) */
    --grid-users: 60px 2fr 1.2fr 150px 1.2fr;

    /* --- CORREÇÃO AQUI (9 COLUNAS AGORA) --- 
       1. Status (30px)
       2. ID (50px)
       3. Equipamento (1.2fr - Flexível)
       4. Defeito (1.5fr - Maior espaço)
       5. Solicitante (1fr)
       6. Responsável (1fr)
       7. Setor (110px - Fixo para não empurrar)
       8. Abertura (90px)
       9. Fechamento (90px)
    */
    --grid-os: 30px 50px 1.2fr 1.5fr 1fr 1fr 110px 90px 90px;

    /* SETORES (3 Colunas: Nome(flex) | Empresa(flex) | Cidade(150px)) */
    --grid-sectors: 1.5fr 1.5fr 150px;
}

/* --- ESTRUTURA GERAL --- */
.table-content, .inner-table-content {
    flex: 1;
    overflow-y: auto;
    background-color: var(--bg-surface);
    
    /* MUDAR DE 10px PARA 0 */
    padding-left: 0; 
}

/* --- HEADER E LINHAS (GRID SYSTEM) --- */

/* 1. EQUIPAMENTOS e TABELA INTERNA */
/* Adicionei as classes compostas .equip-grid.user-row para garantir especificidade se o JS adicionar ambas */
.equip-grid, 
.inner-table-header, 
.user-row.equip-grid,
.inner-table-row.equip-grid,
#equipment-list .user-row, 
#inner-list .inner-table-row {
    display: grid;
    grid-template-columns: var(--grid-equip);
    align-items: center;
    padding-left: 10px;
    padding-right: 8px;
}

/* 2. USUÁRIOS */
/* Adicionei .user-row.users-grid */
.users-grid, 
.user-row.users-grid,
#users-list .user-row {
    display: grid;
    grid-template-columns: var(--grid-users);
    align-items: center;
    padding-left: 10px;
    padding-right: 8px;
}

/* 3. OS */
.os-grid, 
.user-row.os-grid,
#os-list .user-row {
    display: grid;
    grid-template-columns: var(--grid-os);
    align-items: center;
    padding-left: 10px;
    padding-right: 8px;
}

/* 3. Setor */
.sectors-grid, 
.user-row.sectors-grid,
#sectors-list .user-row {
    display: grid;
    grid-template-columns: var(--grid-sectors);
    align-items: center;
    padding-left: 10px;
    padding-right: 8px;
}

/* --- ESTILOS VISUAIS --- */

/* CABEÇALHO PRINCIPAL */
.table-header {
    height: 44px;
    background-color: var(--brand-primary);
    color: var(--text-inverse);
    font-weight: bold;
    font-size: 14px;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    white-space: nowrap;
}

/* CABEÇALHO INTERNO (Aba Impressoras) */
.inner-table-header {
    height: 44px;
    background-color: var(--brand-active);
    color: var(--text-inverse);
    font-weight: bold;
    font-size: 14px;
    white-space: nowrap;
    border-radius: 0; 
}

/* LINHAS */
.user-row, .inner-table-row {
    min-height: 44px;
    border-bottom: 1px solid var(--border-light);
    cursor: pointer;
    font-size: 13px;
    color: var(--text-primary);
    transition: background 0.1s;
}

.user-row:hover, .inner-table-row:hover { background-color: var(--bg-row-hover); }
.user-row.selected { background-color: var(--brand-hover-light); box-shadow: inset 4px 0 0 var(--brand-active); }

/* --- CÉLULAS --- */
.th-col {
    text-align: left;
    padding: 0 5px; 
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* --- REGRAS ESPECÍFICAS DE ALINHAMENTO --- */

/* 1. Coluna # (ID) - Coluna 2 */
.equip-grid .th-col:nth-child(2), 
.inner-table-header .th-col:nth-child(2) {
    text-align: center !important;
}

#equipment-list .user-row .th-col:nth-child(2),
#inner-list .inner-table-row .th-col:nth-child(2) {
    text-align: left !important;
    padding-left: 20px;
}

/* 2. Coluna Ícone - Coluna 1 */
.equip-grid .th-col:nth-child(1),
#equipment-list .user-row .th-col:nth-child(1),
#inner-list .inner-table-row .th-col:nth-child(1) {
    text-align: center !important;
    padding: 0;
}

#empty-state { padding: 40px; color: var(--text-muted); text-align: center; }


/* ==========================================================================
   MOBILE CARD LAYOUT
   ========================================================================== */

@media (max-width: 900px) {
    
    .table-header, .inner-table-header { display: none !important; }
    .table-content, .inner-table-content { padding: 10px; background-color: var(--bg-body); }

    .user-row, .inner-table-row {
        display: block; 
        background: #fff;
        border: 1px solid var(--border-medium);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 10px;
        height: auto;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        position: relative;
    }

    .th-col { width: auto; text-align: left !important; white-space: normal; overflow: visible; padding: 0; }

    /* CARD EQUIPAMENTO */
    #equipment-list .user-row, #inner-list .inner-table-row {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr; 
        grid-row-gap: 2px;
        grid-column-gap: 8px;
    }

    #equipment-list .th-col:nth-child(4) { grid-row: 1; grid-column: 1 / 3; font-weight: bold; font-size: 13px; color: var(--text-primary); line-height: 1.2; }
    #equipment-list .th-col:nth-child(1) { grid-row: 1; grid-column: 3; text-align: right !important; font-size: 16px; color: var(--brand-active); }
    #equipment-list .th-col:nth-child(3) { grid-row: 2; grid-column: 1 / -1; font-size: 11px; color: var(--text-secondary); padding-bottom: 4px; margin-bottom: 4px; border-bottom: 1px solid #eee; }
    #equipment-list .th-col:nth-child(5) { grid-row: 3; grid-column: 1 / 3; font-size: 12px; font-weight: 500; }
    #equipment-list .th-col:nth-child(7) { grid-row: 3; grid-column: 3; text-align: right !important; font-size: 11px; color: var(--text-muted); }
    #equipment-list .th-col:nth-child(8) { grid-row: 4; grid-column: 1; font-size: 11px; color: var(--text-secondary); margin-top: 3px; }
    #equipment-list .th-col:nth-child(9) { grid-row: 4; grid-column: 2; font-size: 11px; color: var(--text-secondary); margin-top: 3px; text-align: center !important; }
    #equipment-list .th-col:nth-child(6) { grid-row: 4; grid-column: 3; font-size: 11px; margin-top: 3px; text-align: right !important; }
    #equipment-list .th-col:nth-child(10) { grid-row: 5; grid-column: 1 / -1; font-size: 11px; margin-top: 2px; }

    #equipment-list .th-col:nth-child(2) { display: none; }
    /* A pseudo-elemento ::before pode causar problemas se não estiver configurado corretamente no JS, removendo para segurança */
    #equipment-list .th-col::before { display: none; }

    /* CARD USUÁRIO */
    #users-list .user-row { display: grid; grid-template-columns: 1fr 1fr; grid-row-gap: 3px; }
    #users-list .th-col:nth-child(2) { grid-row: 1; grid-column: 1 / -1; font-size: 15px; font-weight: bold; color: var(--text-primary); margin-bottom: 2px; }
    #users-list .th-col:nth-child(3) { grid-row: 2; grid-column: 1; font-size: 13px; color: var(--text-secondary); text-align: left !important; }
    #users-list .th-col:nth-child(4) { grid-row: 2; grid-column: 2; font-size: 13px; font-weight: 500; color: var(--brand-active); text-align: right !important; }
    #users-list .th-col:nth-child(5) { grid-row: 3; grid-column: 1 / -1; font-size: 12px; color: var(--text-muted); margin-top: 3px; padding-top: 3px; border-top: 1px dashed #eee; }
    #users-list .th-col::before { content: none !important; display: none !important; }
    #users-list .th-col:nth-child(1) { display: none; }
}
==================================================
CAMINHO: .\css\components\tabs.css
==================================================
.tabs-header { height: 44px; background-color: var(--bg-disabled); display: flex; align-items: stretch; padding: 0; }
.tab-btn { flex: 1; background-color: var(--brand-primary); color: var(--text-inverse); border: none; font-weight: 500; font-size: 14px; cursor: pointer; transition: background-color 0.2s; border-right: 1px solid rgba(255,255,255,0.2); text-align: left; padding-left: 20px; }
.tab-btn.active { background-color: var(--brand-active); font-weight: bold; }
.tab-btn:hover:not(.active):not(:disabled) { background-color: var(--brand-secondary); }
.tab-btn:disabled { opacity: 1; cursor: not-allowed; background-color: var(--bg-disabled); color: var(--text-disabled); }
.tab-content-area { flex: 1; padding: 0; display: flex; flex-direction: column; }
.tab-content-area.padded { padding: 40px; }
.tab-content-area.centered { justify-content: center; align-items: center; }
==================================================
CAMINHO: .\css\components\toast.css
==================================================
/* Container de notificações (Canto superior direito) */
#toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* O Cartão do Toast */
.toast {
    min-width: 250px;
    padding: 16px 20px;
    border-radius: 8px;
    background-color: #333;
    color: #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 14px;
    
    /* Animação de entrada e saída */
    animation: slideIn 0.3s ease forwards;
    opacity: 0;
    transform: translateX(100%);
}

.toast.show { opacity: 1; transform: translateX(0); }
.toast.hide { animation: slideOut 0.3s ease forwards; }

/* Tipos de Toast */
.toast.success { background-color: var(--status-success); border-left: 5px solid #005a00; }
.toast.error { background-color: var(--status-error); border-left: 5px solid #cc0000; }
.toast.info { background-color: var(--brand-active); border-left: 5px solid var(--brand-primary); }

/* Ícones */
.toast i { font-size: 18px; }

@keyframes slideIn {
    from { opacity: 0; transform: translateX(100%); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes slideOut {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(100%); }
}
==================================================
CAMINHO: .\css\pages\dashboard.css
==================================================
/* css/pages/dashboard.css */

/* ==========================================================================
   0. AJUSTE GLOBAL
   ========================================================================== */
#app-main {
    overflow-y: auto !important; 
    -webkit-overflow-scrolling: touch;
    display: block !important;
}

/* ==========================================================================
   1. LAYOUT DO CONTAINER (CORRIGIDO PARA MOBILE)
   ========================================================================== */
.kpi-grid { 
    display: grid; 
    /* Mudança: minmax de 280px para 100% no mobile */
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); 
    gap: 20px; 
    margin-bottom: 25px; 
    padding: 20px 20px 0 20px;
}

.details-grid { 
    display: grid; 
    /* Mudança: minmax reduzido para caber em telas pequenas */
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
    gap: 20px; 
    padding: 0 20px 40px 20px;
}

/* ==========================================================================
   2. CARDS
   ========================================================================== */
.card { 
    background: var(--bg-surface); 
    border-radius: 12px; 
    padding: 20px; 
    box-shadow: var(--shadow-soft); 
    border: 1px solid var(--border-light);
    display: flex; 
    flex-direction: column; 
    height: auto; 
    min-height: 100%;
    
    /* CORREÇÃO MOBILE: Garante que o conteúdo interno não estoure o card */
    width: 100%; 
    overflow: hidden; 
}

/* ==========================================================================
   3. KPI CARDS
   ========================================================================== */
.kpi-card { 
    flex-direction: row; 
    align-items: center; 
    gap: 20px; 
    transition: transform 0.2s;
}
.kpi-card:hover { transform: translateY(-2px); }

.kpi-icon { 
    width: 60px; height: 60px; 
    background: var(--brand-hover-light); 
    border-radius: 12px; 
    display: flex; align-items: center; justify-content: center; 
    font-size: 1.8rem; 
    color: var(--brand-active); 
    border: 1px solid var(--brand-primary); 
    flex-shrink: 0;
}
.kpi-icon.icon-error {
    background-color: #fff0f0; color: var(--status-error); border-color: #ffcccc;
}
.kpi-info h3 { font-size: 0.85rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: 4px; font-weight: 700; }
.kpi-info span { font-size: 1.8rem; font-weight: 800; color: var(--text-primary); }

/* ==========================================================================
   4. LISTAS E TABELAS (CORREÇÃO DE SCROLL HORIZONTAL)
   ========================================================================== */
.card-header { 
    display: flex; align-items: center; margin-bottom: 20px; 
    gap: 12px; padding-bottom: 10px; border-bottom: 1px solid var(--border-light);
}
.card-header h2 { font-size: 0.95rem; text-transform: uppercase; font-weight: 700; color: var(--text-secondary); margin: 0; }
.card-header i { font-size: 1.2rem; color: var(--brand-active); }

/* Container com scroll para tabelas/listas */
.list-container {
    width: 100%;
    overflow-x: auto; /* Permite scroll lateral se a tabela for grande */
}

/* Lista de Impressoras */
.list-row { 
    display: flex; align-items: center; padding: 10px 0; 
    border-bottom: 1px solid var(--border-light); font-size: 0.9rem; cursor: pointer; transition: background 0.1s;
    min-width: 250px; /* Garante tamanho mínimo */
}
.list-row:hover { background-color: var(--bg-row-hover); }
.list-row:last-child { border-bottom: none; }

.row-id { width: 35px; color: var(--text-muted); font-weight: bold; font-size: 0.8rem; flex-shrink: 0; }
.row-name { flex: 1; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 10px; }
.row-value { width: 50px; text-align: right; font-weight: bold; font-size: 0.85rem; color: var(--text-secondary); flex-shrink: 0; }

.progress-container { width: 60px; height: 8px; background: #eee; border-radius: 4px; margin: 0 10px; overflow: hidden; flex-shrink: 0; }
.progress-bar { height: 100%; background: var(--brand-active); border-radius: 4px; }

/* Tabela de Cidades */
.city-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 100%; }
.city-table th { text-align: left; color: var(--text-muted); font-weight: 600; padding-bottom: 8px; border-bottom: 1px solid var(--border-medium); font-size: 0.8rem; text-transform: uppercase; white-space: nowrap; }
.city-table td { padding: 10px 0; border-bottom: 1px solid var(--border-light); color: var(--text-primary); }
.text-center { text-align: center !important; }

/* ==========================================================================
   5. LISTA DE ERROS (CORES CORRIGIDAS)
   ========================================================================== */
.error-item { 
    display: flex; align-items: flex-start; padding: 12px; margin-bottom: 10px; 
    border-radius: 8px; background-color: var(--bg-body); border: 1px solid var(--border-light); 
    cursor: pointer; transition: transform 0.1s; position: relative; padding-left: 15px; overflow: hidden;
}
.error-item:hover { transform: translateX(3px); border-color: var(--border-medium); }

/* Tarja Lateral */
.error-item::before { 
    content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; 
}

/* Ícone */
.error-icon-circle { 
    width: 36px; height: 36px; border-radius: 50%; border: 1px solid; 
    display: flex; align-items: center; justify-content: center; margin-right: 12px; flex-shrink: 0; font-size: 14px; background: #fff;
}

/* --- DEFINIÇÃO DE CORES (Igual NOC) --- */
/* Crítico (Vermelho) */
.status-red::before { background-color: var(--status-error); }
.status-red .error-icon-circle { border-color: var(--status-error); color: var(--status-error); background-color: #fff5f5; }

/* Alerta (Amarelo/Laranja) */
.status-yellow::before { background-color: #FFA500; }
.status-yellow .error-icon-circle { border-color: #FFA500; color: #FFA500; background-color: #fffde7; }

/* Info (Azul/Padrão) */
.status-info::before { background-color: var(--brand-active); }
.status-info .error-icon-circle { border-color: var(--brand-active); color: var(--brand-active); background-color: #e0f7fa; }

/* Texto */
.error-text { flex: 1; min-width: 0; }
.error-text h4 { 
    font-size: 0.9rem; margin-bottom: 4px; color: var(--text-primary); font-weight: 700; 
    white-space: normal; line-height: 1.2; 
}
.error-text p { 
    font-size: 0.8rem; color: var(--text-muted); margin: 0; 
    white-space: normal; line-height: 1.4; word-break: break-word; 
}

/* ==========================================================================
   6. OVERRIDE DESKTOP
   ========================================================================== */
@media (min-width: 901px) {
    body.layout-full-width #app-sidebar { display: none !important; }
    body.layout-full-width #app-main {
        position: relative !important; left: 0 !important; right: 0 !important; bottom: auto !important; top: auto !important;
        width: 95% !important; max-width: 1200px !important; margin: 0 auto !important;
        margin-top: calc(var(--header-height) + 30px) !important; margin-bottom: 30px !important;
        height: auto !important; overflow: visible !important; box-shadow: none !important; background: transparent !important; padding: 0 !important; border-radius: 0 !important;
    }
    .kpi-grid { padding: 0 !important; margin-bottom: 25px; }
    .details-grid { padding: 0 !important; }
}

/* ==========================================================================
   7. OVERRIDE MOBILE (CORREÇÃO DE ESTOURO)
   ========================================================================== */
@media (max-width: 900px) {
    .kpi-grid { 
        grid-template-columns: 1fr; /* Um card por linha */
        padding: 15px;
    }
    .details-grid { 
        grid-template-columns: 1fr; /* Um card por linha */
        padding: 0 15px 80px 15px; /* Espaço extra embaixo */
    }
    .kpi-card { padding: 15px; }
    
    /* Força tabelas a terem scroll horizontal se não caberem */
    .city-table, .list-row {
        min-width: 100%;
    }
}
==================================================
CAMINHO: .\css\pages\equipamento.css
==================================================
/* css/pages/equipamento.css - VERSÃO FINAL (Scroll + Seta Corrigidos) */

/* ==========================================================================
   LAYOUT DESKTOP (BASE)
   ========================================================================== */

.split-container { 
    display: flex; 
    flex-direction: column; 
    width: 100%; 
    gap: 20px; 
    height: 100%; 
    overflow: hidden; 
    padding-bottom: 20px; 
}

/* LISTA SUPERIOR (Ajustado para 50%) */
.top-list-section { 
    height: 50vh; /* Mudou de 55vh para 50vh */
    min-height: 300px; 
    flex-shrink: 0; 
    display: flex; flex-direction: column; 
    background-color: var(--bg-surface); 
    border-radius: 10px; 
    box-shadow: var(--shadow-soft); 
    overflow: hidden; 
}

/* PAINEL INFERIOR */
.bottom-panel-section { 
    flex: 1;
    min-height: 0;
    display: flex; flex-direction: column; 
    background-color: var(--bg-surface); 
    border-radius: 10px 10px 0 0; 
    box-shadow: var(--shadow-soft); 
    overflow: hidden; 
}


/* ==========================================================================
   ÁREA DE CONTEÚDO (SCROLL E CENTRALIZAÇÃO)
   ========================================================================== */

/* 1. Comportamento Padrão (Tabelas) */
#tab-content-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden; 
    min-height: 0;
}

/* 2. Comportamento Centralizado (Opções/Erros) */
#tab-content-area.centered {
    overflow-y: auto !important; /* Libera o scroll */
    align-items: center; 
    display: flex;
    flex-direction: column;
    justify-content: center;
}

#tab-content-area.centered .options-stack {
    /* REMOVI O MARGIN AUTO QUE PODIA JOGAR PRA CIMA DEMAIS */
    margin-top: 50px;    
    margin-bottom: auto;
    
    /* Ajuste do Padding */
    padding: 50px 0 80px 0; 
    
    flex-shrink: 0;
    width: 90%;          
    max-width: 300px;    
}

/* ==========================================================================
   ELEMENTOS DE UI
   ========================================================================== */

/* Botão voltar mobile (Escondido no Desktop) */
.mobile-back-btn { 
    display: none !important; 
}

/* Container da Tabela Interna */
.inner-table-container {
    display: flex;
    flex-direction: column;
    flex: 1;          
    min-height: 0;    
    width: 100%;
}

/* Área de rolagem da tabela */
.inner-table-content {
    flex: 1;            
    overflow-y: auto;   
    min-height: 0;      
    padding-bottom: 10px;
}

/* Cabeçalho das abas fixo */
.tabs-header {
    flex: 0 0 auto; 
    z-index: 5;
}


/* ==========================================================================
   MOBILE (OVERRIDE)
   ========================================================================== */
@media (max-width: 900px) {
    .split-container {
        padding-bottom: 0;
        display: block; 
    }

    .top-list-section { 
        height: 100%; 
        border-radius: 0; 
        box-shadow: none;
    }
    
    .bottom-panel-section { 
        position: fixed; 
        left: 0; right: 0; bottom: 0;
        height: 50vh; 
        z-index: 5000; 
        
        border-radius: 20px 20px 0 0; 
        box-shadow: 0 -5px 20px rgba(0,0,0,0.2); 
        
        transform: translateY(110%); 
        transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        display: flex; 
    }

    .split-container.show-detail .bottom-panel-section { 
        transform: translateY(0); 
    }

    .split-container.show-detail .top-list-section { 
        display: flex; 
        opacity: 0.5; 
        pointer-events: auto; 
    }

    /* Agora mostramos o botão no mobile */
    .mobile-back-btn {
        display: flex !important;
        align-items: center;
        justify-content: center;
        background: transparent; 
        border: none; 
        color: var(--brand-active); 
        font-weight: bold; 
        padding: 0 20px; 
        cursor: pointer; 
        font-size: 18px;
        height: 100%; 
        border-right: 1px solid var(--border-light);
    }
    
    .mobile-back-btn:active {
        background-color: var(--bg-header-gray);
    }

    .inner-table-content {
        padding-bottom: 40px !important;
    }
}
==================================================
CAMINHO: .\css\pages\forms.css
==================================================
/* css/pages/forms.css - REVISADO E CORRIGIDO */

/* --- CONTAINER PRINCIPAL DO FORMULÁRIO --- */
.form-container {
    width: 90%;
    max-width: 600px;
    max-height: 95vh;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    background-color: var(--bg-surface);
    border-radius: 10px;
    box-shadow: var(--shadow-soft);
    padding: 30px;
    margin: 20px auto;
}

/* --- CABEÇALHO DO FORMULÁRIO --- */
.form-header-title h2 {
    color: var(--text-primary);
    margin-bottom: 25px;
    font-size: 24px;
    border-left: 5px solid var(--brand-active);
    padding-left: 15px;
}

/* --- SELETOR DE TIPO (EQUIPAMENTOS) --- */
.type-selector {
    margin-bottom: 25px;
}

/* --- GRUPOS DE INPUTS --- */
.form-group {
    margin-bottom: 20px;
}

.form-group label, .type-selector label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 14px;
}

/* Estilo padrão para todos os Inputs, Selects e Textareas */
input[type="text"],
input[type="password"],
textarea,
.custom-input {
    width: 100%;
    padding: 12px 15px;
    border-radius: 8px;
    border: 1px solid var(--border-input);
    background-color: var(--bg-input);
    font-size: 15px;
    color: var(--text-primary);
    transition: border-color 0.2s;
    outline: none;
    font-family: inherit;
}

/* Estilo ESPECÍFICO para Select (Remove a seta nativa duplicada) */
select, 
.custom-select {
    width: 100%;
    padding: 12px 15px;
    border-radius: 8px;
    border: 1px solid var(--border-input);
    background-color: var(--bg-input);
    font-size: 15px;
    color: var(--text-primary);
    transition: border-color 0.2s;
    outline: none;
    font-family: inherit;
    cursor: pointer;

    /* --- MÁGICA PARA REMOVER A SETA NATIVA --- */
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    
    /* Garante que o fundo seja opaco para cobrir qualquer coisa */
    background-image: none; 
}

/* Foco para todos */
input:focus,
select:focus,
textarea:focus {
    border-color: var(--brand-active);
    box-shadow: 0 0 0 2px var(--brand-hover-light);
}

input:disabled,
select:disabled {
    background-color: #f0f0f0;
    color: #888;
    cursor: not-allowed;
}

textarea {
    resize: vertical;
    min-height: 80px;
}

/* Wrappers de ícones (Olho senha, Seta select) */
.custom-select-wrapper, .caixa-de-senha, .input-wrapper {
    position: relative;
    width: 100%;
}

.select-icon, .icone-do-olho {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
    pointer-events: none;
}
/* Exceção para o olho da senha que é clicável */
.icone-do-olho { pointer-events: auto; cursor: pointer; }


/* --- INPUT COM BOTÃO AO LADO (+) --- */
.input-with-action {
    display: flex;
    gap: 8px;
    align-items: stretch; /* Garante mesma altura */
    width: 100%;
}

.input-with-action select,
.input-with-action input {
    flex: 1; 
}

.btn-icon-action {
    width: 46px; /* Ajustado para alinhar com a altura padrão do input */
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--border-medium);
    background-color: var(--bg-surface);
    color: var(--brand-primary);
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.2s;
}

.btn-icon-action:hover:not(:disabled) {
    background-color: var(--brand-hover-light);
    border-color: var(--brand-active);
}

.btn-icon-action:disabled {
    background-color: #f5f5f5;
    color: #ccc;
    cursor: not-allowed;
    border-color: #eee;
}

/* --- BOTÕES DE AÇÃO --- */

/* 1. Botão Principal Genérico (Usado em Login, Usuários, etc) */
.btn-submit {
    width: 100%;
    padding: 15px;
    margin-top: 20px;
    background-color: var(--brand-active);
    color: var(--text-inverse);
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s, transform 0.1s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.btn-submit:hover {
    background-color: var(--brand-hover-dark);
    transform: translateY(-2px);
}

.btn-submit:active {
    transform: translateY(0);
}

/* 2. Container de Botões Específico (Salvar/Cancelar - Setor) */
.form-actions {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid var(--border-light);
    display: flex;
    justify-content: flex-end;
    gap: 15px;
}

.btn-save, .btn-cancel {
    padding: 12px 25px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: transform 0.1s, background-color 0.2s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.btn-save {
    background-color: var(--brand-active);
    color: white;
}

.btn-save:hover {
    background-color: var(--brand-hover-dark);
    transform: translateY(-1px);
}

.btn-cancel {
    background-color: #e0e0e0;
    color: #555;
}

.btn-cancel:hover {
    background-color: #d0d0d0;
}

/* --- LAYOUT DE GRID (LINHAS COM COLUNAS) --- */
.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr; /* 50% 50% */
    gap: 15px;
    margin-bottom: 15px;
}

.form-row.three-col {
    grid-template-columns: 2fr 1fr; /* 66% 33% (Ideal para Cidade/UF) */
}

/* --- MODAIS (POP-UPS) --- */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(2px); /* Efeito moderno de desfoque no fundo */
    z-index: 2000; /* Alto z-index para ficar acima de tudo */
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.modal-overlay.active {
    opacity: 1;
    visibility: visible;
}

.modal-container {
    background: var(--bg-surface);
    width: 90%;
    max-width: 500px;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    
    /* --- CORREÇÃO DO OVERFLOW AQUI --- */
    max-height: 90vh;       /* Ocupa no máximo 90% da altura da tela */
    overflow-y: auto;       /* Cria barra de rolagem se passar disso */
    display: flex;
    flex-direction: column;
    
    transform: translateY(20px);
    transition: transform 0.3s ease;
}

.modal-overlay.active .modal-container {
    transform: translateY(0);
}

.modal-header {
    background-color: var(--bg-body);
    padding: 15px 25px;
    border-bottom: 1px solid var(--border-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    font-size: 18px;
    color: var(--brand-primary);
    display: flex;
    align-items: center;
    gap: 10px;
}

.modal-close {
    background: none;
    border: none;
    font-size: 24px;
    color: #999;
    cursor: pointer;
    line-height: 1;
}

.modal-close:hover {
    color: var(--status-error);
}

/* Corpo do Modal (onde ficam os inputs) */
#form-city-modal, #form-company-modal {
    padding: 25px;
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid var(--border-light);
}

/* --- RESPONSIVIDADE MOBILE --- */
@media (max-width: 600px) { 
    .form-container { 
        width: 100%; 
        height: 100vh; 
        max-height: none; 
        border-radius: 0; 
        box-shadow: none; 
        margin: 0; 
        padding: 20px;
    } 

    .modal-container {
        width: 95%;
    }

    .form-row, .form-row.three-col {
        grid-template-columns: 1fr; /* Vira uma coluna só no celular */
        gap: 10px;
    }
}
==================================================
CAMINHO: .\css\pages\log.css
==================================================
/* ==========================================================================
   1. UTILITÁRIOS & BADGES
   Estilos visuais reutilizáveis dentro do log.
   ========================================================================== */
.badge { 
    display: inline-block;
    min-width: 80px;
    padding: 4px 8px; 
    border-radius: 4px; 
    font-size: 11px; 
    font-weight: 700; 
    text-align: center; 
    text-transform: uppercase; 
    color: var(--text-inverse);
}

/* Variações de Status */
.badge.create { background-color: var(--status-success); }
.badge.delete { background-color: var(--status-error); }
.badge.login  { background-color: var(--brand-active); }
.badge.update { 
    background-color: var(--status-warning); 
    color: #444; 
}

/* ==========================================================================
   2. LAYOUT DESKTOP (PADRÃO)
   Configurações da grade e overrides de tela cheia.
   ========================================================================== */

/* --- Configuração da Grade (Grid) --- */
.log-grid {
    display: grid;
    /* Colunas: Data | Usuário | Ação | Recurso | Detalhes */
    grid-template-columns: 180px 1.5fr 120px 150px 2.5fr;
    align-items: center;
    gap: 20px;
    padding: 0 20px;
}

/* --- Comportamento das Células --- */
.log-grid .th-col { 
    white-space: nowrap; 
    overflow: hidden; 
    text-overflow: ellipsis; 
    padding: 0; 
}

/* Exceção: Coluna Detalhes (Permite quebra de linha e cor padrão) */
.log-grid .th-col:nth-child(5) { 
    white-space: normal; 
}

/* --- Override: Modo Tela Cheia (Desktop > 900px) --- */
@media (min-width: 901px) {
    
    /* Remove a sidebar */
    body.layout-full-width #app-sidebar {
        display: none !important;
    }
    
    /* Expande o Main para ocupar a tela toda */
    body.layout-full-width #app-main {
        left: var(--gap-side) !important; 
        right: var(--gap-side) !important;
        width: calc(100% - (var(--gap-side) * 2)) !important;
        padding: 0 !important;
        border-radius: 10px !important;
    }

    /* Interatividade da Linha (Remove hover enganoso no desktop) */
    .user-row.log-grid { cursor: default; }
    .user-row.log-grid:hover { background-color: rgba(0,0,0,0.02); }
    .user-row.log-grid.selected { 
        background-color: transparent !important; 
        box-shadow: none !important; 
    }
}

/* ==========================================================================
   3. LAYOUT MOBILE (RESPONSIVO)
   Transforma a tabela em Cards para telas < 900px.
   ========================================================================== */
@media (max-width: 900px) {

    /* Ajuste do Main para Mobile */
    body.layout-full-width #app-main {
        left: var(--gap-side) !important;
        width: calc(100% - (var(--gap-side) * 2)) !important;
    }
    
    /* Esconde o cabeçalho da tabela */
    .table-header.log-grid { display: none !important; }
    
    /* Transforma a linha em um Card (Grid Areas) */
    .user-row.log-grid {
        display: grid !important;
        grid-template-columns: 1fr 1fr;
        grid-template-areas: 
            "date      user"
            "resource  action"
            "detail    detail";
        gap: 8px;
        padding: 15px;
        border-bottom: 1px solid var(--border-medium);
        background-color: var(--bg-surface);
        margin-bottom: 0;
    }

    /* --- Mapeamento das Áreas --- */
    
    /* 1. Data/Hora */
    .log-grid .th-col:nth-child(1) { 
        grid-area: date; 
        font-size: 12px; color: #666; text-align: left; 
    }

    /* 2. Usuário */
    .log-grid .th-col:nth-child(2) { 
        grid-area: user; 
        font-size: 13px; font-weight: bold; color: var(--brand-primary); text-align: right; 
        white-space: normal;
    }

    /* 3. Ação (Badge) */
    .log-grid .th-col:nth-child(3) { 
        grid-area: action; 
        text-align: right; align-self: center; 
    }

    /* 4. Recurso */
    .log-grid .th-col:nth-child(4) { 
        grid-area: resource; 
        text-align: left; font-size: 12px; font-weight: 600; color: #444; 
    }

    /* 5. Detalhes */
    .log-grid .th-col:nth-child(5) { 
        grid-area: detail; 
        font-size: 13px; 
        margin-top: 5px; padding-top: 5px; border-top: 1px dashed #eee;
        
        /* Garante cor padrão conforme solicitado */
        color: var(--text-primary); 
    }
}
==================================================
CAMINHO: .\css\pages\login.css
==================================================
.container-login { display: flex; flex-wrap: wrap; width: 100%; min-height: 100vh; padding: 5vw; justify-content: center; gap: 2vw; align-items: center; }
.caixa-esquerda { flex: 1 1 45%; min-width: 250px; height: 50vh; background: var(--bg-header-gray); border-radius: 8px; border: 1px solid var(--border-medium); }
.caixa-direita { flex: 1 1 45%; min-width: 250px; padding: 1vw 3vw; background: transparent; border-radius: 8px; }
.top-buttons { display: flex; justify-content: center; width: 100%; margin-bottom: 3vh; background: var(--brand-primary); border-radius: 40px; padding: 8px; text-align: center; color: var(--text-inverse); font-weight: bold; font-size: 1.2rem; }
form label { display: block; font-size: 0.9em; margin-bottom: 0.5vh; margin-left: 5px; color: var(--text-secondary); }
form input[type="text"], form input[type="password"] { width: 100%; padding: 1vh 1vw; border-radius: 30px; border: 1px solid var(--brand-primary); outline: none; font-size: 1em; height: 45px; }
form input:focus { box-shadow: 0 0 0 2px var(--brand-hover-light); border-color: var(--brand-active); }
.group-imput { margin-top: 2vh; width: 100%; }
.erro-msg { color: var(--status-error); font-size: 0.85em; margin-top: 3px; display: block; min-height: 20px; }
.caixa-de-senha { position: relative; margin-bottom: 20px; }
.icone-do-olho { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); font-size: 18px; color: var(--text-secondary); cursor: pointer; }
.opcoes { display: flex; justify-content: space-between; margin-top: 1vh; margin-bottom: 2vh; font-size: 0.85em; color: var(--text-secondary); }
.botão-de-login { width: 50%; max-width: 200px; background: var(--brand-active); color: var(--text-inverse); padding: 1vh; border-radius: 30px; border: none; cursor: pointer; font-size: 1em; display: block; margin-left: auto; margin-top: 2vh; transition: transform 0.2s; }
.botão-de-login:hover { transform: scale(1.05); background-color: var(--brand-hover-dark); }
@media (max-width: 768px) { .container-login { flex-direction: column; } .caixa-esquerda, .caixa-direita { flex: 1 1 100%; width: 100%; } .botão-de-login { width: 100%; max-width: none; } }
==================================================
CAMINHO: .\css\pages\monitoramento.css
==================================================
/* ==========================================================================
   1. CONFIGURAÇÕES GERAIS (Variáveis e Grid)
   ========================================================================== */
:root {
    /* Definição das colunas: 
       Sev(100px) | Data(140px) | Equip(1.2fr) | Sala(1fr) | Erro(1.5fr) | Ações(100px) */
    --grid-monitor: 100px 140px 1.2fr 1fr 1.5fr 100px;
}

/* ==========================================================================
   2. LAYOUT DESKTOP (MODO TELA CHEIA)
   ========================================================================== */
@media (min-width: 901px) {
    body.layout-full-width #app-sidebar {
        display: none !important;
    }

    body.layout-full-width #app-main {
        left: var(--gap-side) !important;
        right: var(--gap-side) !important;
        width: auto !important;
        max-width: 100% !important;
        top: calc(var(--header-height) + var(--gap-top)) !important;
    }
}

/* ==========================================================================
   3. ESTILOS DA TABELA (Estrutura e Células)
   ========================================================================== */
.monitor-grid,
.user-row.monitor-grid {
    display: grid;
    grid-template-columns: var(--grid-monitor);
    align-items: center;
    padding-left: 20px;
    padding-right: 10px;
}

/* Garante que a linha dentro da lista siga o grid */
#monitor-list .user-row {
    display: grid;
    grid-template-columns: var(--grid-monitor);
}

/* --- BADGES DE SEVERIDADE --- */
.sev-badge {
    padding: 5px 10px;
    border-radius: 4px;
    font-weight: bold;
    font-size: 11px;
    text-transform: uppercase;
    text-align: center;
    display: inline-block;
    width: 80px;
}

.sev-critico { background-color: #ffebee; color: #c62828; border: 1px solid #ffcdd2; }
.sev-alerta  { background-color: #fffde7; color: #f9a825; border: 1px solid #fff9c4; }
.sev-info    { background-color: #e3f2fd; color: #1565c0; border: 1px solid #bbdefb; }

/* --- TIPOGRAFIA DO ERRO --- */
.error-title { 
    font-weight: 700; 
    color: var(--text-primary); 
    display: flex;
    align-items: center;
    gap: 8px; 
    margin-bottom: 4px;
}

/* Etiqueta cinza do código */
.error-code-tag {
    background-color: #f0f0f0;
    color: #666;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 1px 6px;
    font-size: 10px;
    font-family: monospace;
    font-weight: normal;
    white-space: nowrap;
}

.error-desc { 
    font-size: 12px; 
    color: var(--text-muted); 
    display: block; 
    white-space: nowrap; 
    overflow: hidden; 
    text-overflow: ellipsis; 
    line-height: 1.2;
}

/* --- BOTÕES DE AÇÃO --- */
.monitor-actions {
    display: flex;
    gap: 6px;
    justify-content: center;
}

.btn-monitor {
    border: none;
    width: 34px;  /* Botão Quadrado */
    height: 34px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.btn-monitor i { font-size: 14px; }

/* Cores */
.btn-monitor.os { background-color: #6c5ce7; color: white; }
.btn-monitor.os:hover { background-color: #5b4cc4; transform: translateY(-2px); }

.btn-monitor.solve { background-color: var(--status-success); color: white; }
.btn-monitor.solve:hover { background-color: #006400; transform: translateY(-2px); }

.btn-monitor.view {
    width: auto;
    padding: 0 10px;
    background-color: #f0f0f0;
    color: #555;
    border: 1px solid #ccc;
    font-size: 11px;
    font-weight: bold;
    box-shadow: none;
}
.btn-monitor.view:hover { background-color: #e0e0e0; }


/* ==========================================================================
   4. LAYOUT MOBILE (CARD FINAL OTIMIZADO)
   ========================================================================== */
@media (max-width: 900px) {
    /* Usa o ID (#monitor-list) para ter prioridade máxima sobre qualquer outra regra */
    #monitor-list .user-row.monitor-grid {
        display: grid !important;
        grid-template-columns: 1fr auto !important;
        padding: 12px !important;       /* Garante padding uniforme */
        padding-left: 12px !important;  /* Força a esquerda */
        margin-left: 0 !important;      /* Garante margem zero */
        width: 100% !important;         /* Ocupa tudo */
        box-sizing: border-box !important;
    }
    
    /* Garante que a coluna Severidade não tenha margem esquerda invisível */
    #monitor-list .user-row.monitor-grid > div:nth-child(1) {
        margin-left: 0 !important;
        padding-left: 0 !important;
    }
    
    .table-header.monitor-grid { display: none; }
    
    /* Configuração do Card */
    .user-row.monitor-grid {
        display: grid !important;
        /* Coluna da esquerda (Flexível) | Coluna da direita (Auto/Data) */
        grid-template-columns: 1fr auto; 
        grid-template-areas:
            "sev  date"
            "err  err"
            "eq   room"
            "actions actions" !important;
        
        /* CORREÇÃO DO ESPAÇO VAZIO NA ESQUERDA */
        padding: 10px 12px !important; /* Remove o padding de 20px do desktop */
        padding-left: 12px !important; /* Garante que não sobrescreva */
        
        gap: 6px; /* Gap pequeno entre linhas */
        margin-bottom: 8px;
        
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        height: auto !important;
        
        /* Largura total disponível */
        width: auto;
        max-width: 100%;
        margin-left: 0; 
        margin-right: 0;
    }

    .user-row.monitor-grid > div { text-align: left; }

    /* 1. SEVERIDADE (Badge) */
    .user-row.monitor-grid > div:nth-child(1) {
        grid-area: sev;
        justify-self: start;
        /* Remove margin extra se houver */
        margin: 0;
    }
    .user-row.monitor-grid > div:nth-child(1) .sev-badge {
        font-size: 9px;
        padding: 2px 8px;
        width: auto; /* Tamanho natural do texto */
        min-width: 0;
    }

    /* 2. DATA (Topo Direita) */
    .user-row.monitor-grid > div:nth-child(2) {
        grid-area: date;
        justify-self: end;
        font-size: 0.75rem;
        color: #888;
        align-self: center;
        white-space: nowrap;
    }

    /* 3. EQUIPAMENTO (Quebra de linha ativada) */
    .user-row.monitor-grid > div:nth-child(3) {
        grid-area: eq;
        font-size: 0.8rem;
        font-weight: 700;
        color: #444;
        
        /* Força quebra de linha se for muito longo */
        white-space: normal;
        word-wrap: break-word;
        line-height: 1.25;
        
        padding-right: 5px;
        margin-top: 4px;
        padding-top: 6px;
        border-top: 1px solid #f5f5f5;
    }
    .user-row.monitor-grid > div:nth-child(3)::before { display: none; }

    /* 4. SALA (Direita) */
    .user-row.monitor-grid > div:nth-child(4) {
        grid-area: room;
        justify-self: end;
        text-align: right;
        font-size: 0.8rem;
        color: #666;
        
        margin-top: 4px;
        padding-top: 6px;
        border-top: 1px solid #f5f5f5;
        align-self: start;
    }
    .user-row.monitor-grid > div:nth-child(4)::before { display: none; }

    /* 5. ERRO (Centro) */
    .user-row.monitor-grid > div:nth-child(5) {
        grid-area: err;
        margin-bottom: 2px;
    }
    .user-row.monitor-grid > div:nth-child(5) .error-title {
        font-size: 0.95rem;
        margin-bottom: 2px;
    }
    /* Etiqueta do código pequena */
    .user-row.monitor-grid > div:nth-child(5) .error-code-tag {
        font-size: 9px;
        padding: 1px 4px;
        margin-top: 2px;
        border: none;
        background: #f5f5f5;
    }
    .user-row.monitor-grid > div:nth-child(5) .error-desc {
        font-size: 0.8rem;
        line-height: 1.3;
        white-space: normal;
        color: #666;
    }

    /* 6. AÇÕES (Botões) */
    .user-row.monitor-grid > div:nth-child(6) {
        grid-area: actions;
        margin-top: 8px;
        padding-top: 8px;
        border-top: 1px dashed #eee;
    }
    
    .btn-monitor {
        flex: 1;
        height: 36px;
        border-radius: 6px;
        /* Remove sombra excessiva no mobile */
        box-shadow: none;
        border: 1px solid transparent;
    }
    
    /* Borda sutil no botão view para contraste */
    .btn-monitor.view { border-color: #ddd; }
}
==================================================
CAMINHO: .\css\pages\os.css
==================================================
/* css/pages/os.css */

/* --- OVERRIDE DE LAYOUT (TELA CHEIA - DESKTOP) --- */
@media (min-width: 901px) {
    html body.layout-full-width #app-sidebar { display: none !important; }
    
    html body.layout-full-width #app-main {
        position: fixed !important;
        left: var(--gap-side) !important;
        right: var(--gap-side) !important;
        width: auto !important;
        top: calc(var(--header-height) + var(--gap-top)) !important;
        bottom: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        border-radius: 10px 10px 0 0 !important;
        z-index: 1;
    }
}

/* --- PAINEL DE DETALHES --- */
#os-detail-content {
    overflow-y: auto;
    flex: 1;
    height: 100%;
    padding: 20px 30px; 
    padding-bottom: 100px !important;
}

.detail-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    width: 100%;
    text-align: left;
}

.detail-item label {
    display: block;
    font-size: 11px;
    color: var(--text-muted);
    margin-bottom: 6px;
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: 0.5px;
}

.detail-item div {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-primary);
    padding: 10px 15px;
    background: var(--bg-body);
    border-radius: 8px;
    border: 1px solid var(--border-light);
    word-break: break-word; 
    line-height: 1.5;
}

.detail-full { grid-column: 1 / -1; }

.status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    color: white;
    font-size: 11px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* ==========================================================================
   MOBILE CARD LAYOUT (CORRIGIDO PARA SOLICITANTE/RESPONSÁVEL)
   ========================================================================== */

@media (max-width: 900px) {
    .table-header.os-grid { display: none !important; }
    
    .user-row.os-grid {
        display: grid !important;
        /* Colunas Base do Card */
        grid-template-columns: auto 1fr auto !important; 
        
        /* LAYOUT DO CARD:
           ------------------------------------------------
           Status(icon) | Solicitante (Nome)    | #ID
           ------------------------------------------------
           Equipamento (Grande e em Negrito)
           ------------------------------------------------
           Defeito (Descrição em Vermelho/Destaque)
           ------------------------------------------------
           Responsável: [Nome]      |      [Data Abertura]
           ------------------------------------------------
        */
        grid-template-areas: 
            "area-st    area-sol   area-id"
            "area-equip area-equip area-equip"
            "area-desc  area-desc  area-desc"
            "area-resp  area-resp  area-date";
            
        gap: 8px 10px;
        padding: 15px;
        border-bottom: 1px solid var(--border-medium);
        background-color: var(--bg-surface);
        margin-bottom: 10px; /* Espaço entre cards */
        border-radius: 8px;  /* Bordas arredondadas no mobile */
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        align-items: center;
    }

    /* 1. STATUS (Ícone) - Canto Superior Esquerdo */
    .os-grid .th-col:nth-child(1) { 
        grid-area: area-st;
        font-size: 18px;
        padding: 0;
    }

    /* 2. ID (#) - Canto Superior Direito */
    .os-grid .th-col:nth-child(2) { 
        grid-area: area-id;
        background: var(--bg-body); 
        border-radius: 6px;
        font-size: 11px; font-weight: bold; color: #666;
        padding: 2px 8px;
        justify-self: end; /* Alinha à direita */
        text-align: center;
    }

    /* 3. EQUIPAMENTO (Destaque Central) */
    .os-grid .th-col:nth-child(3) { 
        grid-area: area-equip;
        font-size: 15px; 
        font-weight: 700; 
        color: var(--brand-primary);
        white-space: normal !important;
        line-height: 1.3;
        margin-top: 5px;
    }

    /* 4. DEFEITO */
    .os-grid .th-col:nth-child(4) { 
        grid-area: area-desc;
        text-align: left !important;
        font-size: 13px; 
        color: var(--text-secondary);
        font-weight: 400;
        white-space: normal !important;
        margin-bottom: 5px;
    }

    /* 5. SOLICITANTE (Topo Centro/Esquerda) */
    .os-grid .th-col:nth-child(5) { 
        grid-area: area-sol;
        font-size: 13px; 
        font-weight: 600; 
        color: var(--text-primary);
        white-space: nowrap; 
        overflow: hidden; 
        text-overflow: ellipsis;
    }
    /* Adiciona ícone de usuário antes do nome */
    .os-grid .th-col:nth-child(5)::before {
        content: "\f007"; /* FontAwesome User Icon */
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        margin-right: 5px;
        color: #999;
        font-size: 11px;
    }

    /* 6. RESPONSÁVEL (Rodapé Esquerda) */
    .os-grid .th-col:nth-child(6) { 
        grid-area: area-resp;
        font-size: 11px; 
        color: #888;
        padding-top: 8px;
        border-top: 1px dashed #eee;
    }
    .os-grid .th-col:nth-child(6)::before {
        content: "Téc: ";
        font-weight: bold;
    }

    /* 7. SETOR (Ocultar no Card Mobile para economizar espaço) */
    .os-grid .th-col:nth-child(7) { display: none !important; }

    /* 8. DATA ABERTURA (Rodapé Direita) */
    .os-grid .th-col:nth-child(8) { 
        grid-area: area-date;
        font-size: 11px; 
        color: #999;
        text-align: right !important;
        padding-top: 8px;
        border-top: 1px dashed #eee;
    }

    /* 9. DATA FECHAMENTO (Ocultar) */
    .os-grid .th-col:nth-child(9) { display: none !important; }

    /* Backdrop mobile para detalhes */
    .os-mobile-backdrop { display: none; }
    .split-container.show-detail .os-mobile-backdrop {
        display: block; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: var(--bg-overlay); z-index: 4999;
    }
}
==================================================
CAMINHO: .\css\pages\setores.css
==================================================
/* css/pages/setores.css */

/* --- LISTA DENTRO DO MODAL (ESTILO LIMPO) --- */
.modal-list {
    max-height: 350px;
    overflow-y: auto;
    margin-top: 15px;
    background-color: #fff;
    border: 1px solid var(--border-light);
    border-radius: 8px;
}

.modal-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    border-bottom: 1px solid #f0f0f0;
    transition: background 0.1s;
}

.modal-item:last-child {
    border-bottom: none;
}

.modal-item:hover {
    background-color: #f9f9f9;
}

/* Texto do item */
.modal-item strong {
    display: block;
    color: var(--text-primary);
    font-size: 14px;
    margin-bottom: 2px;
}

.modal-item small {
    color: #888;
    font-size: 12px;
}

/* --- BOTÕES DE AÇÃO (Lado Direito) --- */
.modal-item-actions {
    display: flex;
    gap: 8px;
    align-items: center;
}

.btn-icon-sm {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    color: white;
    font-size: 14px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Botão Editar (Verde Água / Azul) */
.btn-icon-sm.edit {
    background-color: var(--brand-active);
}
.btn-icon-sm.edit:hover {
    background-color: var(--brand-hover-dark);
    transform: translateY(-1px);
}

/* Botão Excluir (Vermelho) */
.btn-icon-sm.delete {
    background-color: var(--status-error);
}
.btn-icon-sm.delete:hover {
    background-color: #cc0000;
    transform: translateY(-1px);
}

/* --- CAIXA DE EDIÇÃO (Formulário Interno) --- */
.edit-form-box {
    margin-top: 20px;
    padding: 20px;
    background-color: #f8f9fa;
    border: 1px dashed #ccc;
    border-radius: 8px;
    animation: fadeIn 0.3s ease;
}

.edit-form-box h5 {
    margin: 0 0 15px 0;
    color: var(--text-secondary);
    font-size: 13px;
    text-transform: uppercase;
    font-weight: bold;
    border-bottom: 1px solid #e0e0e0;
    padding-bottom: 5px;
}

.edit-form-box input {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
    background: white;
}

.edit-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 10px;
}
==================================================
CAMINHO: .\css\pages\usuarios.css
==================================================
/* Garante que a tabela de usuários ocupe toda a altura disponível do Main */
#users-list {
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
}

/* Se quiser customizar especificamente a linha de usuários (ex: cursor diferente) */
.user-row {
    cursor: pointer;
}

/* Ajuste específico para o Empty State desta página, se necessário */
#empty-state {
    margin-top: 50px;
}
==================================================
CAMINHO: .\js\database.js
==================================================
/* js/database.js */

// 1. Árvore de Navegação
export const treeStructure = [
    {
        name: "Crateús",
        children: [
            { name: "UFC", children: ["Ciência da Computação", "Sistemas de Informação", "Engenharia Civil", "Secretaria Acadêmica", "CEO of S.E.X"] },
            { name: "Prefeitura", children: ["Gabinete", "Finanças", "Obras", "Saúde"] }
        ]
    },
    {
        name: "Ipu",
        children: [
            { name: "Wolga", children: ["Financeiro", "Logística", "Produção", "Vendas"] },
            { name: "Hospital Municipal", children: ["Recepção", "Emergência", "Administração"] }
        ]
    }
];

const fakeAddresses = [
    "Bloco Administrativo, Sala 101", "1º Andar, Sala 05", "Prédio Anexo, Sala 3", 
    "Bloco Didático, Lab 02", "Recepção Principal", "Galpão B", "Sala de Reuniões 04"
];

// --- 1. FUNÇÃO MÁGICA: Converte Árvore Hierárquica em Tabela de Banco ---
// Isso garante que o banco tenha EXATAMENTE o que está na árvore
// --- CORREÇÃO AQUI: Adiciona 'localizacao' aos setores ---
export const getFlatSectorsForDB = () => {
    const flatList = [];
    let idCounter = 1;

    treeStructure.forEach(city => {
        city.children.forEach(company => {
            if (Array.isArray(company.children)) {
                company.children.forEach((sectorName, index) => {
                    flatList.push({
                        id: (idCounter++).toString(),
                        nome: sectorName,
                        empresa: company.name,
                        cidade: city.name,
                        // Gera um endereço fixo baseado no índice para não mudar sempre
                        localizacao: fakeAddresses[index % fakeAddresses.length], 
                        observacao: "Gerado automaticamente pelo sistema."
                    });
                });
            }
        });
    });
    return flatList;
};

// Helper antigo (apenas nomes) - mantido para compatibilidade se algo usar
const getAllSectors = () => {
    return getFlatSectorsForDB().map(s => s.nome);
};

const sectorsList = getAllSectors();
const types = ["Administrador", "Técnico", "Usuário Comum"];
const models = [
    // Dell
    "Dell OptiPlex 3050", "Dell OptiPlex 3080", "Dell OptiPlex 3090", "Dell OptiPlex 5000",
    "Dell Latitude 5420", "Dell Latitude 5430", "Dell Latitude 5440", "Dell Latitude 3520",
    "Dell Vostro 3400", "Dell Vostro 3510",

    // Lenovo
    "Lenovo ThinkPad E14", "Lenovo ThinkPad E15", "Lenovo ThinkPad L14", "Lenovo ThinkPad L15",
    "Lenovo ThinkCentre M70q", "Lenovo ThinkCentre M80s",

    // HP
    "HP ProDesk 600", "HP ProDesk 400", "HP EliteDesk 800",
    "HP ProBook 440 G8", "HP ProBook 450 G9", "HP EliteBook 840 G8",

    // Positivo
    "Positivo Master", "Positivo Motion C", "Positivo Vision R15",

    // Outros
    "Acer Veriton M200", "Acer Aspire 5", "ASUS VivoBook 15"
];

const printerModels = [
    // HP
    "HP LaserJet Pro M404dw", "HP LaserJet Pro M428fdw",
    "HP LaserJet MFP M135w", "HP LaserJet P1102w",

    // Epson
    "Epson EcoTank L3250", "Epson EcoTank L4260", "Epson EcoTank L6270",
    "Epson EcoTank M2170",

    // Brother
    "Brother HL-L2360DW", "Brother HL-L2370DW",
    "Brother DCP-L2540DW", "Brother MFC-L2750DW",

    // Kyocera
    "Kyocera ECOSYS P2040dn", "Kyocera ECOSYS M2040dn",

    // Canon
    "Canon imageCLASS MF264dw", "Canon imageCLASS LBP6030w"
];

const names = [
    "Jonathan Joestar", "Joseph Joestar", "Jotaro Kujo", "Josuke Higashikata", "Giorno Giovanna", 
    "Dio Brando", "Kars", "Yoshikage Kira", "Diavolo", "Enrico Pucci", 
    "Robert Speedwagon", "Will Zeppeli", "Lisa Lisa", "Koichi Hirose", "Rohan Kishibe",
    "Bruno Bucciarati", "Guido Mista", "Narancia Ghirga",

    // Hunter x Hunter
    "Gon Freecss", "Killua Zoldyck", "Kurapika", "Leorio Paradinight",
    "Hisoka Morow", "Isaac Netero", "Biscuit Krueger", "Wing", "Zushi",
    "Kite", "Knuckle Bine", "Shoot McMahon", "Morel Mackernasey",
    "Palm Siberia", "Ikalgo", "Meleoron",
    "Chrollo Lucilfer", "Feitan Portor", "Phinks Magcub", "Nobunaga Hazama",
    "Machi Komacine", "Franklin Bordeau", "Shalnark", "Pakunoda",
    "Kortopi", "Uvogin", "Bonolenov Ndongo", "Kalluto Zoldyck",
    "Illumi Zoldyck", "Milluki Zoldyck", "Silva Zoldyck", "Zeno Zoldyck",
    "Alluka Zoldyck", "Nanika",
    "Meruem", "Neferpitou", "Shaiapouf", "Menthuthuyoupi",
    "Komugi", "Colt", "Reina",
    "Pariston Hill", "Ging Freecss", "Beyond Netero",
    "Cheadle Yorkshire", "Mizaistom Nana", "Botobai Gigante",
    "Kanzai", "Saccho Kobayakawa",

    // Fullmetal Alchemist: Brotherhood
    "Edward Elric", "Alphonse Elric", "Winry Rockbell", "Pinako Rockbell",
    "Roy Mustang", "Riza Hawkeye", "Maes Hughes", "Gracia Hughes", "Elicia Hughes",
    "Jean Havoc", "Heymans Breda", "Vato Falman", "Kain Fuery",
    "Alex Louis Armstrong", "Olivier Mira Armstrong",
    "Scar", "Scar's Brother",
    "Ling Yao", "Lan Fan", "Fu",
    "May Chang", "Xiao-Mei",
    "Van Hohenheim", "Trisha Elric",
    "King Bradley", "Mrs. Bradley (Selim's mother)",
    "Selim Bradley (Pride)", "Father",
    "Lust", "Gluttony", "Envy", "Greed", "Greed (Ling)", "Sloth", "Wrath", "Pride",
    "Izumi Curtis", "Sig Curtis",
    "Shou Tucker", "Nina Tucker",
    "Yoki",
    "Maria Ross", "Denny Brosh",
    "Basque Grand",
    "Buccaneer",
    "Tim Marcoh",
    "Solf J. Kimblee",

    // Frieren: Beyond Journey’s End
    "Frieren", "Fern", "Stark",
    "Himmel", "Heiter", "Eisen",
    "Flamme",
    "Aura the Guillotine", "Lügner", "Linie", "Draht",
    "Denken", "Laufen", "Richter",
    "Wirbel", "Ehre", "Scharf",
    "Übel", "Land",
    "Serie",
    "Sense",
    "Falsch",
    "Revolte",
    "Grausam",
    "Macht",
    "Böse",
    "Tot"
];

// --- FUNÇÃO GERADORA DE CPF VÁLIDO (Matemática) ---
function gerarCpfValido() {
    const rnd = (n) => Math.round(Math.random() * n);
    const mod = (dividend, divisor) => Math.round(dividend - (Math.floor(dividend / divisor) * divisor));

    const n1 = rnd(9); const n2 = rnd(9); const n3 = rnd(9);
    const n4 = rnd(9); const n5 = rnd(9); const n6 = rnd(9);
    const n7 = rnd(9); const n8 = rnd(9); const n9 = rnd(9);

    let d1 = n9 * 2 + n8 * 3 + n7 * 4 + n6 * 5 + n5 * 6 + n4 * 7 + n3 * 8 + n2 * 9 + n1 * 10;
    d1 = 11 - (mod(d1, 11));
    if (d1 >= 10) d1 = 0;

    let d2 = d1 * 2 + n9 * 3 + n8 * 4 + n7 * 5 + n6 * 6 + n5 * 7 + n4 * 8 + n3 * 9 + n2 * 10 + n1 * 11;
    d2 = 11 - (mod(d2, 11));
    if (d2 >= 10) d2 = 0;

    return `${n1}${n2}${n3}.${n4}${n5}${n6}.${n7}${n8}${n9}-${d1}${d2}`;
}

// --- 1. USUÁRIOS FIXOS (Para Teste) ---
export const usersData = [
    {
        id: "1",
        nome: "Edward Elric",
        cpf: "277.304.900-48",
        senha: "123",
        tipo: "Administrador",
        setor: "Ciência da Computação"
    },
    {
        id: "2",
        nome: "Alphonse Elric",
        cpf: "693.082.880-74",
        senha: "123",
        tipo: "Técnico",
        setor: "Sistemas de Informação"
    },
    {
        id: "3",
        nome: "Roy Mustang",
        cpf: "486.051.580-34",
        senha: "123",
        tipo: "Usuário Comum",
        setor: "Secretaria Acadêmica"
    },
    {
        id: "4",
        nome: "Sicrano Fulano Beltrano Alano Mengano Zutano Citano Perengano",
        cpf: "080.572.663-25",
        senha: "123",
        tipo: "Administrador",
        setor: "CEO of S.E.X"
    }
];

// --- 2. GERAR MAIS 50 USUÁRIOS ALEATÓRIOS ---
for (let i = 0; i < 100; i++) {
    const name = names[i % names.length] + (i >= names.length ? ` ${Math.floor(i/names.length)}` : "");
    const tipo = types[i % 3]; // Alterna entre os 3 tipos
    
    usersData.push({
        id: (i + 5).toString(), // Começa do ID 4
        nome: name,
        cpf: gerarCpfValido(), // Gera CPF real para passar na validação
        senha: "123",
        tipo: tipo,
        setor: sectorsList[i % sectorsList.length]
    });
}

// --- 3. GERAR EQUIPAMENTOS ---
export const equipmentsData = [];

// Gera computadores para a maioria dos usuários (incluindo os fixos e os aleatórios)
usersData.forEach((user, index) => {
    // Pula alguns para variar (a cada 5, um não tem PC)
    if (index % 5 === 0 && index > 2) return; 
    
    const pcId = `C${index + 1}`;
    
    equipmentsData.push({
        id: pcId,
        tipo: "computador",
        serie: `PC-${1000 + index}`,
        modelo: models[index % models.length],
        usuario: user.nome,
        status: index % 7 === 0 ? "Offline" : "Online",
        setor: user.setor,
        contador: "-",
        tonel: "-",
        error: index % 15 === 0 ? "Erro de Disco" : null,
        connectedTo: null
    });
});

// Gera Impressoras (algumas conectadas aos PCs gerados)
for (let i = 0; i < 50; i++) {
    const parentPC = equipmentsData[Math.floor(Math.random() * equipmentsData.length)];
    
    equipmentsData.push({
        id: `P${i + 1}`,
        tipo: "impressora",
        serie: `PRT-${5000 + i}`,
        modelo: printerModels[i % printerModels.length],
        usuario: "Compartilhado",
        status: i % 4 === 0 ? "Offline" : "Online",
        setor: sectorsList[i % sectorsList.length],
        contador: (Math.floor(Math.random() * 50000)) + " pgs",
        tonel: (Math.floor(Math.random() * 100)) + "%",
        error: i % 10 === 0 ? "Sem Papel" : null,
        connectedTo: parentPC ? parentPC.id : null
    });
}

// --- DEBUG NO CONSOLE ---
console.groupCollapsed("%c🔑 CREDENCIAIS FIXAS", "color: #4FD1C5; background: #333; padding: 4px; border-radius: 4px;");
console.log("Admin:   277.304.900-48");
console.log("Técnico: 693.082.880-74");
console.log("Comum:   486.051.580-34");
console.groupEnd();
==================================================
CAMINHO: .\js\utils.js
==================================================
/* js/utils.js - Corrigido para Renderizar Ícones Corretamente */

// 1. Formatadores Puros (Texto)
export const Formatters = {
    date: (val) => val ? new Date(val).toLocaleDateString('pt-BR') : '-',
    dateTime: (val) => val ? new Date(val).toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', year: '2-digit', hour: '2-digit', minute: '2-digit' }) : '-',
    cpf: (v) => v ? v.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4') : '-'
};

// 2. Fábrica de Elementos DOM
export class DOMUtils {
    static create(tag, attrs = {}, content = null) {
        const el = document.createElement(tag);
        
        // Atributos e Eventos
        Object.entries(attrs).forEach(([key, value]) => {
            if (value === undefined || value === null) return;
            
            if (key.startsWith('on') && typeof value === 'function') {
                el.addEventListener(key.substring(2).toLowerCase(), value);
            } else if (key === 'className') {
                el.className = value;
            } else if (key === 'style' && typeof value === 'object') {
                Object.assign(el.style, value);
            } else if (key === 'dataset' && typeof value === 'object') {
                Object.assign(el.dataset, value);
            } else {
                el.setAttribute(key, value);
            }
        });

        // Conteúdo (A CORREÇÃO ESTÁ AQUI)
        if (content !== null && content !== undefined) {
            if (Array.isArray(content)) {
                content.forEach(child => {
                    if (child instanceof Node) {
                        el.appendChild(child);
                    } else if (child !== null && child !== undefined) {
                        // Se for string/HTML em array, insere como HTML
                        el.insertAdjacentHTML('beforeend', String(child));
                    }
                });
            } else if (content instanceof Node) {
                el.appendChild(content);
            } else {
                // Se for string simples, usa innerHTML para renderizar as tags <i>
                el.innerHTML = String(content);
            }
        }
        
        return el;
    }
}

// 3. Renderizadores Visuais Inteligentes
export const SmartRenderers = {
    // Texto Simples
    text: (val) => val || '-',
    
    // Datas
    date: (val) => Formatters.date(val),
    datetime: (val) => Formatters.dateTime(val),
    
    // Ícone de Tipo (Computador, Impressora, Usuário)
    icon: (val) => {
        const map = {
            'computador': 'fa-laptop', 'impressora': 'fa-print',
            'administrador': 'fa-user-shield', 'técnico': 'fa-user-cog', 
            'comum': 'fa-user', 'usuário comum': 'fa-user'
        };
        const iconClass = map[(val || '').toLowerCase()] || 'fa-question';
        // Retorna string HTML para o DOMUtils processar via innerHTML
        return `<i class="fas ${iconClass}" title="${val}" style="color: #555;"></i>`;
    },

    // Status Colorido
    status: (val) => {
        if (!val) return '-';
        const lower = val.toLowerCase();
        let color = 'var(--text-primary)';
        if (['online', 'ativo', 'concluído', 'fechado'].includes(lower)) color = 'var(--status-success)';
        if (['offline', 'inativo', 'aberto', 'pendente'].includes(lower)) color = 'var(--status-error)';
        return `<span style="color: ${color}; font-weight: bold;">${val}</span>`;
    },

    // Badges (Etiquetas de Log)
    badge: (val) => {
        if (!val) return '-';
        const map = {
            'CREATE': 'create', 'UPDATE': 'update', 'DELETE': 'delete', 'LOGIN': 'login',
            'ADMINISTRADOR': 'login', 'TÉCNICO': 'update', 'USUÁRIO COMUM': 'bg-disabled'
        };
        const cls = map[val.toUpperCase()] || 'login';
        return `<span class="badge ${cls}">${val}</span>`;
    },

    // Erro (Ícone + Texto Vermelho)
    error: (val) => {
        if (!val) return '';
        return `<div style="display:flex; align-items:center; gap:6px; color:var(--status-error);">
                    <i class="fas fa-exclamation-circle"></i> <span style="font-weight:500; font-size:12px;">${val}</span>
                </div>`;
    }
};

// Funções utilitárias de UI
export function showEmptyState(container, listId, icon = 'fa-box-open', message = 'Nada encontrado') {
    container.innerHTML = `<div style="text-align:center; padding:40px; color:var(--text-muted);"><i class="fas ${icon}" style="font-size:40px; margin-bottom:15px; opacity:0.3;"></i><p>${message}</p></div>`;
    container.classList.remove('hidden');
    if(document.getElementById(listId)) document.getElementById(listId).classList.add('hidden');
}

export function hideEmptyState(container, listId) {
    container.classList.add('hidden');
    container.innerHTML = '';
    if(document.getElementById(listId)) document.getElementById(listId).classList.remove('hidden');
}

export function debounce(func, wait) {
    let timeout;
    return function(...args) { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), wait); };
}
==================================================
CAMINHO: .\js\components\header.js
==================================================
/* js/components/header.js */
import { ROUTES } from '../services/navigation.service.js';
import { DOMUtils } from '../utils.js'; 
import { AuthService } from '../services/auth.service.js'; 

export class HeaderComponent {
    constructor(containerId) {
        this.container = document.getElementById(containerId);
        this.activePage = 'users';
        this.onResetCallback = null;
    }

    render(onResetCallback, activePage = 'users') {
        this.onResetCallback = onResetCallback;
        this.activePage = activePage;
        
        // 1. Gera os itens de navegação baseados no usuário
        const navContent = this._generateNavContent();

        // 2. Renderiza a estrutura do Header
        this.container.innerHTML = `
            <div class="header-left">
                <button class="btn-mobile-toggle" id="btn-menu-toggle"><i class="fas fa-bars"></i></button>
                <div class="logo-circle" id="btn-logo" title="Ir para Menu Principal"></div>
                
                <nav class="nav-menu">
                    ${navContent}
                </nav>

                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Pesquisar..." autocomplete="off">
                    <i class="fas fa-times search-close-btn" id="btn-close-search" title="Fechar"></i>
                </div>
            </div>
            
            <div class="header-right">
                <button id="btn-logout-header" class="btn-action" title="Sair" style="color: white; border: 1px solid rgba(255,255,255,0.3); margin-right: 10px;">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
                <div id="header-actions" style="display:flex; gap:10px;"></div>
            </div>
        `;

        // 3. Inicializa eventos e botões
        this._bindEvents();
        this.updateButtons('default');
    }

    // Helper para gerar HTML dos links
    _generateNavContent() {
        const user = AuthService.getUser();
        const isCommonUser = user && (user.tipo === 'Comum' || user.tipo === 'Usuário Comum');
        
        const getClass = (page) => this.activePage === page ? 'active' : '';
        const createLink = (route, pageName, icon, label) => 
            `<a href="${route}" class="nav-item ${getClass(pageName)}"><i class="fas ${icon}"></i> ${label}</a>`;

        if (isCommonUser) {
            return createLink(ROUTES.USER_PANEL, 'history', 'fa-history', 'Histórico');
        }

        // Menu Admin/Técnico - ORDEM ATUALIZADA
        // 1. Visão Geral (Dashboard)
        // 2. NOC (Monitoramento)
        // 3. Equipamento
        // 4. O.S.
        // 5. Usuários
        // 6. Setores
        // 7. Log
        return `
            ${createLink(ROUTES.DASHBOARD, 'dashboard', 'fa-chart-pie', 'Visão Geral')}
            ${createLink(ROUTES.MONITORING, 'monitoramento', 'fa-heartbeat', 'NOC')}
            ${createLink(ROUTES.EQUIPMENT_LIST, 'equipment', 'fa-laptop', 'Equipamento')}
            ${createLink(ROUTES.OS_LIST, 'os', 'fa-tools', 'O.S.')}
            ${createLink(ROUTES.USERS_LIST, 'users', 'fa-users', 'Usuários')}
            ${createLink(ROUTES.SECTORS_LIST, 'sectors', 'fa-layer-group', 'Setores')}
            ${createLink(ROUTES.LOGS_LIST, 'logs', 'fa-history', 'Log')}
        `;
    }

    _bindEvents() {
        const btnLogo = this.container.querySelector('#btn-logo');
        if (btnLogo) btnLogo.onclick = this.onResetCallback;

        const btnLogout = this.container.querySelector('#btn-logout-header');
        if (btnLogout) btnLogout.onclick = () => AuthService.logout();

        // Toggle Sidebar Mobile
        const btnMenu = this.container.querySelector('#btn-menu-toggle');
        if (btnMenu) {
            btnMenu.onclick = (e) => {
                e.stopPropagation();
                document.getElementById('app-sidebar')?.classList.toggle('sidebar-open');
                document.body.classList.toggle('menu-active');
            };
        }

        // Toggle Pesquisa
        const closeSearch = this.container.querySelector('#btn-close-search');
        if (closeSearch) {
            closeSearch.onclick = (e) => {
                e.preventDefault();
                this.toggleSearchMode(false);
                const input = this.container.querySelector('#search-input');
                if (input) {
                    input.value = '';
                    input.dispatchEvent(new Event('input'));
                }
                if (this.onResetCallback) this.onResetCallback();
            };
        }

        // Fechar menu ao clicar fora
        document.addEventListener('click', (e) => {
            if (document.body.classList.contains('menu-active') && 
                !document.getElementById('app-sidebar').contains(e.target) && 
                !e.target.closest('#btn-menu-toggle')) {
                
                document.getElementById('app-sidebar')?.classList.remove('sidebar-open');
                document.body.classList.remove('menu-active');
            }
        });
    }

    toggleSearchMode(active) {
        if (active) {
            document.body.classList.add('search-mode');
            setTimeout(() => this.container.querySelector('#search-input')?.focus(), 50);
        } else {
            document.body.classList.remove('search-mode');
        }
    }

    updateButtons(state) {
        const container = this.container.querySelector('#header-actions');
        if (!container) return;
        container.innerHTML = ''; 

        const createBtn = (id, icon, title, onClick) => {
            return DOMUtils.create('button', {
                id: id, className: 'btn-action', title: title, onclick: onClick
            }, `<i class="${icon}"></i>`);
        };

        const buttons = [];

        // Definição das ações para cada estado
        const actions = {
            back: () => {
                if (document.body.classList.contains('search-mode')) this.toggleSearchMode(false);
                else if (this.onResetCallback) this.onResetCallback();
            },
            search: () => this.toggleSearchMode(true)
        };

        // --- LÓGICA DE ESTADOS ---

        // 1. DASHBOARD (NOVO): Sem botões de ação, apenas Logout (que já é fixo no HTML)
        if (state === 'dashboard') {
            // Não adiciona nada ao array buttons
        }
        // 2. LISTAS PADRÃO
        else if (state === 'default' || state === 'sectorSelected') {
            buttons.push(createBtn('btn-back', 'fas fa-arrow-left', 'Voltar', actions.back));
            buttons.push(createBtn('btn-search-trigger', 'fas fa-search', 'Pesquisar', actions.search));
            buttons.push(createBtn('btn-add', 'fas fa-plus', 'Adicionar', null)); 
        } 
        // 3. ITEM SELECIONADO
        else if (state === 'userSelected') {
            buttons.push(createBtn('btn-back', 'fas fa-arrow-left', 'Voltar', actions.back));
            buttons.push(createBtn('btn-search-trigger', 'fas fa-search', 'Pesquisar', actions.search));
            buttons.push(createBtn('btn-edit', 'fas fa-pen', 'Alterar', null));
            buttons.push(createBtn('btn-delete', 'fas fa-trash', 'Excluir', null));
        }
        // 4. APENAS VOLTAR
        else if (state === 'only-back') {
            buttons.push(createBtn('btn-back', 'fas fa-arrow-left', 'Voltar', () => {
                if (this.onResetCallback) this.onResetCallback();
            }));
        }
        // 5. O.S. SELECIONADA
        else if (state === 'osSelected') {
            buttons.push(createBtn('btn-back', 'fas fa-arrow-left', 'Voltar', () => {
                if (this.onResetCallback) this.onResetCallback();
            }));
            buttons.push(createBtn('btn-status', 'fas fa-check-circle', 'Concluir/Reabrir', null));
            buttons.push(createBtn('btn-edit', 'fas fa-pen', 'Alterar', null));
            buttons.push(createBtn('btn-delete', 'fas fa-trash', 'Excluir', null));
        }

        buttons.forEach(btn => container.appendChild(btn));
    }
}
==================================================
CAMINHO: .\js\components\inputs.js
==================================================
/* js/components/inputs.js */

// 1. MÁSCARAS
export const masks = {
    cpf(v) { return v.replace(/\D/g,'').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d{1,2})/,'$1-$2').replace(/(-\d{2})\d+?$/,'$1'); },
    serial(v) { return v.toUpperCase().replace(/[^A-Z0-9-]/g, ''); }
};

export function setupInputMasks() {
    document.querySelectorAll('[data-mask]').forEach(input => {
        const type = input.dataset.mask;
        if(masks[type]) {
            input.addEventListener('input', (e) => {
                e.target.value = masks[type](e.target.value);
            });
        }
    });
}

// 2. VALIDATORS (Regras de Negócio)
export const Validators = {
    required: (value) => !!value && value.trim().length > 0,
    minLength: (value, min) => value.length >= min,
    email: (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email),
    
    cpf: (cpf) => {
        cpf = cpf.replace(/\D/g, '');
        if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
        let soma = 0, resto;
        for (let i = 1; i <= 9; i++) soma += parseInt(cpf.substring(i-1, i)) * (11 - i);
        resto = (soma * 10) % 11;
        if ((resto === 10) || (resto === 11)) resto = 0;
        if (resto !== parseInt(cpf.substring(9, 10))) return false;
        soma = 0;
        for (let i = 1; i <= 10; i++) soma += parseInt(cpf.substring(i-1, i)) * (12 - i);
        resto = (soma * 10) % 11;
        if ((resto === 10) || (resto === 11)) resto = 0;
        if (resto !== parseInt(cpf.substring(10, 11))) return false;
        return true;
    }
};

// 3. INPUT MANAGER (NOVO - Reduz código repetido de UI)
export class InputManager {
    
    /**
     * Define erro visual no campo
     * @param {HTMLElement|string} inputOrId - O elemento input ou seu ID
     * @param {string} message - Mensagem de erro
     */
    static setError(inputOrId, message) {
        const input = typeof inputOrId === 'string' ? document.getElementById(inputOrId) : inputOrId;
        if (!input) return;

        // Pinta a borda
        input.style.borderColor = "var(--status-error)";

        // Tenta achar o span de erro associado
        // Convenção 1: ID específico "erro-{idDoInput}"
        let errorSpan = document.getElementById(`erro-${input.id}`);
        
        // Convenção 2: Span irmão dentro do mesmo grupo
        if (!errorSpan && input.parentElement) {
            errorSpan = input.parentElement.querySelector('.erro-msg, span[id^="erro-"]');
        }

        // Se não achar, procura no pai do pai (caso tenha wrappers de ícone)
        if (!errorSpan && input.parentElement.parentElement) {
            errorSpan = input.parentElement.parentElement.querySelector(`#erro-${input.id}`);
        }

        if (errorSpan) {
            errorSpan.innerText = message;
            errorSpan.style.display = 'block';
            errorSpan.style.color = "var(--status-error)";
        }
    }

    /**
     * Limpa erro visual
     */
    static clearError(inputOrId) {
        const input = typeof inputOrId === 'string' ? document.getElementById(inputOrId) : inputOrId;
        if (!input) return;

        input.style.borderColor = ""; // Volta ao original (CSS trata)
        
        let errorSpan = document.getElementById(`erro-${input.id}`);
        if (!errorSpan && input.parentElement) {
            errorSpan = input.parentElement.querySelector('.erro-msg, span[id^="erro-"]');
        }
        if (!errorSpan && input.parentElement.parentElement) {
            errorSpan = input.parentElement.parentElement.querySelector(`#erro-${input.id}`);
        }

        if (errorSpan) errorSpan.innerText = "";
    }

    /**
     * Limpa todos os erros de um formulário
     */
    static clearAllErrors(formElement) {
        const inputs = formElement.querySelectorAll('input, select, textarea');
        inputs.forEach(input => this.clearError(input));
    }
}
==================================================
CAMINHO: .\js\components\modal.js
==================================================
/* js/components/modal.js */
import { DOMUtils } from '../utils.js';

class ModalComponent {
    constructor() {
        this.modalId = 'app-generic-modal';
        this.overlay = null;
        this.titleEl = null;
        this.textEl = null;
        this.inputEl = null; // Novo campo de input
        this.cancelBtn = null;
        this.confirmBtn = null;
        this.onConfirm = null;
        
        this._build();
    }

    _build() {
        if (document.getElementById(this.modalId)) return;

        // Criação dos Elementos
        this.titleEl = DOMUtils.create('div', { className: 'modal-title' });
        this.textEl = DOMUtils.create('div', { className: 'modal-text' });
        
        // Input (escondido por padrão)
        this.inputEl = DOMUtils.create('input', { 
            type: 'text', 
            className: 'custom-input modal-input',
            style: 'display:none; margin-bottom: 20px;' 
        });

        this.cancelBtn = DOMUtils.create('button', { className: 'btn-modal btn-cancel' }, 'Cancelar');
        this.confirmBtn = DOMUtils.create('button', { className: 'btn-modal btn-confirm' }, 'Confirmar');

        const actions = DOMUtils.create('div', { className: 'modal-actions' }, [
            this.cancelBtn, 
            this.confirmBtn
        ]);

        const box = DOMUtils.create('div', { className: 'modal-box' }, [
            this.titleEl, 
            this.textEl, 
            this.inputEl,
            actions
        ]);

        this.overlay = DOMUtils.create('div', { 
            id: this.modalId, 
            className: 'modal-overlay' 
        }, box);

        document.body.appendChild(this.overlay);

        // Eventos
        this.cancelBtn.onclick = () => this.close();
        
        this.confirmBtn.onclick = () => {
            const value = this.inputEl.value.trim();
            this.close();
            if (this.onConfirm) this.onConfirm(value);
        };

        // Confirmar com Enter no input
        this.inputEl.onkeyup = (e) => {
            if (e.key === 'Enter') this.confirmBtn.click();
        };
    }

    // Modal de Confirmação Simples (Sim/Não)
    openConfirm(title, message, onConfirm) {
        this._reset();
        this.titleEl.innerHTML = title;
        this.textEl.innerHTML = message;
        this.inputEl.style.display = 'none';
        this.onConfirm = onConfirm;
        this.show();
    }

    // Modal de Input (Prompt)
    openInput(title, placeholder, onConfirm) {
        this._reset();
        this.titleEl.innerText = title;
        this.textEl.innerHTML = ''; // Sem texto descritivo, apenas o título
        
        this.inputEl.style.display = 'block';
        this.inputEl.placeholder = placeholder || '';
        this.inputEl.value = '';
        
        this.onConfirm = onConfirm;
        this.show();
        
        // Foca no input assim que abrir
        setTimeout(() => this.inputEl.focus(), 100);
    }

    _reset() {
        this.onConfirm = null;
    }

    show() {
        this.overlay.classList.add('active');
    }

    close() {
        this.overlay.classList.remove('active');
    }
}

const modalInstance = new ModalComponent();

// Exporta as funções facilitadoras
export function showConfirmModal(title, message, onConfirm) {
    modalInstance.openConfirm(title, message, onConfirm);
}

export function showInputModal(title, placeholder, onConfirm) {
    modalInstance.openInput(title, placeholder, onConfirm);
}
==================================================
CAMINHO: .\js\components\search.js
==================================================
import { debounce } from '../utils.js';

/**
 * Configura o listener de busca com Debounce (Performance)
 */
export function setupGenericSearch(inputId, dataGetter, fieldsToSearch, renderCallback) {
    const searchInput = document.getElementById(inputId);
    if (!searchInput) return;

    // Função de filtragem real
    const performSearch = (term) => {
        const currentData = dataGetter();
        
        if (!term) {
            renderCallback(currentData); // Se vazio, mostra tudo
            return;
        }

        const lowerTerm = term.toLowerCase();
        
        const filtered = currentData.filter(item => {
            return fieldsToSearch.some(field => {
                const val = item[field];
                return val && val.toString().toLowerCase().includes(lowerTerm);
            });
        });

        renderCallback(filtered);
    };

    // Cria versão "atrasada" da função (espera 300ms parar de digitar)
    const debouncedSearch = debounce((e) => {
        performSearch(e.target.value);
    }, 300);

    // Usa keyup ou input
    searchInput.addEventListener('input', debouncedSearch);
}
==================================================
CAMINHO: .\js\components\sidebar.js
==================================================
/* js/components/sidebar.js */
import { ROUTES, NavigationService } from '../services/navigation.service.js';
import { DOMUtils } from '../utils.js';

export class SidebarComponent {
    constructor(containerId) {
        this.container = document.getElementById(containerId);
        this.currentSelection = null;
    }

    render(data, onSelectCallback) {
        if (!this.container) return;
        this.container.innerHTML = '';

        // 1. Navegação Mobile (Prioridade)
        this.container.appendChild(this._createMobileNav());

        // 2. Renderiza a Árvore de Setores (Desktop)
        if (data && Array.isArray(data) && data.length > 0) {
            const treeUl = DOMUtils.create('ul');
            this._buildTree(data, treeUl, onSelectCallback);
            this.container.appendChild(treeUl);
        } else if (data) {
            this.container.appendChild(DOMUtils.create('div', { 
                style: { padding: '15px', color: '#888', textAlign: 'center', fontSize: '13px' } 
            }, 'Nenhum setor encontrado.'));
        }

        // 3. Rodapé de Administração
        this._injectAdminFooter();
    }

    _createMobileNav() {
        // Verifica rotas ativas
        const isPage = (routeList) => {
            if (Array.isArray(routeList)) return routeList.some(r => NavigationService.isCurrentPage(r));
            return NavigationService.isCurrentPage(routeList);
        };

        const createItem = (label, icon, route, isActive) => {
            return DOMUtils.create('li', {
                style: isActive ? { color: 'var(--brand-active)', backgroundColor: 'var(--brand-hover-light)', fontWeight: 'bold' } : {},
                onclick: () => {
                    document.getElementById('app-sidebar')?.classList.remove('sidebar-open');
                    document.body.classList.remove('menu-active');
                    if (route) NavigationService.navigate(route);
                }
            }, `<i class="${icon}"></i> ${label}`);
        };

        // --- ORDEM ATUALIZADA (Igual ao Desktop) ---
        return DOMUtils.create('ul', { className: 'sidebar-mobile-nav' }, [
            createItem('Visão Geral', 'fas fa-chart-pie', ROUTES.DASHBOARD, isPage(ROUTES.DASHBOARD)),
            createItem('NOC / Monitoramento', 'fas fa-heartbeat', ROUTES.MONITORING, isPage(ROUTES.MONITORING)),
            createItem('Equipamento', 'fas fa-laptop', ROUTES.EQUIPMENT_LIST, isPage([ROUTES.EQUIPMENT_LIST, ROUTES.EQUIPMENT_FORM])),
            createItem('O.S.', 'fas fa-tools', ROUTES.OS_LIST, isPage([ROUTES.OS_LIST, ROUTES.OS_FORM])),
            createItem('Usuários', 'fas fa-users', ROUTES.USERS_LIST, isPage([ROUTES.USERS_LIST, ROUTES.USERS_FORM])),
            createItem('Setores', 'fas fa-layer-group', ROUTES.SECTORS_LIST, isPage([ROUTES.SECTORS_LIST, ROUTES.SECTORS_FORM])),
            createItem('Log', 'fas fa-history', ROUTES.LOGS_LIST, isPage(ROUTES.LOGS_LIST)),
            
            DOMUtils.create('hr', { className: 'sidebar-divider' })
        ]);
    }

    _injectAdminFooter() {
        const mainSidebar = document.getElementById('app-sidebar');
        if (!mainSidebar) return;

        // Limpa rodapé antigo
        const oldFooter = mainSidebar.querySelector('.sidebar-footer-actions');
        if (oldFooter) oldFooter.remove();

        // Só exibe na tela de setores
        if (!NavigationService.isCurrentPage(ROUTES.SECTORS_LIST)) return;

        const container = DOMUtils.create('div', { className: 'sidebar-footer-actions' });
        container.appendChild(DOMUtils.create('div', { className: 'sidebar-subtitle' }, 'Administração'));

        // Botões de Ação
        const createBtn = (id, icon, text) => DOMUtils.create('button', {
            id: id, className: 'sidebar-action-btn'
        }, `<i class="${icon}"></i> ${text}`);

        container.appendChild(createBtn('sidebar-btn-cities', 'fas fa-city', 'Cidades'));
        container.appendChild(createBtn('sidebar-btn-companies', 'fas fa-building', 'Empresas'));

        mainSidebar.appendChild(container);
    }

    clearSelection() {
        this.currentSelection = null;
        if (!this.container) return;
        this.container.querySelectorAll('.active-sector').forEach(el => el.classList.remove('active-sector'));
    }
    
    // --- LÓGICA DE ÁRVORE RECURSIVA ---
    _buildTree(nodes, parentElement, onSelectCallback) {
        if (!nodes || !Array.isArray(nodes)) return;
        
        nodes.forEach(node => {
            const isFolder = typeof node === 'object';
            const labelText = isFolder ? node.name : node;

            const contentDiv = DOMUtils.create('div', {
                className: isFolder ? 'tree-item-content folder-node' : 'tree-item-content leaf-node',
                onclick: (e) => {
                    e.stopPropagation();
                    if (isFolder) {
                        this._toggleFolder(contentDiv.parentElement);
                        this._handleLeafClick(contentDiv, labelText, onSelectCallback);
                    } else {
                        this._handleLeafClick(contentDiv, labelText, onSelectCallback);
                        // Fecha menu no mobile ao clicar em item
                        if(window.innerWidth <= 768) {
                            document.getElementById('app-sidebar')?.classList.remove('sidebar-open');
                            document.body.classList.remove('menu-active');
                        }
                    }
                }
            }, `${isFolder ? '<i class="fas fa-chevron-right arrow"></i>' : ''} ${labelText}`);

            const li = DOMUtils.create('li', {}, contentDiv);
            
            if (isFolder && node.children) {
                const subUl = DOMUtils.create('ul', { className: 'tree-children' });
                this._buildTree(node.children, subUl, onSelectCallback);
                li.appendChild(subUl);
            }
            parentElement.appendChild(li);
        });
    }

    _toggleFolder(li) {
        li.classList.toggle('expanded');
    }

    _handleLeafClick(div, label, callback) {
        this.clearSelection();
        if (this.currentSelection === label) {
            if(callback) callback(null); // Deselecionar
        } else {
            div.classList.add('active-sector');
            this.currentSelection = label;
            if(callback) callback(label); 
        }
    }
}
==================================================
CAMINHO: .\js\components\tables.js
==================================================
/* js/components/tables.js */
import { DOMUtils, SmartRenderers } from '../utils.js';

export class TableComponent {
    constructor(container) { this.container = container; }

    render(data, config, rowClickCallback) {
        this.container.innerHTML = '';
        if (!data || !data.length) return false;

        const fragment = document.createDocumentFragment();
        const rowClass = config.isInner ? 'inner-table-row' : 'user-row';

        data.forEach(item => {
            const cells = config.columns.map(col => {
                const val = item[col.key];
                
                // USA A LÓGICA INTELIGENTE DO UTILS.JS
                // Se tiver 'type' no config (ex: 'datetime'), usa o SmartRenderers
                let content = col.render ? col.render(item) : (SmartRenderers[col.type || 'text'](val));

                // Resolve estilo
                const style = typeof col.style === 'function' ? col.style(item) : col.style;
                
                const cell = DOMUtils.create('div', { 
                    className: `th-col ${col.widthClass || 'w-flex'}`, 
                    style: style,
                    'data-label': col.label 
                });
                
                // innerHTML permite ícones e badges
                cell.innerHTML = content;
                return cell;
            });

            const row = DOMUtils.create('div', {
                className: `${rowClass} ${config.gridClass || ''} animate-fade`,
                'data-id': item.id,
                onclick: () => rowClickCallback && rowClickCallback(row, item)
            }, cells);

            fragment.appendChild(row);
        });

        this.container.appendChild(fragment);
        return true;
    }
}

export function renderGenericTable(container, data, config, cb) {
    return new TableComponent(container).render(data, config, cb);
}
==================================================
CAMINHO: .\js\components\tabs.js
==================================================
/**
 * Gerencia a troca de abas
 * @param {string} tabName - Nome da aba a ativar
 * @param {Array} tabButtons - Lista de elementos DOM dos botões
 * @param {Function} renderCallback - Função que desenha o conteúdo
 */
export function switchTab(tabName, tabButtons, renderCallback) {
    // Remove classe ativa de todos
    tabButtons.forEach(btn => btn.classList.remove('active'));
    
    // Adiciona ao selecionado (assumindo que o ID do botão é 'tab-NOME')
    const activeBtn = document.getElementById(`tab-${tabName}`);
    if(activeBtn) activeBtn.classList.add('active');

    // Chama o renderizador da página para desenhar o conteúdo
    renderCallback(tabName);
}

/**
 * Reseta o estado visual das abas para o padrão
 */
export function resetTabs(tabButtons) {
    tabButtons.forEach(btn => {
        btn.classList.remove('active');
        btn.disabled = false;
    });
    // Ativa a primeira por padrão
    if(tabButtons.length > 0) tabButtons[0].classList.add('active');
}
==================================================
CAMINHO: .\js\components\toast.js
==================================================
import { DOMUtils } from '../utils.js';

class ToastService {
    constructor() {
        this.containerId = 'toast-container';
        this.container = null;
    }

    _getContainer() {
        if (!this.container) {
            this.container = document.getElementById(this.containerId);
            if (!this.container) {
                this.container = DOMUtils.create('div', { id: this.containerId });
                document.body.appendChild(this.container);
            }
        }
        return this.container;
    }

    show(message, type = 'info') {
        const container = this._getContainer();

        // Define Ícone baseado no tipo
        let iconClass = 'fa-info-circle';
        if (type === 'success') iconClass = 'fa-check-circle';
        if (type === 'error') iconClass = 'fa-exclamation-circle';

        // Cria o Toast com DOMUtils
        const icon = DOMUtils.create('i', { className: `fas ${iconClass}` });
        const text = DOMUtils.create('span', {}, message);
        
        const toast = DOMUtils.create('div', { 
            className: `toast ${type}` 
        }, [icon, text]);

        // Adiciona ao container
        container.appendChild(toast);

        // Animação de Entrada (Força reflow)
        requestAnimationFrame(() => {
            toast.classList.add('show');
        });

        // Timer para remover
        setTimeout(() => {
            toast.classList.remove('show');
            toast.classList.add('hide');
            
            // Remove do DOM após a animação CSS terminar
            toast.addEventListener('animationend', () => {
                if (toast.parentNode) toast.parentNode.removeChild(toast);
            });
        }, 3000);
    }
}

// Instância Singleton
const toastInstance = new ToastService();

// Wrapper para compatibilidade
export function showToast(message, type) {
    toastInstance.show(message, type);
}
==================================================
CAMINHO: .\js\config\constants.js
==================================================
export const APP_CONFIG = {
    API_BASE_URL: 'http://localhost:8000/api', 
    USE_MOCK_DATA: true, 
    // 1. Coloque a URL do Backend
    // 2. True usa o MockService, false usa o Backend
};

export const STORAGE_KEYS = {
    TOKEN: 'sys_token',
    USER: 'sys_user',
    DB_USERS: 'app_users',
    DB_EQUIPMENTS: 'app_equipments',
    DB_LOGS: 'app_logs',
    DB_OS: 'app_os',
    DB_LOG_ERROS: 'app_log_erros'
};

export const ROUTES = {
    LOGIN: 'index.html',
    HOME: 'dashboard.html',
    DASHBOARD: 'dashboard.html',
    USER_PANEL: 'user_panel.html',
    USERS_LIST: 'usuarios.html',
    USERS_FORM: 'cadastro_usuario.html',
    EQUIPMENT_LIST: 'equipamento.html',
    EQUIPMENT_FORM: 'cadastro_equipamento.html',
    LOGS_LIST: 'log.html',
    OS_LIST: 'os.html',
    OS_FORM: 'cadastro_os.html',
    SECTORS_LIST: 'setores.html',
    SECTORS_FORM: 'cadastro_setor.html',
    MONITORING: 'monitoramento.html'
};

export const MESSAGES = {
    LOGIN_SUCCESS: 'Login realizado com sucesso!',
    LOGIN_FAIL: 'Falha na autenticação.',
    REQUIRED_PASSWORD: 'Preencha a senha!',
    SAVE_SUCCESS: 'Salvo com sucesso!',
    DELETE_SUCCESS: 'Item excluído com sucesso!',
    ERROR_GENERIC: 'Ocorreu um erro inesperado.',
    DELETE_CONFIRM: (name) => `Tem certeza que deseja excluir <strong>${name}</strong>?`
};
==================================================
CAMINHO: .\js\config\equipamento.config.js
==================================================
export const TABLE_COLUMNS = {
    main: {
        gridClass: 'equip-grid',
        searchFields: ['serie', 'modelo', 'usuario'],
        columns: [
            { key: 'tipo', label: '', widthClass: 'w-xs', type: 'icon' },
            { key: 'id', label: '#', widthClass: 'w-xs' },
            { key: 'serie', label: 'Série', widthClass: 'w-md' },
            { key: 'modelo', label: 'Modelo', widthClass: 'w-flex' },
            { key: 'sala', label: 'Sala', widthClass: 'w-flex' },
            { key: 'usuario', label: 'Usuário', widthClass: 'w-flex' },
            { key: 'status', label: 'Status', widthClass: 'w-sm', type: 'status' },
            { key: 'setor', label: 'Setor', widthClass: 'w-sm' },
            { key: 'contador', label: 'Cont.', widthClass: 'w-sm' },
            { key: 'tonel', label: 'Ton.', widthClass: 'w-sm' },
            { key: 'error', label: 'Erro', widthClass: 'w-flex', type: 'error' }
        ]
    },
    inner: {
        isInner: true,
        gridClass: 'equip-grid',
        columns: [
            { key: 'tipo', label: '', widthClass: 'w-xs', type: 'icon' },
            { key: 'id', label: '#', widthClass: 'w-xs' },
            { key: 'serie', label: 'Série', widthClass: 'w-md' },
            { key: 'modelo', label: 'Modelo', widthClass: 'w-flex' },
            { key: 'sala', label: 'Sala', widthClass: 'w-flex' },
            { key: 'usuario', label: 'Usuário', widthClass: 'w-flex' },
            { key: 'status', label: 'Status', widthClass: 'w-sm', type: 'status' },
            { key: 'setor', label: 'Setor', widthClass: 'w-sm' },
            { key: 'contador', label: 'Cont.', widthClass: 'w-sm' },
            { key: 'tonel', label: 'Ton.', widthClass: 'w-sm' },
            { key: 'error', label: 'Erro', widthClass: 'w-flex', type: 'error' }
        ]
    }
};

export const TAB_IDS = { impressoras: 'tab-impressoras', erros: 'tab-erros', opcoes: 'tab-opcoes' };
==================================================
CAMINHO: .\js\config\log.config.js
==================================================
export const LOG_TABLE_CONFIG = {
    gridClass: 'log-grid',
    searchFields: ['user', 'details', 'action'],
    columns: [
        { key: 'date', label: 'Data/Hora', widthClass: 'w-md', type: 'datetime' },
        { key: 'user', label: 'Usuário', widthClass: 'w-flex', style: 'font-weight: 500;' },
        { key: 'action', label: 'Ação', widthClass: 'w-sm', type: 'badge' },
        { key: 'resource', label: 'Recurso', widthClass: 'w-sm', style: 'color: #666;' },
        { key: 'details', label: 'Detalhes', widthClass: 'w-flex', style: 'color: #888; font-size: 13px;' }
    ]
};
==================================================
CAMINHO: .\js\config\monitoramento.config.js
==================================================
/* js/config/monitoramento.config.js */
export const MONITOR_TABLE_CONFIG = {
    gridClass: 'monitor-grid',
    searchFields: ['titulo', 'codigo_erro', 'equipamentoNome', 'equipamentoSala'],
    columns: [
        // 1. Severidade
        { key: 'severidade', label: 'Severidade', widthClass: 'w-sm', render: (item) => {
            const cls = item.severidade === 'Crítico' ? 'sev-critico' : (item.severidade === 'Alerta' ? 'sev-alerta' : 'sev-info');
            // Removemos o ícone de dentro do badge para ficar mais limpo, apenas texto
            return `<span class="sev-badge ${cls}">${item.severidade}</span>`;
        }},
        
        // 2. Data
        { key: 'data_hora', label: 'Data', widthClass: 'w-md', type: 'datetime' },
        
        // 3. Equipamento
        { key: 'equipamentoNome', label: 'Equipamento', widthClass: 'w-flex', style: 'font-weight:bold; color:var(--brand-active);' },
        
        // 4. Sala
        { key: 'equipamentoSala', label: 'Sala', widthClass: 'w-flex' },
        
        // 5. Erro (Com Código visualmente separado)
        { key: 'titulo', label: 'Erro / Código', widthClass: 'w-flex', render: (item) => {
            return `<div>
                <div class="error-title">
                    <span>${item.titulo}</span>
                    <span class="error-code-tag">${item.codigo_erro}</span>
                </div>
                <span class="error-desc" title="${item.descricao}">${item.descricao}</span>
            </div>`;
        }},
        
        // 6. Ações (Apenas Ícones)
        { key: 'actions', label: 'Ações', widthClass: 'w-sm', render: (item) => {
            if (item.id_os_gerada) {
                return `<div class="monitor-actions">
                    <button class="btn-monitor view" onclick="verOS('${item.id_os_gerada}', event)" title="Ver O.S. #${item.id_os_gerada}">
                        <i class="fas fa-file-alt"></i> <span style="margin-left:5px">#${item.id_os_gerada}</span>
                    </button>
                </div>`;
            }
            
            return `<div class="monitor-actions">
                <button class="btn-monitor solve" onclick="resolverErro('${item.id}', event)" title="Resolver Rapidamente">
                    <i class="fas fa-check"></i>
                </button>
                <button class="btn-monitor os" onclick="gerarOS('${item.id}', event)" title="Gerar Ordem de Serviço">
                    <i class="fas fa-tools"></i>
                </button>
            </div>`;
        }}
    ]
};
==================================================
CAMINHO: .\js\config\os.config.js
==================================================
/* js/config/os.config.js */
export const OS_TABLE_CONFIG = {
    gridClass: 'os-grid',
    // Adicionamos 'solicitante' e 'responsavel' na busca
    searchFields: ['equipamentoName', 'descricao', 'id', 'solicitante', 'responsavel'], 
    columns: [
        // 1. Status (Ícone)
        { key: 'status', label: '', widthClass: 'w-xs', render: (i) => {
            const color = i.status === 'Aberto' ? 'var(--status-error)' : 'var(--status-success)';
            const icon = i.status === 'Aberto' ? 'fa-clock' : 'fa-check-circle';
            return `<i class="fas ${icon}" style="color: ${color}; font-size: 16px;"></i>`;
        }},
        // 2. ID
        { key: 'id', label: '#', widthClass: 'w-xs' },
        // 3. Equipamento
        { key: 'equipamentoName', label: 'Equipamento', widthClass: 'w-flex' },
        // 4. Defeito
        { key: 'descricao', label: 'Defeito', widthClass: 'w-flex', style: 'white-space:nowrap; overflow:hidden; text-overflow:ellipsis;' },
        
        // 5. Solicitante (Quem pediu)
        { key: 'solicitante', label: 'Solicitante', widthClass: 'w-flex', style: 'font-weight: 500; color: var(--text-primary);' },
        
        // 6. Responsável (Técnico)
        { key: 'responsavel', label: 'Responsável', widthClass: 'w-flex', style: 'color: #666;' },
        
        // 7. Setor
        { key: 'setor', label: 'Setor', widthClass: 'w-sm' },

        // 8. Datas
        { key: 'dataAbertura', label: 'Abertura', widthClass: 'w-sm', type: 'date' },
        { key: 'dataFechamento', label: 'Fechamento', widthClass: 'w-sm', type: 'date' }
    ]
};
==================================================
CAMINHO: .\js\config\setores.config.js
==================================================
/* js/config/setores.config.js */
export const SECTORS_TABLE_CONFIG = {
    gridClass: 'sectors-grid', // Vamos definir esse grid no CSS
    searchFields: ['nome', 'empresa', 'cidade'],
    columns: [
        { key: 'nome', label: 'Nome do Setor', widthClass: 'w-flex', style: 'font-weight: bold;' },
        { key: 'empresa', label: 'Empresa / Local', widthClass: 'w-flex' },
        { key: 'cidade', label: 'Cidade', widthClass: 'w-sm' }
    ]
};
==================================================
CAMINHO: .\js\config\usuarios.config.js
==================================================
export const USERS_TABLE_CONFIG = {
    gridClass: 'users-grid',
    searchFields: ['nome', 'cpf'],
    columns: [
        { key: 'id', label: '#', widthClass: 'w-xs' },
        { key: 'nome', label: 'Nome', widthClass: 'w-flex' },
        { key: 'cpf', label: 'CPF', widthClass: 'w-flex' },
        { key: 'tipo', label: 'Tipo', widthClass: 'w-sm', type: 'badge' }, // Badge fica bonito aqui
        { key: 'setor', label: 'Setor', widthClass: 'w-flex' }
    ]
};
==================================================
CAMINHO: .\js\core\BaseFormPage.js
==================================================
/* js/core/BaseFormPage.js */
import { HeaderComponent } from '../components/header.js';
import { SidebarComponent } from '../components/sidebar.js';
import { setupInputMasks, InputManager } from '../components/inputs.js'; // Adicionei InputManager aqui se faltar
import { treeStructure } from '../database.js';
import { showToast } from '../components/toast.js';
import { NavigationService } from '../services/navigation.service.js';

export class BaseFormPage {
    constructor({ formId, service, redirectUrl, resourceName = 'Item' }) {
        this.form = document.getElementById(formId);
        this.service = service;
        this.redirectUrl = redirectUrl;
        this.resourceName = resourceName;
        
        this.titlePage = document.querySelector('.form-header-title h2');
        this.btnSubmit = document.querySelector('.btn-submit'); 
        
        this.editId = NavigationService.getQueryParam('id');

        this.header = new HeaderComponent('app-header');
        this.sidebar = new SidebarComponent('tree-menu-container');
    }

    init() {
        this.header.render(() => NavigationService.navigate(this.redirectUrl), 'form');
        this.header.updateButtons('only-back');
        this.sidebar.render(treeStructure, () => {}, false);

        setupInputMasks();
        this.setupListeners();

        if (this.editId) {
            this.loadData(this.editId);
        }
    }

    async loadData(id) {
        const item = await this.service.getById(id);
        if (item) {
            this.fillForm(item);
            this.updateUIForEdit();
        } else {
            showToast('Item não encontrado.', 'error');
            NavigationService.navigate(this.redirectUrl);
        }
    }

    fillForm(data) {
        const inputs = this.form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            if (input.name && data[input.name] !== undefined) {
                input.value = data[input.name];
            }
        });
        this.afterFillForm(data);
    }

    updateUIForEdit() {
        if(this.titlePage) this.titlePage.innerText = `Alterar ${this.resourceName}`;
        if(this.btnSubmit) {
            this.btnSubmit.innerHTML = 'SALVAR ALTERAÇÕES <i class="fas fa-check"></i>';
        }
    }

    setupListeners() {
        if (this.form) {
            this.form.addEventListener('submit', (e) => this.handleSubmit(e));
        }
        this.addExtraListeners();
    }

    async handleSubmit(e) {
        e.preventDefault();
        
        // 1. Validação (Hook opcional dos filhos)
        if (!this.validate()) return;

        // 2. Feedback Visual
        const originalContent = this.btnSubmit ? this.btnSubmit.innerHTML : 'Salvar';
        if(this.btnSubmit) {
            this.btnSubmit.disabled = true;
            this.btnSubmit.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Salvando...';
        }

        try {
            const formData = new FormData(this.form);
            const dataObj = Object.fromEntries(formData.entries());

            if (this.editId) {
                dataObj.id = this.editId;
            }

            // --- OTIMIZAÇÃO AQUI (HOOK) ---
            // Pega dados extras definidos no filho e mistura com os dados do form
            const extraData = this.getExtraData();
            Object.assign(dataObj, extraData);

            await this.service.save(dataObj);
            
            const action = this.editId ? 'atualizado' : 'cadastrado';
            showToast(`${this.resourceName} ${action} com sucesso!`, 'success');
            
            NavigationService.navigate(this.redirectUrl);
            
        } catch (error) {
            console.error(error);
            showToast('Erro ao salvar dados.', 'error');
            
            if(this.btnSubmit) {
                this.btnSubmit.disabled = false;
                this.btnSubmit.innerHTML = originalContent;
            }
        }
    }

    // --- HOOKS (Métodos vazios que os filhos podem sobrescrever) ---
    
    validate() { return true; } 
    
    afterFillForm(data) {} 
    
    addExtraListeners() {} 
    
    // Novo Hook: Retorna objeto com dados extras para salvar
    getExtraData() { return {}; }
}
==================================================
CAMINHO: .\js\core\BaseListPage.js
==================================================
/* js/core/BaseListPage.js */
import { HeaderComponent } from '../components/header.js';
import { SidebarComponent } from '../components/sidebar.js';
import { TableComponent } from '../components/tables.js';
import { setupGenericSearch } from '../components/search.js';
import { showEmptyState, hideEmptyState } from '../utils.js';
import { showConfirmModal } from '../components/modal.js';
import { showToast } from '../components/toast.js';
import { NavigationService } from '../services/navigation.service.js';
import { SetorService } from '../services/setor.service.js'; 

export class BaseListPage {
    constructor(config, options = {}) {
        const { listElementId, emptyStateId, service, tableConfig, pageName, addPageUrl, deleteMessageFn } = config;
        this.elements = {
            list: document.getElementById(listElementId),
            empty: document.getElementById(emptyStateId)
        };
        this.service = service;
        this.config = tableConfig;
        this.pageName = pageName;
        this.addPageUrl = addPageUrl;
        this.deleteMessageFn = deleteMessageFn;
        this.state = { data: [], selectedItem: null };

        this.options = {
            canAdd: options.canAdd !== undefined ? options.canAdd : true,
            canSelect: options.canSelect !== undefined ? options.canSelect : true,
            showSidebarTree: options.showSidebarTree !== undefined ? options.showSidebarTree : true,
            ...options
        };
        this.header = new HeaderComponent('app-header');
        
        const sidebarEl = document.getElementById('tree-menu-container') || document.getElementById('app-sidebar');
        if (sidebarEl) this.sidebar = new SidebarComponent(sidebarEl.id);
        
        this.table = new TableComponent(this.elements.list);
        this.handleResetSystem = this.handleResetSystem.bind(this);
        this.handleSectorClick = this.handleSectorClick.bind(this);
    }

    async init() {
        this.header.render(this.handleResetSystem, this.pageName);
        if (this.sidebar) {
            let treeData = null;
            if (this.options.showSidebarTree) {
                treeData = await SetorService.getTreeStructure();
            }
            this.sidebar.render(treeData, this.handleSectorClick);
        }

        if (this.options.canAdd && this.addPageUrl) {
            this.bindAddButton();
        } else {
            const btn = document.getElementById('btn-add');
            if (btn) btn.style.display = 'none';
        }
        
        const fields = this.config.searchFields || ['nome'];
        setupGenericSearch('search-input', () => this.state.data, fields, (filtered) => this.renderTable(filtered));

        await this.loadData();
    }

    async loadData() {
        this.state.data = await this.service.getAll();
        this.renderTable(this.state.data);
    }

    renderTable(data) {
        const clickCallback = this.options.canSelect ? (row, item) => this.handleItemSelect(row, item) : null;
        
        const hasData = this.table.render(data, this.config, clickCallback);
        if (hasData) hideEmptyState(this.elements.empty, this.elements.list.id);
        else showEmptyState(this.elements.empty, this.elements.list.id, 'fa-search', 'Nenhum item encontrado');
    }

    // --- MUDANÇA: FILTRO INTELIGENTE HIERÁRQUICO ---
    async handleSectorClick(nodeName) {
        if (!nodeName) return this.handleResetSystem();
        if (!this.options.showSidebarTree) return;

        // 1. Pega lista de TODOS os setores filhos (do nó clicado)
        const allowedSectors = await SetorService.getSectorsUnder(nodeName);

        // 2. Filtra os dados
        const filtered = this.state.data.filter(item => {
            // Se for User/OS/Equip (tem propriedade 'setor')
            if (item.setor && allowedSectors.includes(item.setor)) return true;
            // Se for Tela de Setores (o item É o setor, verificamos 'nome')
            if (item.nome && !item.setor && allowedSectors.includes(item.nome)) return true;
            return false;
        });

        this.renderTable(filtered);
        this.header.updateButtons('sectorSelected');
        
        if (this.options.canAdd) this.bindAddButton();
    }

    handleItemSelect(rowElement, item) {
        if (!this.options.canSelect) return;
        if (!rowElement) { 
            if(this.sidebar) this.sidebar.clearSelection();
            document.querySelectorAll('.user-row').forEach(r => r.classList.remove('selected'));
            return;
        }

        const isSelected = rowElement.classList.contains('selected');
        document.querySelectorAll('.user-row').forEach(r => r.classList.remove('selected'));
        if (isSelected) {
            this.handleResetSelection();
        } else {
            rowElement.classList.add('selected');
            this.state.selectedItem = item;
            this.header.updateButtons('userSelected');
            this.bindContextButtons(item);
            this.onItemSelect(item);
        }
    }

    handleEdit(item) {
        if (this.addPageUrl) NavigationService.navigate(this.addPageUrl, { id: item.id });
    }

    async handleDelete(item) {
        if (!item) return;
        const check = await this.service.checkDependencies(item.id);

        if (!check.allowed) {
            showToast(`Não é possível excluir: ${check.message}`, 'error');
            return;
        }

        showConfirmModal("Excluir", this.deleteMessageFn(item), async () => {
            if (await this.service.delete(item.id)) {
                showToast("Item excluído!", "success");
                this.handleResetSelection();
                this.state.data = this.state.data.filter(i => i.id !== item.id);
                this.renderTable(this.state.data);
            }
        });
    }

    handleResetSelection() {
        this.state.selectedItem = null;
        document.querySelectorAll('.user-row').forEach(r => r.classList.remove('selected'));
        const activeSector = document.querySelector('.active-sector');
        this.header.updateButtons(activeSector ? 'sectorSelected' : 'default');
        if(this.options.canAdd) this.bindAddButton();
        this.onResetSelection();
    }

    handleResetSystem() {
        if(this.sidebar) this.sidebar.clearSelection();
        this.handleResetSelection();
        this.header.toggleSearchMode(false);
        this.loadData();
    }

    bindAddButton() {
        setTimeout(() => {
            const btn = document.getElementById('btn-add');
            if(btn) {
                btn.style.display = 'flex';
                btn.onclick = () => NavigationService.navigate(this.addPageUrl);
            }
        }, 0);
    }

    bindContextButtons(item) {
        setTimeout(() => {
            const btnEdit = document.getElementById('btn-edit');
            const btnDel = document.getElementById('btn-delete');
            if (btnEdit) btnEdit.onclick = () => this.handleEdit(item);
            if (btnDel) btnDel.onclick = () => this.handleDelete(item);
        }, 0);
    }

    onItemSelect(item) {}
    onResetSelection() {}
}
==================================================
CAMINHO: .\js\core\BaseService.js
==================================================
/* js/core/BaseService.js */
import { HttpClient } from './HttpClient.js';
// Não importamos mais database.js nem constants.js aqui!

export class BaseService {
    /**
     * @param {string} endpoint - O nome do recurso na API (ex: 'users')
     * @param {string} resourceLabel - Nome legível para Logs (ex: 'Usuário')
     */
    constructor(endpoint, resourceLabel = null) {
        this.http = new HttpClient(endpoint);
        this.resourceLabel = resourceLabel;
    }

    async getAll() {
        return this.http.get();
    }

    async getById(id) {
        return this.http.get(id);
    }

    async save(item) {
        let result;
        const isUpdate = !!item.id;
        let itemLabel = 'Item';

        // Lógica de Log (Nome do item)
        if (this.resourceLabel) {
            // Se for update, tenta pegar o nome antigo, senão usa o do item atual
            itemLabel = item.modelo || item.serie || item.nome || item.descricao || 'Item';
        }

        // --- AQUI A MÁGICA ACONTECE ---
        // Não importa se é Mock ou Real, o método é o mesmo
        if (isUpdate) {
            result = await this.http.put(item.id, item);
        } else {
            result = await this.http.post(item);
        }

        // Grava Log (Ainda no Frontend por enquanto, mas centralizado)
        if (this.resourceLabel) {
            await this._logAction(
                isUpdate ? 'UPDATE' : 'CREATE', 
                `${isUpdate ? 'Editou' : 'Criou'} ${itemLabel}`
            );
        }

        return result;
    }

    async delete(id) {
        // Pega o item antes de deletar para poder logar o nome
        let itemLabel = 'Item';
        try {
            const item = await this.getById(id);
            if (item) itemLabel = item.modelo || item.serie || item.nome || 'Item';
        } catch(e) {}

        const success = await this.http.delete(id);

        if (success && this.resourceLabel) {
            await this._logAction('DELETE', `Excluiu ${itemLabel}`);
        }

        return success;
    }

    // Hook de Integridade (Mantido do passo anterior)
    async checkDependencies(id) {
        return { allowed: true };
    }

    async _logAction(action, details) {
        try {
            const { LogService } = await import('../services/log.service.js');
            await LogService.add(action, this.resourceLabel, details);
        } catch (e) {
            console.error("Erro ao gravar log:", e);
        }
    }
}
==================================================
CAMINHO: .\js\core\HttpClient.js
==================================================
/* js/core/HttpClient.js */
import { APP_CONFIG, STORAGE_KEYS } from '../config/constants.js';
import { MockDatabase } from './MockDatabase.js';
import { ROUTES, NavigationService } from '../services/navigation.service.js';
import { showToast } from '../components/toast.js';

export class HttpClient {
    constructor(endpoint) {
        this.endpoint = endpoint; 
        this.useMock = APP_CONFIG.USE_MOCK_DATA;
        this.apiBase = APP_CONFIG.API_BASE_URL;
    }

    // --- 1. GERENCIADOR DE CABEÇALHOS (HEADERS) ---
    // Prepara o cabeçalho padrão com JSON e o Token de Autenticação
    _getHeaders() {
        const headers = {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
        };
        
        // Pega o token salvo e anexa automaticamente
        const token = localStorage.getItem(STORAGE_KEYS.TOKEN);
        if (token) {
            headers['Authorization'] = `Bearer ${token}`;
        }
        
        return headers;
    }

    // --- 2. TRATAMENTO CENTRALIZADO DE RESPOSTAS ---
    // Verifica se deu erro HTTP (4xx, 5xx) e toma atitudes globais
    async _handleResponse(response) {
        // Se a resposta for 204 No Content (comum em delete/put), não tem JSON
        if (response.status === 204) return true;

        const data = await response.json().catch(() => ({}));

        if (!response.ok) {
            // ERRO 401: Token expirado ou inválido
            if (response.status === 401) {
                console.warn('Sessão expirada. Redirecionando...');
                localStorage.removeItem(STORAGE_KEYS.TOKEN);
                localStorage.removeItem(STORAGE_KEYS.USER);
                NavigationService.navigate(ROUTES.LOGIN);
                throw new Error('Sessão expirada. Faça login novamente.');
            }

            // ERRO 403: Sem permissão
            if (response.status === 403) {
                showToast('Você não tem permissão para realizar esta ação.', 'error');
                throw new Error('Acesso negado.');
            }

            // Outros erros (400, 500)
            // Tenta pegar a mensagem de erro que o backend mandou
            const errorMessage = data.message || data.error || `Erro HTTP ${response.status}`;
            throw new Error(errorMessage);
        }

        return data;
    }

    // --- LOGIN ---
    async login(credentials) {
        if (this.useMock) return MockDatabase.login(credentials);
        
        try {
            const response = await fetch(`${this.apiBase}/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(credentials)
            });
            return this._handleResponse(response);
        } catch (error) {
            // Repassa o erro para o AuthService tratar (exibir toast)
            throw error;
        }
    }

    // --- MÉTODOS CRUD (Agora usando headers e handler) ---

    async get(id = null) {
        if (this.useMock) {
            if (id) return MockDatabase.getById(this.endpoint, id);
            return MockDatabase.get(this.endpoint);
        }
        
        const url = id ? `${this.apiBase}/${this.endpoint}/${id}` : `${this.apiBase}/${this.endpoint}`;
        
        const response = await fetch(url, {
            method: 'GET',
            headers: this._getHeaders() // Injeta o Token
        });

        return this._handleResponse(response);
    }

    async post(data) {
        if (this.useMock) return MockDatabase.post(this.endpoint, data);
        
        const response = await fetch(`${this.apiBase}/${this.endpoint}`, {
            method: 'POST',
            headers: this._getHeaders(), // Injeta o Token
            body: JSON.stringify(data)
        });

        return this._handleResponse(response);
    }

    async put(id, data) {
        if (this.useMock) return MockDatabase.put(this.endpoint, id, data);

        const response = await fetch(`${this.apiBase}/${this.endpoint}/${id}`, {
            method: 'PUT',
            headers: this._getHeaders(), // Injeta o Token
            body: JSON.stringify(data)
        });

        return this._handleResponse(response);
    }

    async delete(id) {
        if (this.useMock) return MockDatabase.delete(this.endpoint, id);

        const response = await fetch(`${this.apiBase}/${this.endpoint}/${id}`, {
            method: 'DELETE',
            headers: this._getHeaders() // Injeta o Token
        });

        // Delete geralmente retorna 200 ou 204. Se ok, retorna true.
        if (response.ok) return true;
        
        // Se falhar, o _handleResponse vai lançar o erro
        await this._handleResponse(response);
        return false;
    }
}
==================================================
CAMINHO: .\js\core\MockDatabase.js
==================================================
/* js/core/MockDatabase.js */
import { usersData, equipmentsData, treeStructure } from '../database.js'; 
import { STORAGE_KEYS } from '../config/constants.js';

class MockDatabaseClass {
    constructor() {
        this.resources = {
            'cities': { key: 'app_cities', seed: [] },
            'companies': { key: 'app_companies', seed: [] },
            'sectors': { key: 'app_sectors', seed: [] },
            'users': { key: STORAGE_KEYS.DB_USERS, seed: [] },
            'equipments': { key: STORAGE_KEYS.DB_EQUIPMENTS, seed: [] },
            'os': { key: STORAGE_KEYS.DB_OS, seed: [] }, 
            'logs': { key: STORAGE_KEYS.DB_LOGS, seed: [] },
            
            // --- NOVA TABELA ---
            'log_erros': { key: 'app_log_erros', seed: [] }
        };

        this._initialize();
    }

    _initialize() {
        Object.values(this.resources).forEach(res => {
            if (!localStorage.getItem(res.key)) {
                localStorage.setItem(res.key, JSON.stringify([]));
            }
        });

        if (this._getCollection('cities').length === 0) {
            this._performRelationalSeed();
        }
    }

    _performRelationalSeed() {
        console.log('[MockDB] Gerando dados relacionais compatíveis com SQL...');
        
        const cities = []; const companies = []; const sectors = [];
        let cityIdCounter = 1; let compIdCounter = 1; let sectIdCounter = 1;

        // 1. Geografia
        if (treeStructure && Array.isArray(treeStructure)) {
            treeStructure.forEach(cityNode => {
                const cityId = (cityIdCounter++).toString();
                cities.push({ id: cityId, nome: cityNode.name, estado: 'CE' });
                if (cityNode.children) {
                    cityNode.children.forEach(compNode => {
                        const compId = (compIdCounter++).toString();
                        companies.push({ id: compId, nome: compNode.name, cnpj: '00.000.000/0001-91', id_cidade: cityId });
                        if (Array.isArray(compNode.children)) {
                            compNode.children.forEach((sectName, idx) => {
                                sectors.push({ id: (sectIdCounter++).toString(), nome: sectName, localizacao: `Sala ${100 + idx}`, id_empresa: compId });
                            });
                        }
                    });
                }
            });
        }
        this._save('cities', cities);
        this._save('companies', companies);
        this._save('sectors', sectors);

        // 2. Usuários
        const newUsers = usersData.map(u => {
            const sectorFound = sectors.find(s => s.nome === u.setor);
            return {
                id: u.id, nome: u.nome, cpf: u.cpf, senha: u.senha, tipo: u.tipo, 
                id_setor: sectorFound ? sectorFound.id : null
            };
        });
        this._save('users', newUsers);

        // 3. Equipamentos
        const newEquips = equipmentsData.map(eq => {
            const sectorFound = sectors.find(s => s.nome === eq.setor);
            const userFound = newUsers.find(u => u.nome === eq.usuario);
            const randomSala = `Sala ${Math.floor(Math.random() * 50) + 100}`;

            return {
                id: eq.id,
                tipo: eq.tipo, 
                modelo: eq.modelo,
                serie: eq.serie,
                sala: randomSala,
                status: eq.status,
                contador: eq.contador,
                tonel: eq.tonel,
                
                // O campo 'error' simples ainda existe no objeto visual, 
                // mas agora teremos a tabela log_erros para o histórico real
                error: eq.error, 
                
                id_setor: sectorFound ? sectorFound.id : null,
                id_usuario: userFound ? userFound.id : null,
                usuario: eq.usuario 
            };
        });
        this._save('equipments', newEquips);

        // 4. Gera O.S.
        this._seedOS(newEquips, newUsers);
        
        // 5. Gera LOG_ERROS (Novo)
        this._seedLogErrors(newEquips);
    }

    _seedOS(equips, users) {
        if (!equips || !users) return;
        const defeitos = ["Não liga", "Tela azul", "Impressão falhando", "Sem rede", "Lentidão"];
        const osList = [];
        for (let i = 1; i <= 20; i++) {
            const equip = equips[Math.floor(Math.random() * equips.length)];
            const solicitante = users[Math.floor(Math.random() * users.length)];
            const tecnico = users.find(u => u.tipo.includes('Técnico')) || users[0];
            const isOpen = Math.random() > 0.4;

            osList.push({
                id: i.toString(),
                descricao_problema: defeitos[Math.floor(Math.random() * defeitos.length)],
                status: isOpen ? 'Aberto' : 'Fechado',
                data_abertura: new Date().toISOString(),
                data_fechamento: isOpen ? null : new Date().toISOString(),
                solucao: isOpen ? '' : 'Resolvido.',
                id_usuario_solicitante: solicitante.id,
                id_usuario_responsavel: isOpen ? null : tecnico.id,
                id_computador: equip.tipo === 'computador' ? equip.id : null,
                id_impressora: equip.tipo === 'impressora' ? equip.id : null,
                id_setor: equip.id_setor 
            });
        }
        this._save('os', osList);
    }

    // --- NOVA FUNÇÃO DE SEED PARA LOG_ERRO ---
    _seedLogErrors(equips) {
        const errorLogs = [];
        let errorId = 1;

        // Gera erros para 30% dos equipamentos
        equips.forEach(eq => {
            if (Math.random() > 0.7) {
                const isCritico = Math.random() > 0.8;
                const entry = {
                    id: (errorId++).toString(),
                    titulo: isCritico ? "Falha de Hardware" : "Alerta de Insumo",
                    descricao: isCritico ? "Disco rígido não detectado na inicialização" : "Nível de toner baixo ( < 10% )",
                    codigo_erro: isCritico ? "HD_FAIL_001" : "TONER_LOW",
                    severidade: isCritico ? "Crítico" : "Alerta",
                    data_hora: new Date().toISOString(),
                    resolvido: false, // Erro ativo
                    
                    id_computador: eq.tipo === 'computador' ? eq.id : null,
                    id_impressora: eq.tipo === 'impressora' ? eq.id : null,
                    id_os_gerada: null
                };
                errorLogs.push(entry);
            }
        });
        
        this._save('log_erros', errorLogs);
    }

    // --- MÉTODOS CRUD GENÉRICOS ---
    async get(resource) { await this._delay(); return this._getCollection(resource); }
    async getById(resource, id) { await this._delay(); return this._getCollection(resource).find(i => String(i.id) === String(id)); }
    
    async post(resource, data) {
        await this._delay();
        const collection = this._getCollection(resource);
        const newItem = { ...data, id: (Date.now() + Math.floor(Math.random()*1000)).toString() };
        collection.push(newItem);
        this._save(resource, collection);
        return newItem;
    }

    async put(resource, id, data) {
        await this._delay();
        const collection = this._getCollection(resource);
        const index = collection.findIndex(i => String(i.id) === String(id));
        if (index === -1) throw new Error('404 Not Found');
        collection[index] = { ...collection[index], ...data };
        this._save(resource, collection);
        return collection[index];
    }

    async delete(resource, id) {
        await this._delay();
        const collection = this._getCollection(resource);
        const index = collection.findIndex(i => String(i.id) === String(id));
        if (index === -1) return false;
        collection.splice(index, 1);
        this._save(resource, collection);
        return true;
    }

    async login(creds) {
        await this._delay();
        const users = this._getCollection('users');
        const user = users.find(u => u.cpf === creds.cpf && u.senha === creds.password);
        if (user) {
            const sectors = this._getCollection('sectors');
            const sec = sectors.find(s => String(s.id) === String(user.id_setor));
            return { token: 'jwt', user: { ...user, setor: sec ? sec.nome : '' } };
        }
        throw new Error('Credenciais inválidas');
    }

    _getCollection(key) {
        // Mapeamento atualizado
        const map = { 
            'cities': 'app_cities', 
            'companies': 'app_companies', 
            'sectors': 'app_sectors', 
            'users': STORAGE_KEYS.DB_USERS, 
            'equipments': STORAGE_KEYS.DB_EQUIPMENTS, 
            'os': STORAGE_KEYS.DB_OS, 
            'logs': STORAGE_KEYS.DB_LOGS,
            'log_erros': 'app_log_erros' // Mapeamento novo
        };
        return JSON.parse(localStorage.getItem(map[key] || key) || '[]');
    }

    _save(key, data) {
        const map = { 
            'cities': 'app_cities', 
            'companies': 'app_companies', 
            'sectors': 'app_sectors', 
            'users': STORAGE_KEYS.DB_USERS, 
            'equipments': STORAGE_KEYS.DB_EQUIPMENTS, 
            'os': STORAGE_KEYS.DB_OS, 
            'logs': STORAGE_KEYS.DB_LOGS,
            'log_erros': 'app_log_erros'
        };
        localStorage.setItem(map[key] || key, JSON.stringify(data));
    }

    _generateRandomCNPJ() { return '00.000.000/0001-91'; }
    _delay() { return new Promise(r => setTimeout(r, 50)); }
}

export const MockDatabase = new MockDatabaseClass();
==================================================
CAMINHO: .\js\pages\cadastro_equipamento.js
==================================================
/* js/pages/cadastro_equipamento.js */
import { BaseFormPage } from '../core/BaseFormPage.js';
import { EquipamentoService } from '../services/equipamento.service.js';
import { UsuariosService } from '../services/usuarios.service.js'; 
import { SetorService } from '../services/setor.service.js';
import { setupInputMasks, InputManager } from '../components/inputs.js';
import { DOMUtils } from '../utils.js';

class CadastroEquipamentoPage extends BaseFormPage {
    constructor() {
        super({
            formId: 'cadastro-form',
            service: EquipamentoService,
            redirectUrl: 'equipamento.html',
            resourceName: 'Equipamento'
        });
        
        this.typeSelect = document.getElementById('equip-type-select');
        this.dynamicContainer = document.getElementById('dynamic-fields');
        this.listas = { setores: [], usuarios: [] };
    }

    async init() {
        await this.carregarDadosListas();

        if (this.typeSelect) {
            this.typeSelect.addEventListener('change', () => this.renderFields());
        }
        
        this.renderFields();
        await super.init();
    }

    async carregarDadosListas() {
        try {
            const [setores, usuarios] = await Promise.all([
                SetorService.getAll(),
                UsuariosService.getAll()
            ]);
            this.listas.setores = setores;
            this.listas.usuarios = usuarios;
        } catch (e) {
            console.error(e);
        }
    }

    // --- RENDERIZAÇÃO LIMPA ---
    renderFields() {
        if (!this.dynamicContainer) return;
        
        const type = this.typeSelect ? this.typeSelect.value : 'computador';
        this.dynamicContainer.innerHTML = ''; 

        // Opções de Setor e Usuário
        const opcoesSetor = this.listas.setores.map(s => {
            const empresa = s.nome_empresa || s.empresa || '?';
            const cidade = s.nome_cidade || s.cidade || '?';
            return { 
                value: s.id, 
                label: `${s.nome} - ${empresa} (${cidade})` 
            };
        });

        const opcoesUsuario = this.listas.usuarios.map(u => ({
            value: u.id, 
            label: `${u.nome} (CPF: ${u.cpf})`
        }));

        // Criação dos Campos Comuns
        const fieldUsuario = this.createSelectField('Usuário Responsável', 'usuario', opcoesUsuario, '-- Sem vínculo (Livre) --', true);
        const fieldSetor = this.createSelectField('Setor', 'setor', opcoesSetor, '-- Selecione o Setor --');
        
        // --- CAMPO SALA (Antigo Nome/Identificação) ---
        const fieldSala = this.createTextField('Sala / Localização', 'sala', 'Ex: Sala 104, Recepção');

        const fields = [];
        
        if (type === 'computador') {
            fields.push(this.createTextField('Nº Série', 'serie', 'Ex: NPX-000', 'serial'));
            fields.push(this.createTextField('Modelo', 'modelo', 'Ex: Dell Optiplex 3050'));
            
            // Adiciona Sala
            fields.push(fieldSala);
            
            fields.push(fieldUsuario); 
            fields.push(fieldSetor);
        } else {
            // IMPRESSORA
            fields.push(this.createTextField('Nº Série', 'serie', 'Ex: HP-999', 'serial'));
            fields.push(this.createTextField('Modelo', 'modelo', 'Ex: HP Laserjet Pro'));
            
            // Adiciona Sala
            fields.push(fieldSala);
            
            fields.push(fieldUsuario); 
            fields.push(fieldSetor);
        }

        fields.forEach(field => this.dynamicContainer.appendChild(field));
        setupInputMasks();
    }

    // --- CAPTURA DE DADOS ---
    getExtraData() {
        const setorInput = this.dynamicContainer.querySelector('[name="setor"]');
        const usuarioInput = this.dynamicContainer.querySelector('[name="usuario"]');
        const salaInput = this.dynamicContainer.querySelector('[name="sala"]');
        
        let usuarioValor = '';
        let usuarioId = null;

        if (usuarioInput && usuarioInput.selectedIndex > 0) {
            usuarioId = usuarioInput.value;
            usuarioValor = usuarioInput.options[usuarioInput.selectedIndex].text;
            if(usuarioValor.includes(' (CPF:')) usuarioValor = usuarioValor.split(' (CPF:')[0];
        }

        return {
            tipo: this.typeSelect ? this.typeSelect.value : null,
            id_setor: setorInput ? setorInput.value : null,
            id_usuario: usuarioId,
            usuario: usuarioValor,
            
            // Salva apenas Sala
            sala: salaInput ? salaInput.value : ''
        };
    }

    validate() {
        const inputs = this.dynamicContainer.querySelectorAll('input[required], select[required]');
        let isValid = true;
        inputs.forEach(input => {
            if (!input.value.trim()) {
                InputManager.setError(input, 'Campo obrigatório.');
                isValid = false;
            }
        });
        return isValid;
    }

    // --- PREENCHIMENTO NA EDIÇÃO ---
    afterFillForm(data) {
        if (this.typeSelect) {
            this.typeSelect.value = data.tipo;
            this.typeSelect.disabled = true; 
            this.typeSelect.style.backgroundColor = "var(--bg-surface)"; 
            this.typeSelect.style.opacity = "0.7";
        }
        
        this.renderFields();
        
        const inputs = this.dynamicContainer.querySelectorAll('input, select');
        
        inputs.forEach(input => {
            if (input.name === 'setor') {
                if (data.id_setor) {
                    input.value = data.id_setor;
                    if (!input.value && data.id_setor) {
                        const opt = document.createElement('option');
                        opt.value = data.id_setor;
                        opt.text = `Setor ID ${data.id_setor} (Arquivado)`;
                        opt.selected = true;
                        input.add(opt);
                    }
                }
            } 
            else if (input.name === 'usuario') {
                if (data.id_usuario) {
                    input.value = data.id_usuario;
                } else if (data.usuario) {
                    let found = false;
                    for (let i = 0; i < input.options.length; i++) {
                        if (input.options[i].text.includes(data.usuario)) {
                            input.selectedIndex = i;
                            found = true;
                            break;
                        }
                    }
                    if (!found) {
                        const opt = document.createElement('option');
                        opt.value = '';
                        opt.text = `${data.usuario} (Legado)`;
                        opt.selected = true;
                        input.add(opt);
                    }
                }
            }
            // Preenche SALA e outros campos
            else if (data[input.name]) {
                input.value = data[input.name];
            }
        });
    }

    createSelectField(label, name, options, placeholder, isOptional = false) {
        const labelEl = DOMUtils.create('label', {}, label);
        if(isOptional) labelEl.appendChild(DOMUtils.create('small', { style: {color: '#888', marginLeft: '5px'} }, '(Opcional)'));

        const selectProps = { name: name, className: 'custom-select' };
        if (!isOptional) selectProps.required = 'true';

        const selectEl = DOMUtils.create('select', selectProps);
        selectEl.appendChild(DOMUtils.create('option', { value: '' }, placeholder));

        options.forEach(opt => {
            selectEl.appendChild(DOMUtils.create('option', { value: opt.value }, opt.label));
        });

        const iconEl = DOMUtils.create('i', { className: 'fas fa-chevron-down select-icon' });
        const wrapperEl = DOMUtils.create('div', { className: 'custom-select-wrapper' }, [selectEl, iconEl]);
        const errorSpan = DOMUtils.create('span', { className: 'erro-msg', id: `erro-${name}` });

        return DOMUtils.create('div', { className: 'form-group animate-fade' }, [ labelEl, wrapperEl, errorSpan ]);
    }

    createTextField(label, name, placeholder, mask = null) {
        const labelEl = DOMUtils.create('label', {}, label);
        const inputEl = DOMUtils.create('input', {
            type: 'text', name: name, className: 'custom-input', 
            placeholder: placeholder, required: 'true',
            style: { width: '100%', padding: '12px 15px', borderRadius: '8px', border: '1px solid var(--border-input)', backgroundColor: 'var(--bg-input)', fontSize: '16px', color: 'var(--text-primary)' }
        });
        if (mask) inputEl.dataset.mask = mask;
        const errorSpan = DOMUtils.create('span', { className: 'erro-msg', id: `erro-${name}` });
        return DOMUtils.create('div', { className: 'form-group animate-fade' }, [labelEl, inputEl, errorSpan]);
    }
}

new CadastroEquipamentoPage().init();
==================================================
CAMINHO: .\js\pages\cadastro_os.js
==================================================
/* js/pages/cadastro_os.js */
import { BaseFormPage } from '../core/BaseFormPage.js';
import { OsService } from '../services/os.service.js';
import { EquipamentoService } from '../services/equipamento.service.js';
import { UsuariosService } from '../services/usuarios.service.js';
import { SetorService } from '../services/setor.service.js';
import { ErrorLogService } from '../services/error_log.service.js'; // Import novo essencial
import { AuthService } from '../services/auth.service.js';
import { NavigationService } from '../services/navigation.service.js';
import { showToast } from '../components/toast.js';

class CadastroOsPage extends BaseFormPage {
    constructor() {
        super({
            formId: 'cadastro-os-form',
            service: OsService,
            redirectUrl: 'os.html',
            resourceName: 'Ordem de Serviço'
        });

        // Referências aos elementos do DOM
        this.equipSelect = document.getElementById('equipamento');
        this.solicitanteSelect = document.getElementById('solicitante');
        this.tecnicoSelect = document.getElementById('tecnico');
        this.setorSelect = document.getElementById('setor');
        this.descInput = document.getElementById('descricao');

        this.allEquipments = [];
        this.currentUser = AuthService.getUser();
    }

    async init() {
        const isCommon = this.currentUser && (this.currentUser.tipo.includes('Comum') || this.currentUser.tipo.includes('Usuário'));
        
        if (isCommon) {
            this.redirectUrl = 'user_panel.html';
            document.body.classList.add('layout-full-width');
        }

        // 1. Carrega as listas (Setores, Usuários, Equipamentos)
        await this.loadDependencies();

        // 2. Configura evento de troca de setor
        if (this.setorSelect) {
            this.setorSelect.addEventListener('change', (e) => {
                this.filterEquipmentsBySector(e.target.value);
            });
        }

        // 3. Inicializa a lógica base (Isso vai chamar o afterFillForm se for edição)
        await super.init();

        // --- 5. NOVO: VERIFICA SE VEIO DE UM ERRO DO MONITORAMENTO ---
        // (Só executa se NÃO estiver editando uma O.S. existente)
        const urlParams = new URLSearchParams(window.location.search);
        const errorId = urlParams.get('fromError');
        
        if (errorId && !this.editId) { 
            await this.loadFromError(errorId);
        }
        
        // 4. Lógica específica para Usuário Comum
        if (isCommon) {
            if(this.header) {
                this.header.render(() => NavigationService.navigate(this.redirectUrl), 'history');
                this.header.updateButtons('only-back');
            }
            if(this.sidebar) this.sidebar.render(null, () => {}, false);
            
            this.lockSolicitanteField();
            
            // Esconde campo técnico para usuários comuns
            if(this.tecnicoSelect) {
                const formGroup = this.tecnicoSelect.closest('.form-group');
                if(formGroup) formGroup.style.display = 'none';
            }

            // Se for cadastro novo, auto-seleciona setor do usuário logado
            if (!this.editId && this.currentUser.id_setor) {
                this.setorSelect.value = this.currentUser.id_setor;
                this.filterEquipmentsBySector(this.currentUser.id_setor);
            }
        }
    }

    async loadDependencies() {
        const [allEquips, setores, users] = await Promise.all([
            EquipamentoService.getAll(),
            SetorService.getAll(),
            UsuariosService.getAll()
        ]);
        this.allEquipments = allEquips;

        // Preenche Setores
        if(this.setorSelect) {
            this.setorSelect.innerHTML = '<option value="">Selecione...</option>';
            setores.sort((a,b) => a.nome.localeCompare(b.nome)).forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.id; 
                opt.text = `${s.nome} (${s.nome_empresa || '-'})`;
                this.setorSelect.add(opt);
            });
        }

        // Preenche Solicitantes
        if(this.solicitanteSelect) {
            this.solicitanteSelect.innerHTML = '<option value="">Selecione...</option>';
            users.forEach(u => {
                const opt = document.createElement('option');
                opt.value = u.id; 
                opt.text = u.nome;
                this.solicitanteSelect.add(opt);
            });
        }

        // Preenche Técnicos
        if(this.tecnicoSelect) {
            // Salva a opção "Aguardando" se existir
            const defaultOpt = this.tecnicoSelect.firstElementChild ? this.tecnicoSelect.firstElementChild.cloneNode(true) : null;
            this.tecnicoSelect.innerHTML = '';
            if(defaultOpt) this.tecnicoSelect.appendChild(defaultOpt);
            
            users.forEach(u => {
                // Adiciona apenas técnicos e admins na lista de responsáveis (opcional, aqui lista todos)
                const opt = document.createElement('option');
                opt.value = u.id; 
                opt.text = u.nome;
                this.tecnicoSelect.add(opt);
            });
        }
    }

    filterEquipmentsBySector(sectorId, selectedId = null) {
        this.equipSelect.innerHTML = '<option value="">Selecione...</option>';
        this.equipSelect.disabled = true;
        if (!sectorId) return;

        const filtered = this.allEquipments.filter(eq => String(eq.id_setor) === String(sectorId));

        if (filtered.length > 0) {
            this.equipSelect.disabled = false;
            filtered.forEach(eq => {
                const opt = document.createElement('option');
                opt.value = eq.id;
                // Exibe: TIPO - MODELO (SALA)
                const salaInfo = eq.sala ? ` - ${eq.sala}` : '';
                opt.text = `${eq.tipo.toUpperCase()} - ${eq.modelo}${salaInfo}`;
                opt.dataset.type = eq.tipo;
                this.equipSelect.add(opt);
            });
        } else {
            this.equipSelect.innerHTML = '<option value="">Nenhum equipamento neste setor</option>';
        }
        
        if (selectedId) this.equipSelect.value = selectedId;
    }

    lockSolicitanteField() {
        if (!this.solicitanteSelect) return;
        this.solicitanteSelect.value = this.currentUser.id;
        this.solicitanteSelect.style.pointerEvents = "none";
        this.solicitanteSelect.style.background = "#eee";
        this.solicitanteSelect.classList.add('readonly-field');
    }

    getExtraData() {
        const extra = {};
        
        // Mapeia os selects do HTML para as colunas do Banco
        if (this.solicitanteSelect) extra.id_usuario_solicitante = this.solicitanteSelect.value;
        if (this.tecnicoSelect && this.tecnicoSelect.value) {
            extra.id_usuario_responsavel = this.tecnicoSelect.value;
        }

        // Lógica do Equipamento (Computador vs Impressora)
        const selectedId = this.equipSelect.value;
        if (selectedId && this.equipSelect.selectedIndex >= 0) {
            const selectedOption = this.equipSelect.options[this.equipSelect.selectedIndex];
            const type = selectedOption.dataset.type; 
            
            if (type === 'computador') {
                extra.id_computador = selectedId;
                extra.id_impressora = null;
            } else {
                extra.id_impressora = selectedId;
                extra.id_computador = null;
            }
        }
        
        extra.id_setor = this.setorSelect.value;

        if (!this.editId) {
            extra.data_abertura = new Date().toISOString();
            extra.status = 'Aberto';
        }

        return extra;
    }

    // --- CHAMADO AUTOMATICAMENTE PELA CLASSE MÃE NA EDIÇÃO ---
    afterFillForm(data) {
        // Preenche Descrição
        if(this.descInput) this.descInput.value = data.descricao_problema || '';
        
        // 1. Preenche Setor e Dispara Filtro
        if(this.setorSelect) {
            this.setorSelect.value = data.id_setor;
            
            // Fallback se o setor foi arquivado (não existe na lista atual)
            if(String(this.setorSelect.value) !== String(data.id_setor)) {
                const opt = document.createElement('option');
                opt.value = data.id_setor;
                opt.text = `Setor ID ${data.id_setor} (Arquivado)`;
                this.setorSelect.add(opt);
                this.setorSelect.value = data.id_setor;
            }
        }

        // 2. Filtra Equipamentos com base no Setor carregado e seleciona o correto
        const equipId = data.id_computador || data.id_impressora;
        this.filterEquipmentsBySector(data.id_setor, equipId);
        
        // 3. Seleciona Solicitante
        if(this.solicitanteSelect && data.id_usuario_solicitante) {
            this.solicitanteSelect.value = data.id_usuario_solicitante;
        }
        
        // 4. Seleciona Técnico
        if(this.tecnicoSelect && data.id_usuario_responsavel) {
            this.tecnicoSelect.value = data.id_usuario_responsavel;
        }

        const title = document.querySelector('.form-header-title h2');
        if(title) title.innerText = 'Editar Ordem de Serviço';
    }

    // --- NOVO MÉTODO: CARREGA DADOS DO MONITORAMENTO ---
    async loadFromError(errorId) {
        try {
            // Busca via Service (Backend Ready)
            const errorItem = await ErrorLogService.getById(errorId);

            if (errorItem) {
                console.log("Carregando dados do erro:", errorItem);

                // A. Preenche Descrição
                if (this.descInput) {
                    this.descInput.value = `[AUTO] Monitoramento: ${errorItem.titulo}\nCód: ${errorItem.codigo_erro}\nDetalhes: ${errorItem.descricao}`;
                }

                // B. Tenta selecionar o Equipamento e Setor
                const equipId = errorItem.id_computador || errorItem.id_impressora;
                
                // Procura o equipamento na lista completa carregada
                const equip = this.allEquipments.find(e => String(e.id) === String(equipId));
                
                if (equip) {
                    // 1. Seleciona o Setor do Equipamento
                    if (this.setorSelect) {
                        this.setorSelect.value = equip.id_setor;
                        // Dispara o filtro para carregar o dropdown de equipamentos deste setor
                        this.filterEquipmentsBySector(equip.id_setor, equip.id); 
                    }
                }
                
                showToast('Dados do erro importados. Complete o chamado.', 'info');
                
                // Nota: O backend real deverá tratar o vínculo do erro com a nova O.S. no momento do POST.
            }
        } catch (e) {
            console.error("Erro ao carregar dados do erro:", e);
            showToast('Erro ao carregar dados do monitoramento.', 'error');
        }
    }
}

new CadastroOsPage().init();
==================================================
CAMINHO: .\js\pages\cadastro_setor.js
==================================================
/* js/pages/cadastro_setor.js */
import { BaseFormPage } from '../core/BaseFormPage.js';
import { SetorService } from '../services/setor.service.js';
import { showToast } from '../components/toast.js';
import { NavigationService, ROUTES } from '../services/navigation.service.js';

class CadastroSetorPage extends BaseFormPage {
    constructor() {
        super({
            formId: 'sector-form', 
            service: SetorService,
            redirectUrl: 'setores.html',
            resourceName: 'Setor'
        });
        
        // Elementos do Formulário Principal
        this.citySelect = document.getElementById('city-select');
        this.companySelect = document.getElementById('company-select');
        this.btnAddCity = document.getElementById('btn-add-city');
        this.btnAddCompany = document.getElementById('btn-add-company');
        
        // Elementos do Modal de Cidade
        this.modalCity = document.getElementById('modal-city');
        this.formCity = document.getElementById('form-city-modal');
        this.inpCityName = document.getElementById('modal-city-name');
        this.inpCityUF = document.getElementById('modal-city-uf');

        // Elementos do Modal de Empresa
        this.modalCompany = document.getElementById('modal-company');
        this.formCompany = document.getElementById('form-company-modal');
        this.inpCompCityReadonly = document.getElementById('modal-company-city-readonly');
        this.inpCompName = document.getElementById('modal-company-name');
        this.inpCompCNPJ = document.getElementById('modal-company-cnpj');
        this.inpCompDesc = document.getElementById('modal-company-desc');
        this.inpCompObs = document.getElementById('modal-company-obs');

        this.currentId = null;
    }

    async init() {
        // Carrega Cidades usando IDs
        await this.loadCities();
        
        // Bind inicial do select de cidade
        if(this.citySelect) {
            this.citySelect.addEventListener('change', (e) => {
                this.loadCompanies(e.target.value); // Passa o ID
                if(this.btnAddCompany) {
                    this.btnAddCompany.disabled = !e.target.value;
                }
            });
        }

        this.bindModalEvents();
        
        // Inicializa super mas sobrescrevemos o submit depois
        await super.init();
        this.replaceSubmitHandler();

        const urlParams = new URLSearchParams(window.location.search);
        this.currentId = urlParams.get('id');
        if (this.currentId) {
            await this.forceLoadData(this.currentId);
        }
    }

    async loadCities() {
        // Pega lista de cidades (objeto com id e nome)
        const cities = await SetorService.getCitiesForDropdown();
        this.citySelect.innerHTML = '<option value="">Selecione uma cidade...</option>';
        cities.forEach(city => {
            const option = document.createElement('option');
            option.value = city.id; // VALUE AGORA É ID
            option.textContent = city.nome;
            this.citySelect.appendChild(option);
        });
    }

    async loadCompanies(cityId, autoSelectValue = null) {
        this.companySelect.innerHTML = '<option value="">Carregando...</option>';
        this.companySelect.disabled = true;
        
        if(this.btnAddCompany) this.btnAddCompany.disabled = !cityId;

        if (!cityId) {
            this.companySelect.innerHTML = '<option value="">Selecione a cidade primeiro...</option>';
            return;
        }

        try {
            // Busca empresas pelo ID DA CIDADE
            const companies = await SetorService.getCompaniesByCityId(cityId);
            this.companySelect.innerHTML = '<option value="">Selecione uma empresa...</option>';
            
            companies.forEach(company => {
                const option = document.createElement('option');
                option.value = company.id; // VALUE AGORA É ID
                option.textContent = company.nome;
                this.companySelect.appendChild(option);
            });
            this.companySelect.disabled = false;

            if (autoSelectValue) {
                this.companySelect.value = autoSelectValue;
            }
        } catch (error) { console.error(error); }
    }

    bindModalEvents() {
        // --- 1. MODAL CIDADE ---
        if (this.btnAddCity) {
            this.btnAddCity.onclick = (e) => {
                e.preventDefault(); // Evita submit do form principal
                this.formCity.reset();
                this.modalCity.classList.add('active');
                setTimeout(() => this.inpCityName.focus(), 100);
            };
        }

        if (this.formCity) {
            this.formCity.onsubmit = async (e) => {
                e.preventDefault();
                const nome = this.inpCityName.value.trim();
                const uf = this.inpCityUF.value.trim().toUpperCase();

                if (!nome || !uf) return showToast('Preencha Nome e UF.', 'warning');

                try {
                    await SetorService.addCity({ nome, uf });
                    showToast('Cidade cadastrada!', 'success');
                    
                    this.modalCity.classList.remove('active');
                    await this.loadCities();
                    
                    // Como não sabemos o ID gerado sem retorno explícito no mock simples,
                    // recarregamos e tentamos achar pelo nome para selecionar (UX)
                    const cities = await SetorService.getCitiesForDropdown();
                    const created = cities.find(c => c.nome === nome);
                    if(created) {
                        this.citySelect.value = created.id;
                        this.citySelect.dispatchEvent(new Event('change'));
                    }
                } catch (err) {
                    console.error(err);
                    showToast('Erro ao salvar cidade.', 'error');
                }
            };
        }

        // --- 2. MODAL EMPRESA ---
        if (this.btnAddCompany) {
            this.btnAddCompany.onclick = (e) => {
                e.preventDefault();
                const currentCityId = this.citySelect.value;
                if (!currentCityId) return showToast('Selecione uma cidade antes.', 'warning');

                this.formCompany.reset();
                this.inpCompCityReadonly.value = this.citySelect.options[this.citySelect.selectedIndex].text;
                this.modalCompany.classList.add('active');
            };
        }

        if (this.formCompany) {
            this.formCompany.onsubmit = async (e) => {
                e.preventDefault();
                const cityId = this.citySelect.value; // ID
                const nome = this.inpCompName.value.trim();
                
                try {
                    await SetorService.addCompany({
                        nome: nome,
                        cnpj: this.inpCompCNPJ.value.trim(),
                        descricao: this.inpCompDesc.value,
                        observacao: this.inpCompObs.value,
                        cidade_vinculada: cityId // Envia ID
                    });
                    
                    showToast('Empresa salva!', 'success');
                    this.modalCompany.classList.remove('active');
                    await this.loadCompanies(cityId); 
                    
                    // UX: Tenta selecionar a empresa recém criada
                    // (Lógica simplificada pois loadCompanies é assíncrono)
                    // ... Usuário seleciona manualmente
                } catch (err) {
                    console.error(err);
                    showToast('Erro ao salvar empresa.', 'error');
                }
            };
        }

        // --- FECHAR MODAIS ---
        document.querySelectorAll('.modal-close, .modal-overlay .btn-cancel').forEach(btn => {
            btn.onclick = (e) => {
                const modal = e.target.closest('.modal-overlay');
                if (modal) modal.classList.remove('active');
            };
        });
    }

    replaceSubmitHandler() {
        const form = document.getElementById('sector-form');
        const newForm = form.cloneNode(true);
        form.parentNode.replaceChild(newForm, form);
        
        // Re-mapeia as referências pois o clone removeu as antigas
        this.citySelect = document.getElementById('city-select');
        this.companySelect = document.getElementById('company-select');
        this.btnAddCity = document.getElementById('btn-add-city');
        this.btnAddCompany = document.getElementById('btn-add-company');

        // Re-bind change
        this.citySelect.addEventListener('change', (e) => {
            this.loadCompanies(e.target.value);
            if(this.btnAddCompany) this.btnAddCompany.disabled = !e.target.value;
        });
        
        // Re-bind dos modais (importante!)
        this.bindModalEvents();

        newForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                nome: document.getElementById('nome').value.trim(),
                localizacao: document.getElementById('localizacao').value.trim(),
                observacao: document.getElementById('observacao').value.trim(),
                // Importante: Service espera 'empresa' como ID para salvar
                // (No SQL: id_empresa)
                empresa: this.companySelect.value 
            };

            if (!formData.nome || !this.citySelect.value || !formData.empresa) {
                return showToast('Preencha os campos obrigatórios (*)', 'error');
            }

            try {
                if (this.currentId) {
                    // Atualiza enviando ID da empresa
                    await this.service.update(this.currentId, formData);
                    showToast('Setor atualizado!', 'success');
                } else {
                    await this.service.add(formData);
                    showToast('Setor criado!', 'success');
                }
                setTimeout(() => NavigationService.navigate(ROUTES.SECTORS_LIST), 500);
            } catch (error) { 
                console.error(error);
                showToast('Erro ao salvar.', 'error'); 
            }
        });
    }

    async forceLoadData(id) {
        try {
            const data = await this.service.getById(id);
            if (!data) return;

            document.getElementById('nome').value = data.nome || '';
            document.getElementById('localizacao').value = data.localizacao || '';
            document.getElementById('observacao').value = data.observacao || '';

            // Lógica de "Reverse Lookup": 
            // O setor tem id_empresa. Precisamos achar a empresa para saber qual cidade selecionar.
            const allCompanies = await SetorService.getCompaniesFull();
            const myCompany = allCompanies.find(c => String(c.id) === String(data.id_empresa));

            if (myCompany) {
                // Seleciona Cidade (ID)
                this.citySelect.value = myCompany.id_cidade;
                // Carrega Empresas daquela cidade e seleciona a empresa certa
                await this.loadCompanies(myCompany.id_cidade, myCompany.id);
            }
            
            const title = document.querySelector('.form-header-title h2');
            if(title) title.innerText = 'Alterar Setor';
        } catch (error) { console.error(error); }
    }
}

new CadastroSetorPage().init();
==================================================
CAMINHO: .\js\pages\cadastro_usuario.js
==================================================
/* js/pages/cadastro_usuario.js */
import { BaseFormPage } from '../core/BaseFormPage.js';
import { UsuariosService } from '../services/usuarios.service.js';
import { SetorService } from '../services/setor.service.js';
import { InputManager, Validators } from '../components/inputs.js';
import { AuthService } from '../services/auth.service.js';
import { NavigationService } from '../services/navigation.service.js';

class CadastroUsuarioPage extends BaseFormPage {
    constructor() {
        super({
            formId: 'cadastro-usuario-form',
            service: UsuariosService,
            redirectUrl: 'usuarios.html',
            resourceName: 'Usuário'
        });
        this.cpfInput = document.getElementById('cpf');
        this.senhaInput = document.getElementById('senha');
        this.tipoSelect = document.getElementById('tipo');
        this.setorSelect = document.getElementById('setor'); 
        this.currentUser = AuthService.getUser();
    }

    async init() {
        // 1. Carrega lista de setores (Agora com IDs)
        await this.carregarSetores();
        
        // 2. Carrega dados do usuário (Preenche o form)
        await super.init();
        
        // 3. Filtros de segurança
        this.applyPermissionFilters();
        if (this.editId) await this.silentSecurityCheck();
    }

    async carregarSetores() {
        const setores = await SetorService.getAll();
        
        this.setorSelect.innerHTML = '<option value="" selected disabled>Selecione o setor...</option>';
        setores.forEach(s => {
            const opt = document.createElement('option');
            // --- MUDANÇA: O valor agora é o ID, não o nome ---
            opt.value = s.id; 
            // Exibição: Nome (Empresa)
            opt.text = `${s.nome} (${s.nome_empresa || s.empresa || '-'})`;
            this.setorSelect.add(opt);
        });
    }

    // --- PREPARAÇÃO DO PAYLOAD PARA O BANCO ---
    getExtraData() {
        return {
            // Garante que estamos enviando o campo id_setor para o banco
            id_setor: this.setorSelect.value
        };
    }

    afterFillForm(data) {
        // --- TIPO ---
        if (data.tipo && this.tipoSelect) {
            this.tipoSelect.value = data.tipo;
            if (this.tipoSelect.value !== data.tipo) {
                const opt = document.createElement('option');
                opt.text = data.tipo;
                opt.value = data.tipo;
                this.tipoSelect.add(opt);
                this.tipoSelect.value = data.tipo;
            }
        }
        
        // --- CORREÇÃO SETOR (USANDO ID) ---
        // Verifica se existe o ID do setor no objeto carregado
        if (data.id_setor && this.setorSelect) {
            this.setorSelect.value = data.id_setor;
            
            // Se não pegou (setor deletado ou ID não encontrado na lista atual)
            // Cria uma opção visual para não deixar o campo vazio
            if (String(this.setorSelect.value) !== String(data.id_setor)) {
                const opt = document.createElement('option');
                opt.text = `Setor ID ${data.id_setor} (Arquivado/Removido)`;
                opt.value = data.id_setor;
                this.setorSelect.add(opt);
                this.setorSelect.value = data.id_setor;
            }
        }
        
        this.senhaInput.required = false;
        this.senhaInput.placeholder = "Deixe em branco para manter a atual";
    }

    // --- CÓDIGOS ORIGINAIS MANTIDOS ---
    async silentSecurityCheck() {
        if (!this.currentUser || !this.editId) return;
        const targetUser = await this.service.getById(this.editId);
        if (!targetUser) return;
        const myRole = (this.currentUser.tipo || '').toLowerCase();
        const targetRole = (targetUser.tipo || '').toLowerCase();
        if (myRole.includes('técnico') && !targetRole.includes('usuário') && !targetRole.includes('comum')) {
            NavigationService.navigate('usuarios.html');
        }
    }

    applyPermissionFilters() {
        if (!this.currentUser || !this.tipoSelect) return;
        const myRole = (this.currentUser.tipo || '').toLowerCase();
        if (myRole.includes('técnico')) {
            Array.from(this.tipoSelect.options).forEach(opt => {
                if (!opt.value.toLowerCase().includes('usuário') && !opt.value.toLowerCase().includes('comum')) {
                    opt.remove();
                }
            });
        }
    }

    addExtraListeners() {
        const toggleBtn = document.getElementById('togglePassword');
        if(toggleBtn) {
            toggleBtn.addEventListener('click', () => {
                this.senhaInput.type = this.senhaInput.type === 'password' ? 'text' : 'password';
                toggleBtn.classList.toggle('fa-eye');
                toggleBtn.classList.toggle('fa-eye-slash');
            });
        }
        this.form.addEventListener('input', (e) => InputManager.clearError(e.target));
    }

    validate() {
        let isValid = true;
        InputManager.clearAllErrors(this.form);
        if (!Validators.required(this.cpfInput.value)) {
            InputManager.setError(this.cpfInput, "CPF obrigatório.");
            isValid = false;
        } else if (!Validators.cpf(this.cpfInput.value)) {
            InputManager.setError(this.cpfInput, "CPF inválido.");
            isValid = false;
        }
        if (!this.editId && !Validators.required(this.senhaInput.value)) {
            InputManager.setError(this.senhaInput, "Senha obrigatória.");
            isValid = false;
        } 
        if (!Validators.required(this.tipoSelect.value)) {
            InputManager.setError(this.tipoSelect, "Selecione um tipo.");
            isValid = false;
        }
        if (!Validators.required(this.setorSelect.value)) {
            InputManager.setError(this.setorSelect, "Selecione um setor.");
            isValid = false;
        }
        return isValid;
    }
}

new CadastroUsuarioPage().init();
==================================================
CAMINHO: .\js\pages\dashboard.js
==================================================
/* js/pages/dashboard.js */
import { HeaderComponent } from '../components/header.js';
import { SidebarComponent } from '../components/sidebar.js';
import { EquipamentoService } from '../services/equipamento.service.js';
import { ErrorLogService } from '../services/error_log.service.js';
import { SetorService } from '../services/setor.service.js';
import { NavigationService, ROUTES } from '../services/navigation.service.js';
import { DOMUtils } from '../utils.js';

class DashboardPage {
    constructor() {
        this.header = new HeaderComponent('app-header');
        this.sidebar = new SidebarComponent('tree-menu-container');
    }

    async init() {
        document.body.classList.add('layout-full-width');
        this.header.render(null, 'dashboard');
        this.header.updateButtons('dashboard');
        this.sidebar.render(await SetorService.getTreeStructure());
        await this.loadDashboardData();
    }

    async loadDashboardData() {
        try {
            const [equips, errors, sectors] = await Promise.all([
                EquipamentoService.getAll(),
                ErrorLogService.getActiveErrors(),
                SetorService.getAll()
            ]);
            this.renderKPIs(equips, errors);
            this.renderPrinterList(equips);
            this.renderCityStats(equips, sectors);
            this.renderErrorList(errors);
        } catch (e) {
            console.error("Erro ao carregar dashboard:", e);
        }
    }

    renderKPIs(equips, errors) {
        const pcs = equips.filter(e => e.tipo === 'computador').length;
        const printers = equips.filter(e => e.tipo === 'impressora').length;
        const activeErrors = errors.length;

        document.getElementById('total-pcs').innerText = pcs;
        document.getElementById('total-printers').innerText = printers;
        document.getElementById('total-errors').innerText = activeErrors;
    }

    renderPrinterList(equips) {
        const container = document.getElementById('printer-list');
        container.innerHTML = '';

        const topPrinters = equips
            .filter(e => e.tipo === 'impressora')
            .map(e => {
                const count = parseInt((e.contador || '0').replace(/\D/g, '')) || 0;
                return { ...e, rawCount: count };
            })
            .sort((a, b) => b.rawCount - a.rawCount)
            .slice(0, 5);

        if (topPrinters.length === 0) {
            container.innerHTML = '<div style="color:#999; text-align:center; padding:10px;">Sem dados de impressão</div>';
            return;
        }

        const maxVal = topPrinters[0].rawCount || 1;

        topPrinters.forEach((p, index) => {
            const percent = Math.round((p.rawCount / maxVal) * 100);
            const row = DOMUtils.create('div', { 
                className: 'list-row',
                onclick: () => NavigationService.navigate(ROUTES.EQUIPMENT_LIST, { select: p.id })
            });

            row.innerHTML = `
                <span class="row-id">#${index + 1}</span>
                <span class="row-name" title="${p.modelo}">${p.modelo}</span>
                <div class="progress-container">
                    <div class="progress-bar" style="width: ${percent}%"></div>
                </div>
                <span class="row-value">${p.contador}</span>
            `;
            container.appendChild(row);
        });
    }

    renderCityStats(equips, sectors) {
        const container = document.getElementById('city-list');
        container.innerHTML = '';

        const cityStats = {};

        equips.forEach(eq => {
            const setorObj = sectors.find(s => s.nome === eq.setor);
            const cityName = setorObj ? setorObj.nome_cidade : 'Indefinido';
            if (!cityStats[cityName]) cityStats[cityName] = { pcs: 0, printers: 0 };
            if (eq.tipo === 'computador') cityStats[cityName].pcs++;
            else cityStats[cityName].printers++;
        });

        Object.entries(cityStats).forEach(([city, stats]) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td style="font-weight:500;">${city}</td>
                <td class="text-center">${stats.pcs}</td>
                <td class="text-center">${stats.printers}</td>
            `;
            container.appendChild(tr);
        });
    }

    renderErrorList(errors) {
        const container = document.getElementById('error-list');
        container.innerHTML = '';

        const recentErrors = errors.slice(0, 5);

        if (recentErrors.length === 0) {
            container.innerHTML = '<div style="color:#999; text-align:center; padding:10px;">Nenhum erro ativo!</div>';
            return;
        }

        recentErrors.forEach(err => {
            // --- CORREÇÃO DAS CORES ---
            // 'status-red' (Crítico), 'status-yellow' (Alerta), 'status-info' (Outros)
            let statusClass = 'status-info'; // Azul padrão
            if (err.severidade === 'Crítico') statusClass = 'status-red';
            if (err.severidade === 'Alerta') statusClass = 'status-yellow';

            const icon = err.severidade === 'Crítico' ? 'fa-times-circle' : 'fa-exclamation-triangle';

            const item = DOMUtils.create('div', {
                className: `error-item ${statusClass}`, // Aplica a classe correta
                onclick: () => NavigationService.navigate(ROUTES.MONITORING)
            });

            item.innerHTML = `
                <div class="error-icon-circle">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="error-text">
                    <h4>${err.titulo}</h4>
                    <p>${err.equipamentoNome} (${err.descricao})</p>
                </div>
            `;
            container.appendChild(item);
        });
    }
}

new DashboardPage().init();
==================================================
CAMINHO: .\js\pages\equipamento.js
==================================================
/* js/pages/equipamento.js */
import { BaseListPage } from '../core/BaseListPage.js';
import { EquipamentoService } from '../services/equipamento.service.js';
import { TABLE_COLUMNS, TAB_IDS } from '../config/equipamento.config.js';
import { renderGenericTable } from '../components/tables.js';
import { switchTab, resetTabs } from '../components/tabs.js';
import { ROUTES } from '../services/navigation.service.js';
import { DOMUtils } from '../utils.js';

class EquipamentoPage extends BaseListPage {
    constructor() {
        super({
            listElementId: 'equipment-list',
            emptyStateId: 'empty-state',
            service: EquipamentoService,
            tableConfig: TABLE_COLUMNS.main,
            pageName: 'equipment',
            addPageUrl: ROUTES.EQUIPMENT_FORM,
            deleteMessageFn: (item) => `Deseja excluir o ${item.tipo} <strong>${item.modelo}</strong>?`,
            itemNameFn: (item) => item.modelo
        },
        {
            canAdd: true,
            canSelect: true,
            showSidebarTree: true
        });

        this.tabContent = document.getElementById('tab-content-area');
        this.splitContainer = document.querySelector('.split-container');
        this.tabs = [
            document.getElementById(TAB_IDS.impressoras),
            document.getElementById(TAB_IDS.erros),
            document.getElementById(TAB_IDS.opcoes)
        ];
        this.activeTab = 'impressoras';
    }

    async init() {
        await super.init();
        
        window.handleTabClick = (tabName) => {
            this.activeTab = tabName;
            switchTab(tabName, this.tabs, () => this.renderTabContent());
        };
        
        this.setupMobileBack();
        this.setupClickOutside();

        // --- CÓDIGO NOVO: AUTO-SELEÇÃO VIA URL ---
        const urlParams = new URLSearchParams(window.location.search);
        const selectId = urlParams.get('select');
        
        if (selectId) {
            // Pequeno delay para garantir que o DOM da tabela foi renderizado
            setTimeout(() => {
                this.selectItemById(selectId);
                
                // Opcional: Rolar até o item (scroll)
                const row = document.querySelector(`.user-row[data-id="${selectId}"]`);
                if (row) row.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 300);
        }
    }

    setupClickOutside() {
        const topSection = document.querySelector('.top-list-section');
        if (topSection) {
            topSection.addEventListener('click', (e) => {
                if (window.innerWidth <= 900 && this.state.selectedItem) {
                    e.stopPropagation();
                    e.preventDefault();
                    this.handleResetSelection();
                }
            }, true);
        }
    }

    setupMobileBack() {
        const tabsHeader = document.querySelector('.tabs-header');
        if (tabsHeader && !document.querySelector('.mobile-back-btn')) {
            const backBtn = DOMUtils.create('button', {
                className: 'mobile-back-btn',
                title: 'Fechar detalhes',
                onclick: (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.handleResetSelection();
                }
            }, '<i class="fas fa-chevron-down"></i>');
            tabsHeader.insertBefore(backBtn, tabsHeader.firstChild);
        }
    }

    handleItemSelect(rowElement, item) {
        super.handleItemSelect(rowElement, item);

        if (this.state.selectedItem) {
            // CORREÇÃO AQUI:
            // Apenas atualizamos o estado das abas.
            // O updateTabsState vai chamar handleTabClick, que por sua vez chama renderTabContent.
            // Removemos a chamada direta duplicada a renderTabContent() que existia aqui.
            this.updateTabsState(item);
            
            if(this.splitContainer) this.splitContainer.classList.add('show-detail');
        } else {
            this.resetBottomPanel();
            if(this.splitContainer) this.splitContainer.classList.remove('show-detail');
        }
    }

    handleResetSelection() {
        super.handleResetSelection();
        this.resetBottomPanel();
        if(this.splitContainer) this.splitContainer.classList.remove('show-detail');
    }

    updateTabsState(item) {
        this.tabs.forEach(b => b.disabled = false);
        if (item.tipo === 'computador') {
            const tabOpcoes = document.getElementById(TAB_IDS.opcoes);
            if(tabOpcoes) tabOpcoes.disabled = true;
            // Isso aqui dispara o renderTabContent indiretamente
            window.handleTabClick('impressoras');
        } else {
            const tabImpressoras = document.getElementById(TAB_IDS.impressoras);
            if(tabImpressoras) tabImpressoras.disabled = true;
            // Isso aqui dispara o renderTabContent indiretamente
            window.handleTabClick('opcoes');
        }
    }

    resetBottomPanel() {
        if(this.tabContent) {
            this.tabContent.innerHTML = '';
            const msg = DOMUtils.create('div', { 
                style: { color:'#888', textAlign:'center', height:'100%', display:'flex', alignItems:'center', justifyContent:'center' } 
            }, 'Selecione um item.');
            this.tabContent.appendChild(msg);
        }
        resetTabs(this.tabs);
        if(this.tabs[0]) this.tabs[0].classList.add('active');
    }

    renderTabContent() {
        this.tabContent.innerHTML = '';
        this.tabContent.classList.remove('centered', 'padded');
        const item = this.state.selectedItem;
        if (!item) return;

        if (this.activeTab === 'impressoras') this.renderPrintersTab(item);
        else if (this.activeTab === 'erros') this.renderErrorsTab(item);
        else if (this.activeTab === 'opcoes') this.renderOptionsTab();
    }

    // Adicionado async/await corretamente conforme discutido anteriormente
    async renderPrintersTab(item) {
        const printers = await this.service.getPrintersByParentId(item.id);
        
        // Verifica se a aba mudou ou o item mudou enquanto esperávamos a resposta
        // Isso evita bugs se o usuário clicar muito rápido em outro lugar
        if (this.state.selectedItem?.id !== item.id || this.activeTab !== 'impressoras') return;

        if (printers.length > 0) {
            const headerRow = DOMUtils.create('div', { className: 'inner-table-header' }, [
                DOMUtils.create('div', { className: 'th-col w-xs' }, '#'),
                DOMUtils.create('div', { className: 'th-col w-md' }, 'Nº Serie'),
                DOMUtils.create('div', { className: 'th-col w-flex' }, 'Modelo'),
                DOMUtils.create('div', { className: 'th-col w-flex' }, 'Usuário'),
                DOMUtils.create('div', { className: 'th-col w-sm' }, 'Status'),
                DOMUtils.create('div', { className: 'th-col w-sm' }, 'Setor'),
                DOMUtils.create('div', { className: 'th-col w-sm' }, 'Contador'),
                DOMUtils.create('div', { className: 'th-col w-sm' }, 'Ton.'),
                DOMUtils.create('div', { className: 'th-col w-flex' }, 'Error'),
            ]);
            const listContainer = DOMUtils.create('div', { className: 'inner-table-content', id: 'inner-list' });
            const wrapper = DOMUtils.create('div', { className: 'inner-table-container animate-fade' }, [headerRow, listContainer]);
            
            // Limpa de novo por segurança antes de adicionar
            this.tabContent.innerHTML = '';
            this.tabContent.appendChild(wrapper);
            
            renderGenericTable(listContainer, printers, TABLE_COLUMNS.inner, (row, printerItem) => this.selectItemById(printerItem.id));
        } else {
            this.tabContent.classList.add('centered', 'padded');
            this.tabContent.innerHTML = ''; // Limpa antes de adicionar mensagem
            this.tabContent.appendChild(DOMUtils.create('div', { style: { textAlign:'center', color:'#999' } }, [
                DOMUtils.create('i', { className: 'fas fa-print', style: { fontSize:'24px', display:'block', marginBottom:'10px', opacity:'0.5' } }),
                'Nenhuma impressora associada.'
            ]));
        }
    }

    async renderErrorsTab(item) {
        this.tabContent.innerHTML = ''; // Limpa
        this.tabContent.classList.remove('centered', 'padded'); // Remove centralização para permitir lista
        
        // Busca histórico real
        const history = await this.service.getErrorHistory(item.id);

        if (history && history.length > 0) {
            const list = DOMUtils.create('div', { className: 'error-history-list', style: { padding: '20px' } });

            history.forEach(log => {
                // Define cor baseada na severidade
                const color = log.severidade === 'Crítico' ? '#d32f2f' : '#fbc02d';
                const bg = log.severidade === 'Crítico' ? '#ffebee' : '#fffde7';
                const icon = log.severidade === 'Crítico' ? 'fa-times-circle' : 'fa-exclamation-triangle';

                const card = DOMUtils.create('div', { 
                    className: 'error-card animate-fade',
                    style: { 
                        borderLeft: `4px solid ${color}`,
                        background: bg,
                        padding: '12px',
                        marginBottom: '10px',
                        borderRadius: '4px',
                        boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
                    }
                });

                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <strong style="color:${color}; font-size:14px;">
                            <i class="fas ${icon}"></i> ${log.titulo}
                        </strong>
                        <span style="font-size:11px; color:#666;">${new Date(log.data_hora).toLocaleString('pt-BR')}</span>
                    </div>
                    <div style="font-size:13px; color:#444; margin-bottom:5px;">${log.descricao}</div>
                    <div style="display:flex; gap:10px; font-size:11px; color:#777;">
                        <span>Cód: <strong>${log.codigo_erro}</strong></span>
                        <span>Status: <strong>${log.resolvido ? 'Resolvido' : 'Ativo'}</strong></span>
                    </div>
                `;
                list.appendChild(card);
            });
            this.tabContent.appendChild(list);
        } else {
            // Estado Vazio (Sem erros)
            this.tabContent.classList.add('centered', 'padded');
            this.tabContent.appendChild(DOMUtils.create('div', { className: 'animate-fade', style: { textAlign: 'center' } }, [
                DOMUtils.create('i', { className: 'fas fa-check-circle', style: { fontSize: '40px', color: 'var(--status-success)', marginBottom: '15px' } }),
                DOMUtils.create('div', { style: { color: 'var(--status-success)', fontSize: '16px', fontWeight: 'bold' } }, 'Sistema Saudável'),
                DOMUtils.create('div', { style: { color: '#888', fontSize: '13px', marginTop: '5px' } }, 'Nenhum registro de falha encontrado.')
            ]));
        }
    }

    renderOptionsTab() {
        this.tabContent.classList.add('centered', 'padded');
        const btnTinta = DOMUtils.create('button', { className: 'option-btn' }, '<i class="fas fa-tint"></i> Redefinir Tinta');
        const btnJatos = DOMUtils.create('button', { className: 'option-btn' }, '<i class="fas fa-list-ul"></i> Verificar Jatos');
        const btnReset = DOMUtils.create('button', { className: 'option-btn' }, '<i class="fas fa-eraser"></i> Reset Almofada');
        this.tabContent.appendChild(DOMUtils.create('div', { className: 'options-stack animate-fade' }, [btnTinta, btnJatos, btnReset]));
    }

    selectItemById(id) {
        const targetItem = this.state.data.find(e => e.id === id);
        if (targetItem) {
            const rowElement = this.elements.list.querySelector(`.user-row[data-id="${id}"]`);
            if (rowElement) this.handleItemSelect(rowElement, targetItem);
        }
    }
}

new EquipamentoPage().init();
==================================================
CAMINHO: .\js\pages\log.js
==================================================
/* js/pages/log.js */
import { BaseListPage } from '../core/BaseListPage.js';
import { LogService } from '../services/log.service.js';
import { LOG_TABLE_CONFIG } from '../config/log.config.js';

class LogPage extends BaseListPage {
    constructor() {
        super(
            {
                listElementId: 'log-list',
                emptyStateId: 'empty-state',
                service: LogService,
                tableConfig: LOG_TABLE_CONFIG,
                pageName: 'logs',
                addPageUrl: null, 
                deleteMessageFn: null 
            },
            // OPÇÕES DECLARATIVAS (Isso conserta a sidebar)
            {
                canAdd: false,          // Esconde botão Add
                canSelect: false,       // Desativa seleção
                showSidebarTree: false  // Limpa a Sidebar corretamente
            }
        );
    }

    async init() {
        await super.init();

        // Garante layout full width via CSS
        document.body.classList.add('layout-full-width');

        // Garante botão de pesquisa
        const actionsContainer = document.getElementById('header-actions');
        if (actionsContainer && !document.getElementById('btn-search-trigger')) {
            actionsContainer.innerHTML = `
                <button id="btn-search-trigger" class="btn-action" title="Pesquisar"><i class="fas fa-search"></i></button>
            `;
            document.getElementById('btn-search-trigger').onclick = () => this.header.toggleSearchMode(true);
        }
    }

    async loadData() {
        try {
            // Usa o método específico de logs
            this.state.data = await this.service.getRecent();
            this.renderTable(this.state.data);
        } catch (error) {
            console.error('Erro logs:', error);
        }
    }
}

new LogPage().init();
==================================================
CAMINHO: .\js\pages\login.js
==================================================
import { InputManager, Validators, setupInputMasks } from '../components/inputs.js';
import { AuthService } from '../services/auth.service.js';
import { showToast } from '../components/toast.js';
import { ROUTES, NavigationService } from '../services/navigation.service.js';

// Inicializa máscaras (CPF)
setupInputMasks();

document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('loginForm');
    const cpfInput = document.getElementById('cpf');
    const passInput = document.getElementById('password');
    const toggleBtn = document.getElementById('togglePassword');
    const btnSubmit = form.querySelector('button[type="submit"]');

    // 1. Toggle de Senha (Olhinho)
    if (toggleBtn) {
        toggleBtn.onclick = () => {
            const isPass = passInput.type === 'password';
            passInput.type = isPass ? 'text' : 'password';
            toggleBtn.className = isPass ? 'fas fa-eye-slash icone-do-olho' : 'fas fa-eye icone-do-olho';
        };
    }

    // 2. Limpeza automática de erros (via InputManager)
    form.addEventListener('input', (e) => InputManager.clearError(e.target));

    // 3. Submit Limpo
    form.onsubmit = async (e) => {
        e.preventDefault();
        
        // Limpa erros anteriores
        InputManager.clearAllErrors(form);
        let isValid = true;

        // Validação CPF
        if (!Validators.required(cpfInput.value)) {
            InputManager.setError(cpfInput, 'Digite seu CPF.');
            isValid = false;
        } else if (!Validators.cpf(cpfInput.value)) {
            InputManager.setError(cpfInput, 'CPF inválido.');
            isValid = false;
        }

        // Validação Senha
        if (!Validators.required(passInput.value)) {
            InputManager.setError(passInput, 'Digite sua senha.');
            isValid = false;
        }

        if (!isValid) return;

        // Feedback Visual
        const originalText = btnSubmit.innerText;
        btnSubmit.disabled = true;
        btnSubmit.innerText = 'Entrando...';

        try {
            await AuthService.login(cpfInput.value, passInput.value);
            showToast('Login realizado!', 'success');
            
            // Pequeno delay para o usuário ler o toast
            setTimeout(() => NavigationService.navigate(ROUTES.HOME), 500);
            
        } catch (error) {
            showToast(error.message || 'Falha ao entrar.', 'error');
            btnSubmit.disabled = false;
            btnSubmit.innerText = originalText;
        }
    };
});
==================================================
CAMINHO: .\js\pages\monitoramento.js
==================================================
/* js/pages/monitoramento.js */
import { BaseListPage } from '../core/BaseListPage.js';
import { ErrorLogService } from '../services/error_log.service.js';
import { MONITOR_TABLE_CONFIG } from '../config/monitoramento.config.js';
import { NavigationService, ROUTES } from '../services/navigation.service.js';
import { showConfirmModal } from '../components/modal.js';
import { showToast } from '../components/toast.js';

class MonitoramentoPage extends BaseListPage {
    constructor() {
        super(
            {
                listElementId: 'monitor-list',
                emptyStateId: 'empty-state',
                service: ErrorLogService, 
                tableConfig: MONITOR_TABLE_CONFIG,
                pageName: 'monitoramento',
                addPageUrl: null, 
                deleteMessageFn: null
            },
            { canAdd: false, canSelect: true, showSidebarTree: false }
        );
    }

    async init() {
        document.body.classList.add('layout-full-width');
        await super.init(); // Renderiza Header e Sidebar

        // --- EXPOR FUNÇÕES GLOBAIS ---
        window.gerarOS = (id, e) => this.handleGerarOS(id, e);
        window.resolverErro = (id, e) => this.handleResolver(id, e);
        window.verOS = (osId, e) => this.handleVerOS(osId, e);
    }

    // Sobrescrita do loadData para usar o método específico getActiveErrors
    async loadData() {
        this.state.data = await this.service.getActiveErrors();
        this.renderTable(this.state.data);
    }

    // --- AÇÕES ---

    handleGerarOS(errorId, event) {
        if(event) event.stopPropagation();
        // Navega para cadastro de OS enviando o ID do erro na URL
        NavigationService.navigate(ROUTES.OS_FORM, { fromError: errorId });
    }

    handleVerOS(osId, event) {
        if(event) event.stopPropagation();
        // Vai para a lista de OS e seleciona a OS específica
        NavigationService.navigate(ROUTES.OS_LIST, { select: osId });
    }

    handleResolver(errorId, event) {
        if(event) event.stopPropagation();

        showConfirmModal(
            'Resolver Erro',
            'Confirma que este problema foi resolvido sem necessidade de abrir um chamado?',
            async () => {
                try {
                    // --- CORREÇÃO: Usa o Service, não o LocalStorage direto ---
                    const success = await this.service.resolveError(errorId);
                    
                    if (success || success === undefined) { // undefined se a API retornar void
                        showToast('Erro marcado como resolvido!', 'success');
                        this.loadData(); // Recarrega a tabela
                    } else {
                        showToast('Não foi possível resolver o erro.', 'error');
                    }
                } catch (error) {
                    console.error(error);
                    showToast('Erro ao processar solicitação.', 'error');
                }
            }
        );
    }

    // Clique na linha (apenas navega se não clicou nos botões)
    handleItemSelect(rowElement, item) {
        if (item.id_equipamento_alvo) {
            NavigationService.navigate(ROUTES.EQUIPMENT_LIST, { select: item.id_equipamento_alvo });
        }
    }
}

new MonitoramentoPage().init();
==================================================
CAMINHO: .\js\pages\os.js
==================================================
/* js/pages/os.js */
import { BaseListPage } from '../core/BaseListPage.js';
import { OsService } from '../services/os.service.js';
import { SetorService } from '../services/setor.service.js';
import { OS_TABLE_CONFIG } from '../config/os.config.js';
import { ROUTES } from '../services/navigation.service.js';
import { DOMUtils } from '../utils.js';
import { showToast } from '../components/toast.js';
// 1. NOVO IMPORT
import { AuthService } from '../services/auth.service.js';

class OsPage extends BaseListPage {
    constructor() {
        super(
            {
                listElementId: 'os-list',
                emptyStateId: 'empty-state',
                service: OsService,
                tableConfig: OS_TABLE_CONFIG,
                pageName: 'os',
                addPageUrl: ROUTES.OS_FORM,
                deleteMessageFn: (item) => `Excluir O.S. <strong>#${item.id}</strong>?`
            },
            {
                canAdd: true,
                canSelect: true,
                showSidebarTree: false 
            }
        );
        this.detailContainer = document.getElementById('os-detail-content');
        this.splitContainer = document.querySelector('.split-container');
        this.setoresCache = []; 
        
        // 2. PEGAR USUÁRIO LOGADO
        this.currentUser = AuthService.getUser();
    }

    async init() {
        await super.init();
        document.body.classList.add('layout-full-width');
        
        this.loadSectors();

        if (this.splitContainer) {
            const backdrop = DOMUtils.create('div', {
                className: 'os-mobile-backdrop',
                onclick: (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.handleResetSelection(); 
                }
            });
            this.splitContainer.appendChild(backdrop);
        }
    }

    // --- 3. SOBRESCREVENDO AÇÕES PARA ADICIONAR SEGURANÇA ---

    handleEdit(item) {
        // Verifica se tem permissão antes de deixar editar
        if (this.checkOSPermission(item, 'editar')) {
            super.handleEdit(item);
        }
    }

    handleDelete(item) {
        // Verifica se tem permissão antes de deixar excluir
        if (this.checkOSPermission(item, 'excluir')) {
            super.handleDelete(item);
        }
    }

    // --- 4. LÓGICA DE PERMISSÃO ---
    checkOSPermission(osItem, action) {
        if (!this.currentUser) {
            this.currentUser = AuthService.getUser(); // Tenta recarregar
            if (!this.currentUser) return false;
        }

        const myRole = (this.currentUser.tipo || '').toLowerCase();
        const myName = this.currentUser.nome;

        // A. ADMIN e TÉCNICO: Podem tudo
        if (myRole.includes('admin') || myRole.includes('técnico') || myRole.includes('tecnico')) {
            return true;
        }

        // B. USUÁRIO COMUM: Só pode se for o dono da O.S.
        if (osItem.solicitante === myName) {
            return true;
        }

        // C. NEGADO
        showToast(`Acesso Negado: Você só pode ${action} suas próprias Ordens de Serviço.`, 'error');
        return false;
    }

    // --- MÉTODOS ORIGINAIS DO SEU ARQUIVO (MANTIDOS IGUAIS) ---

    async loadSectors() {
        this.setoresCache = await SetorService.getAll();
    }

    getFormattedSector(sectorName) {
        if (!sectorName) return '-';
        const sector = this.setoresCache.find(s => s.nome === sectorName);
        if (sector) {
            return `<strong>${sector.nome}</strong> <br> <small style="color:#666;">${sector.empresa} - ${sector.cidade}</small>`;
        }
        return sectorName;
    }

    handleItemSelect(rowElement, item) {
        super.handleItemSelect(rowElement, item);
        if (this.state.selectedItem) {
            this.header.updateButtons('osSelected');
            setTimeout(() => this.bindStatusButton(item), 0);
            this.renderDetails(item);
            if(this.splitContainer) this.splitContainer.classList.add('show-detail');
        } else {
            this.handleResetSelection();
        }
    }

    handleResetSelection() {
        super.handleResetSelection();
        this.resetDetails();
        if(this.splitContainer) {
            this.splitContainer.classList.remove('show-detail');
        }
    }

    bindStatusButton(item) {
        const btn = document.getElementById('btn-status');
        if (!btn) return;

        const isClosed = item.status === 'Fechado';
        
        btn.title = isClosed ? 'Reabrir O.S.' : 'Concluir O.S.';
        btn.innerHTML = isClosed ? '<i class="fas fa-box-open"></i>' : '<i class="fas fa-check"></i>';
        btn.style.color = isClosed ? 'var(--brand-active)' : 'var(--status-success)';
        
        btn.onclick = async () => {
            // Verifica permissão também para mudar status (opcional, mas recomendado)
            if (!this.checkOSPermission(item, 'alterar status')) return;

            await this.service.toggleStatus(item.id);
            showToast(isClosed ? 'O.S. Reaberta!' : 'O.S. Concluída!', 'success');
            
            this.state.data = await this.service.getAll();
            const newItem = this.state.data.find(i => i.id === item.id);
            this.renderTable(this.state.data);
            
            if(newItem) {
                this.state.selectedItem = newItem;
                this.renderDetails(newItem);
                const newRow = this.elements.list.querySelector(`.user-row[data-id="${newItem.id}"]`);
                if(newRow) newRow.classList.add('selected');
                this.bindStatusButton(newItem);
            }
        };
        
        this.bindContextButtons(item);
    }

    renderDetails(item) {
        this.detailContainer.innerHTML = '';
        this.detailContainer.classList.remove('centered', 'padded');
        const statusColor = item.status === 'Aberto' ? 'var(--status-error)' : 'var(--status-success)';
        
        const sectorDisplay = this.getFormattedSector(item.setor);

        const content = `
            <div class="detail-grid animate-fade">
                <div class="detail-full" style="margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; display:flex; justify-content:space-between; align-items:center;">
                    <div style="font-size: 18px; font-weight: bold; color: var(--brand-primary);">
                        O.S. #${item.id}
                    </div>
                    <span class="status-badge" style="background-color: ${statusColor}">${item.status}</span>
                </div>

                <div class="detail-item">
                    <label>Equipamento</label>
                    <div>${item.equipamentoName}</div>
                </div>
                <div class="detail-item">
                    <label>Sala / Localização</label>
                    <div style="font-weight: 500; color: #333;">${item.equipamentoSala}</div>
                </div>
                
                <div class="detail-item detail-full">
                    <label>Setor (Empresa - Cidade)</label>
                    <div>${sectorDisplay}</div>
                </div>
                
                <div class="detail-item">
                    <label>Solicitante</label>
                    <div style="font-weight:bold;">${item.solicitante}</div>
                </div>
                <div class="detail-item">
                    <label>Técnico Responsável</label>
                    <div>${item.responsavel}</div>
                </div>

                <div class="detail-item detail-full">
                    <label>Descrição do Defeito</label>
                    <div style="min-height: 40px;">${item.descricao}</div>
                </div>
                
                <div class="detail-item">
                    <label>Data Abertura</label>
                    <div>${new Date(item.dataAbertura).toLocaleString('pt-BR')}</div>
                </div>
                
                ${item.dataFechamento ? `
                <div class="detail-item detail-full">
                    <label>Solução / Fechamento</label>
                    <div style="border-color: var(--status-success); color: var(--status-success); background-color: #f0fff4;">
                        ${item.solucao}<br>
                        <small style="color:#666; margin-top:5px; display:block;">
                            <i class="fas fa-check"></i> Em: ${new Date(item.dataFechamento).toLocaleString('pt-BR')}
                        </small>
                    </div>
                </div>
                ` : ''}
                
                <div style="height: 50px; width: 100%;"></div>
            </div>
        `;
        this.detailContainer.innerHTML = content;
    }

    resetDetails() {
        this.detailContainer.innerHTML = '<div style="color:#888;">Selecione uma O.S. para ver os detalhes.</div>';
        this.detailContainer.classList.add('centered', 'padded');
    }
}

new OsPage().init();
==================================================
CAMINHO: .\js\pages\sector_form.js
==================================================
/* js/pages/sector_form.js */
import { HeaderComponent } from '../components/header.js';
import { SidebarComponent } from '../components/sidebar.js';
import { SetorService } from '../services/setor.service.js';
import { showToast } from '../components/toast.js';
import { NavigationService, ROUTES } from '../services/navigation.service.js';

class SectorFormPage {
    constructor() {
        this.formSector = document.getElementById('sector-form');
        this.formCityModal = document.getElementById('form-city-modal');
        this.formCompanyModal = document.getElementById('form-company-modal');
        
        this.elements = {
            citySelect: document.getElementById('city-select'),
            btnOpenCity: document.getElementById('btn-open-city-modal'),
            
            companySelect: document.getElementById('company-select'),
            btnOpenCompany: document.getElementById('btn-open-company-modal'),
            
            // Modal Cidade
            modalCityName: document.getElementById('modal-city-name'),
            modalCityUf: document.getElementById('modal-city-uf'),
            
            // Modal Empresa
            modalCompanyCityReadonly: document.getElementById('modal-company-city-readonly'),
            modalCompanyName: document.getElementById('modal-company-name'),
            modalCompanyCnpj: document.getElementById('modal-company-cnpj'),
            modalCompanyDesc: document.getElementById('modal-company-desc'),
            modalCompanyObs: document.getElementById('modal-company-obs'),

            // Setor
            sectorInput: document.getElementById('nome'),
            sectorAddress: document.getElementById('localizacao'),
            sectorObs: document.getElementById('observacao')
        };
    }

    async init() {
        new HeaderComponent('app-header').render(null, 'sector-form');
        new SidebarComponent('app-sidebar').render(await SetorService.getTreeStructure());

        await this.loadCities();
        this.bindEvents();
    }

    async loadCities() {
        const cities = await SetorService.getUniqueCities();
        this.populateSelect(this.elements.citySelect, cities, 'Selecione uma cidade...');
    }

    async loadCompanies(cityName) {
        if (!cityName) {
            this.populateSelect(this.elements.companySelect, [], 'Selecione a cidade primeiro...');
            this.toggleCompanyDisable(true);
            return;
        }

        const companies = await SetorService.getCompaniesByCity(cityName);
        
        if (companies.length > 0) {
            this.populateSelect(this.elements.companySelect, companies, 'Selecione uma empresa...');
            this.toggleCompanyDisable(false);
        } else {
            this.populateSelect(this.elements.companySelect, [], 'Nenhuma empresa cadastrada');
            // Mantemos habilitado para permitir adicionar nova empresa
            this.toggleCompanyDisable(false);
        }
    }

    populateSelect(selectElement, items, defaultText) {
        const currentValue = selectElement.value;
        selectElement.innerHTML = `<option value="">${defaultText}</option>`;
        items.forEach(item => {
            const option = document.createElement('option');
            option.value = item;
            option.textContent = item;
            selectElement.appendChild(option);
        });
        if (items.includes(currentValue)) {
            selectElement.value = currentValue;
        }
    }

    toggleCompanyDisable(disable) {
        this.elements.companySelect.disabled = disable;
        this.elements.btnOpenCompany.disabled = disable;
        if(disable) this.elements.btnOpenCompany.classList.add('disabled');
        else this.elements.btnOpenCompany.classList.remove('disabled');
    }

    toggleModal(modalId, show) {
        const modal = document.getElementById(modalId);
        if (show) modal.classList.add('active');
        else modal.classList.remove('active');
    }

    bindEvents() {
        this.elements.citySelect.addEventListener('change', (e) => {
            this.loadCompanies(e.target.value);
        });

        this.elements.btnOpenCity.addEventListener('click', () => {
            this.formCityModal.reset();
            this.toggleModal('modal-city', true);
        });

        this.elements.btnOpenCompany.addEventListener('click', () => {
            this.formCompanyModal.reset();
            this.elements.modalCompanyCityReadonly.value = this.elements.citySelect.value;
            this.toggleModal('modal-company', true);
        });

        document.querySelectorAll('[data-close]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modalId = e.target.getAttribute('data-close');
                this.toggleModal(modalId, false);
            });
        });

        // --- SUBMITS COM PERSISTÊNCIA REAL ---

        // A. SALVAR CIDADE
        this.formCityModal.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = this.elements.modalCityName.value.trim();
            const uf = this.elements.modalCityUf.value.trim().toUpperCase();

            if (uf.length !== 2) return showToast('UF inválida', 'error');

            try {
                // PERSISTÊNCIA: Salva no MockDatabase via Service
                await SetorService.addCity({ 
                    nome: name, 
                    uf: uf 
                });
                
                showToast(`Cidade ${name} cadastrada!`, 'success');
                this.toggleModal('modal-city', false);
                
                await this.loadCities();
                this.elements.citySelect.value = name;
                // Dispara change para preparar o campo de empresa
                this.elements.citySelect.dispatchEvent(new Event('change'));

            } catch (error) {
                console.error(error);
                showToast('Erro ao salvar cidade', 'error');
            }
        });

        // B. SALVAR EMPRESA
        this.formCompanyModal.addEventListener('submit', async (e) => {
            e.preventDefault();
            const cityName = this.elements.citySelect.value;
            
            const companyData = {
                nome: this.elements.modalCompanyName.value.trim(),
                cnpj: this.elements.modalCompanyCnpj.value.trim(),
                descricao: this.elements.modalCompanyDesc.value.trim(),
                observacao: this.elements.modalCompanyObs.value.trim(),
                cidade_vinculada: cityName // Importante para o filtro
            };

            try {
                // PERSISTÊNCIA
                await SetorService.addCompany(companyData);

                showToast(`Empresa ${companyData.nome} salva!`, 'success');
                this.toggleModal('modal-company', false);

                await this.loadCompanies(cityName);
                this.elements.companySelect.value = companyData.nome;

            } catch (error) {
                console.error(error);
                showToast('Erro ao salvar empresa', 'error');
            }
        });

        // C. SALVAR SETOR
        this.formSector.addEventListener('submit', async (e) => {
            e.preventDefault();

            const cidade = this.elements.citySelect.value;
            const empresa = this.elements.companySelect.value;
            const setorNome = this.elements.sectorInput.value.trim();

            if (!cidade || !empresa || !setorNome) {
                return showToast('Preencha os campos obrigatórios', 'error');
            }

            try {
                const newSector = {
                    nome: setorNome,
                    localizacao: this.elements.sectorAddress.value.trim(),
                    observacao: this.elements.sectorObs.value.trim(),
                    cidade: cidade,
                    empresa: empresa
                };

                await SetorService.add(newSector);
                showToast('Setor cadastrado com sucesso!', 'success');
                setTimeout(() => NavigationService.navigate(ROUTES.SECTORS_LIST), 1000);
            } catch (error) {
                console.error(error);
                showToast('Erro ao salvar setor.', 'error');
            }
        });
    }
}

new SectorFormPage().init();
==================================================
CAMINHO: .\js\pages\setores.js
==================================================
/* js/pages/setores.js */
import { BaseListPage } from '../core/BaseListPage.js';
import { SetorService } from '../services/setor.service.js';
import { SECTORS_TABLE_CONFIG } from '../config/setores.config.js';
import { ROUTES } from '../services/navigation.service.js';
import { showToast } from '../components/toast.js';
import { showConfirmModal } from '../components/modal.js';

class SetoresPage extends BaseListPage {
    constructor() {
        super({
            listElementId: 'sectors-list',
            emptyStateId: 'empty-state',
            service: SetorService,
            tableConfig: { ...SECTORS_TABLE_CONFIG, rowClass: 'user-row sectors-grid' },
            pageName: 'sectors',
            addPageUrl: ROUTES.SECTORS_FORM,
            deleteMessageFn: (item) => `Excluir o setor <strong>${item.nome}</strong>?`
        });

        this.modals = {
            cities: document.getElementById('modal-manage-cities'),
            companies: document.getElementById('modal-manage-companies'),
            listCities: document.getElementById('list-cities-container'),
            listCompanies: document.getElementById('list-companies-container'),
            
            // Cidade
            formCity: document.getElementById('edit-city-form'),
            inpCityId: document.getElementById('edit-city-id'),
            inpCityName: document.getElementById('edit-city-name'),
            inpCityUf: document.getElementById('edit-city-uf'),
            btnSaveCity: document.getElementById('btn-save-city-edit'),
            btnCancelCity: document.getElementById('btn-cancel-city-edit'), // Novo ID se quiser adicionar cancelar na cidade tbm

            // Empresa
            formCompany: document.getElementById('edit-company-form'),
            inpCompId: document.getElementById('edit-company-id'),
            inpCompName: document.getElementById('edit-company-name'),
            inpCompCnpj: document.getElementById('edit-company-cnpj'),
            // Novos Inputs mapeados:
            inpCompDesc: document.getElementById('edit-company-desc'),
            inpCompObs: document.getElementById('edit-company-obs'),
            
            btnSaveCompany: document.getElementById('btn-save-company-edit'),
            btnCancelCompany: document.getElementById('btn-cancel-company-edit')
        };
    }

    async init() {
        await super.init();
        setTimeout(() => this.bindManagerEvents(), 100);
    }

    bindManagerEvents() {
        const btnCities = document.getElementById('sidebar-btn-cities');
        const btnCompanies = document.getElementById('sidebar-btn-companies');

        if (btnCities) btnCities.onclick = () => this.openCityManager();
        if (btnCompanies) btnCompanies.onclick = () => this.openCompanyManager();

        // Fechar modais principais
        document.querySelectorAll('.modal-close').forEach(btn => {
            btn.onclick = (e) => {
                const modalId = e.target.getAttribute('data-close');
                document.getElementById(modalId).classList.remove('active');
            };
        });

        // --- SALVAR EDIÇÃO CIDADE ---
        if(this.modals.btnSaveCity) {
            this.modals.btnSaveCity.onclick = async () => {
                const id = this.modals.inpCityId.value;
                const name = this.modals.inpCityName.value;
                const uf = this.modals.inpCityUf.value;
                if(!name || !uf) return showToast('Preencha os campos', 'error');

                await SetorService.updateCity(id, name, uf);
                showToast('Cidade atualizada!', 'success');
                this.modals.formCity.classList.add('hidden');
                this.openCityManager(); 
                this.handleResetSystem(); 
            };
        }

        // --- SALVAR EDIÇÃO EMPRESA (Atualizado) ---
        if(this.modals.btnSaveCompany) {
            this.modals.btnSaveCompany.onclick = async () => {
                const id = this.modals.inpCompId.value;
                
                // Objeto com todos os dados
                const dataToUpdate = {
                    nome: this.modals.inpCompName.value,
                    cnpj: this.modals.inpCompCnpj.value,
                    descricao: this.modals.inpCompDesc.value,
                    observacao: this.modals.inpCompObs.value
                };

                if(!dataToUpdate.nome || !dataToUpdate.cnpj) return showToast('Preencha Nome e CNPJ', 'error');

                await SetorService.updateCompany(id, dataToUpdate);
                
                showToast('Empresa atualizada!', 'success');
                this.modals.formCompany.classList.add('hidden');
                this.openCompanyManager(); 
                this.handleResetSystem();
            };
        }

        // Botão Cancelar Empresa
        if (this.modals.btnCancelCompany) {
            this.modals.btnCancelCompany.onclick = () => {
                this.modals.formCompany.classList.add('hidden');
            };
        }

        // --- ADICIONE ISTO: Botão Cancelar Cidade ---
        const btnCancelCity = document.getElementById('btn-cancel-city-edit');
        if (btnCancelCity) {
            btnCancelCity.onclick = () => {
                this.modals.formCity.classList.add('hidden');
            };
        }
    }

    async openCityManager() {
        this.modals.cities.classList.add('active');
        this.modals.listCities.innerHTML = 'Carregando...';
        
        try {
            const cities = await SetorService.getCitiesFull();
            this.modals.listCities.innerHTML = '';

            cities.forEach(city => {
                const item = document.createElement('div');
                item.className = 'modal-item';
                item.innerHTML = `
                    <div>
                        <strong>${city.nome}</strong>
                        <small>Estado: ${city.uf || '-'}</small>
                    </div>
                    <div class="modal-item-actions">
                        <button class="btn-icon-sm edit" type="button"><i class="fas fa-pen"></i></button>
                        <button class="btn-icon-sm delete" type="button"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                item.querySelector('.edit').onclick = () => {
                    this.modals.formCity.classList.remove('hidden');
                    this.modals.inpCityId.value = city.id;
                    this.modals.inpCityName.value = city.nome;
                    this.modals.inpCityUf.value = city.uf;
                };

                item.querySelector('.delete').onclick = () => {
                    showConfirmModal(
                        'Excluir Cidade', 
                        `Tem certeza que deseja apagar <strong>${city.nome}</strong>?<br><br><small style="color:red">Isso apagará TODAS as empresas e setores vinculados!</small>`, 
                        async () => {
                            await SetorService.deleteCity(city.id);
                            showToast('Cidade excluída!', 'success');
                            this.openCityManager();
                            this.handleResetSystem();
                        }
                    );
                };
                
                this.modals.listCities.appendChild(item);
            });
        } catch (error) { console.error(error); }
    }

    async openCompanyManager() {
        this.modals.companies.classList.add('active');
        this.modals.listCompanies.innerHTML = 'Carregando...';
        
        try {
            const companies = await SetorService.getCompaniesFull();
            this.modals.listCompanies.innerHTML = '';

            companies.forEach(comp => {
                const item = document.createElement('div');
                item.className = 'modal-item';
                item.innerHTML = `
                    <div>
                        <strong>${comp.nome}</strong>
                        <small>Vinculada a: ${comp.cidade_vinculada}</small>
                    </div>
                    <div class="modal-item-actions">
                        <button class="btn-icon-sm edit" type="button"><i class="fas fa-pen"></i></button>
                        <button class="btn-icon-sm delete" type="button"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                // --- AÇÃO DE CLICAR NO EDITAR ---
                item.querySelector('.edit').onclick = () => {
                    this.modals.formCompany.classList.remove('hidden');
                    // Preenche os campos existentes
                    this.modals.inpCompId.value = comp.id;
                    this.modals.inpCompName.value = comp.nome;
                    this.modals.inpCompCnpj.value = comp.cnpj;
                    
                    // Preenche os NOVOS campos (com fallback para string vazia se undefined)
                    this.modals.inpCompDesc.value = comp.descricao || '';
                    this.modals.inpCompObs.value = comp.observacao || '';
                    
                    // Foca no primeiro campo para UX
                    this.modals.inpCompName.focus();
                };

                item.querySelector('.delete').onclick = () => {
                    showConfirmModal(
                        'Excluir Empresa', 
                        `Tem certeza que deseja apagar <strong>${comp.nome}</strong>?<br><br><small style="color:red">Os setores vinculados serão apagados!</small>`, 
                        async () => {
                            await SetorService.deleteCompany(comp.id);
                            showToast('Empresa excluída!', 'success');
                            this.openCompanyManager();
                            this.handleResetSystem();
                        }
                    );
                };
                
                this.modals.listCompanies.appendChild(item);
            });
        } catch (error) { console.error(error); }
    }
}

new SetoresPage().init();
==================================================
CAMINHO: .\js\pages\user_panel.js
==================================================
/* js/pages/user_panel.js */
import { BaseListPage } from '../core/BaseListPage.js';
import { OsService } from '../services/os.service.js';
import { SetorService } from '../services/setor.service.js'; 
import { OS_TABLE_CONFIG } from '../config/os.config.js';
import { AuthService } from '../services/auth.service.js';
import { ROUTES } from '../services/navigation.service.js';

class UserPanelPage extends BaseListPage {
    constructor() {
        super(
            {
                listElementId: 'os-list',
                emptyStateId: 'empty-state',
                service: OsService,
                tableConfig: OS_TABLE_CONFIG,
                pageName: 'history', 
                addPageUrl: ROUTES.OS_FORM, 
                deleteMessageFn: null 
            },
            {
                canAdd: true, 
                canSelect: true,
                showSidebarTree: false 
            }
        );
        this.detailContainer = document.getElementById('os-detail-content');
        this.currentUser = AuthService.getUser();
        this.setoresCache = [];
    }

    async init() {
        await super.init();
        document.body.classList.add('layout-full-width');
        
        this.loadSectors();
        
        const splitContainer = document.querySelector('.split-container');
        if (splitContainer) {
            splitContainer.classList.add('history-view');
        }
        
        // --- CORREÇÃO: REMOVIDA A LIMPEZA FORÇADA DO HEADER ---
        // (O BaseListPage.js já cuida de colocar os botões certos, inclusive o +)
    }

    async loadSectors() {
        this.setoresCache = await SetorService.getAll();
    }

    getFormattedSector(sectorName) {
        if (!sectorName) return '-';
        const sector = this.setoresCache.find(s => s.nome === sectorName);
        if (sector) {
            return `<strong>${sector.nome}</strong> <br> <small style="color:#666;">${sector.empresa} - ${sector.cidade}</small>`;
        }
        return sectorName;
    }

    async loadData() {
        if (!this.currentUser) return;
        this.state.data = await this.service.getByUser(this.currentUser.nome);
        this.state.data.sort((a, b) => new Date(b.dataAbertura) - new Date(a.dataAbertura));
        this.renderTable(this.state.data);
    }

    handleItemSelect(rowElement, item) {
        super.handleItemSelect(rowElement, item);
        if (this.state.selectedItem) {
            this.header.updateButtons('only-back'); 
            this.renderDetails(item);
        } else {
            this.resetDetails();
        }
    }

    renderDetails(item) {
        this.detailContainer.innerHTML = '';
        this.detailContainer.classList.remove('centered', 'padded');
        const statusColor = item.status === 'Aberto' ? 'var(--status-error)' : 'var(--status-success)';
        const sectorDisplay = this.getFormattedSector(item.setor);

        const content = `
            <div class="detail-grid animate-fade">
                <div class="detail-full" style="margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; display:flex; justify-content:space-between; align-items:center;">
                    <div style="font-size: 18px; font-weight: bold; color: var(--brand-primary);">
                        O.S. #${item.id}
                    </div>
                    <span class="status-badge" style="background-color: ${statusColor}">${item.status}</span>
                </div>

                <div class="detail-item">
                    <label>Equipamento</label>
                    <div>${item.equipamentoName}</div>
                </div>
                <div class="detail-item">
                    <label>Sala</label>
                    <div>${item.equipamentoSala}</div>
                </div>
                
                <div class="detail-item detail-full">
                    <label>Setor</label>
                    <div>${sectorDisplay}</div>
                </div>
                
                <div class="detail-item detail-full">
                    <label>Descrição</label>
                    <div>${item.descricao}</div>
                </div>

                <div class="detail-item">
                    <label>Abertura</label>
                    <div>${new Date(item.dataAbertura).toLocaleString('pt-BR')}</div>
                </div>
                
                ${item.dataFechamento ? `
                <div class="detail-item detail-full">
                    <label>Solução Técnica</label>
                    <div style="border-color: var(--status-success); color: var(--status-success); background-color: #f0fff4;">
                        ${item.solucao}<br>
                        <small style="color:#666; margin-top:5px; display:block;">Encerrado em: ${new Date(item.dataFechamento).toLocaleString('pt-BR')}</small>
                    </div>
                </div>` : ''}
                
                <div style="height: 50px; width: 100%;"></div>
            </div>
        `;
        this.detailContainer.innerHTML = content;
    }

    resetDetails() {
        this.detailContainer.innerHTML = '<div style="color:#888;">Selecione um chamado para ver o andamento.</div>';
        this.detailContainer.classList.add('centered', 'padded');
    }
}

new UserPanelPage().init();
==================================================
CAMINHO: .\js\pages\usuarios.js
==================================================
/* js/pages/usuarios.js */
import { BaseListPage } from '../core/BaseListPage.js';
import { UsuariosService } from '../services/usuarios.service.js';
import { USERS_TABLE_CONFIG } from '../config/usuarios.config.js';
import { setupInputMasks } from '../components/inputs.js';
import { ROUTES } from '../services/navigation.service.js';
import { AuthService } from '../services/auth.service.js';
import { showToast } from '../components/toast.js';

class UsuariosPage extends BaseListPage {
    constructor() {
        super({
            listElementId: 'users-list',
            emptyStateId: 'empty-state',
            service: UsuariosService,
            tableConfig: USERS_TABLE_CONFIG,
            pageName: 'users',
            addPageUrl: ROUTES.USERS_FORM,
            deleteMessageFn: (item) => `Tem certeza que deseja excluir <strong>${item.nome}</strong>?`
        });
        
        this.currentUser = AuthService.getUser();
    }

    async init() {
        await super.init();
        setupInputMasks();
        // Não precisamos mais chamar applySecurityPatch aqui
    }

    // --- OTIMIZAÇÃO: Sobrescrita Limpa (Override) ---
    
    // O Pai (BaseListPage) chama este método automaticamente quando clicam em "Editar"
    handleEdit(item) {
        // 1. Verificação de Segurança
        if (!this.checkPermission(item)) {
            return; // Se não tiver permissão, para aqui. Não navega.
        }

        // 2. Se passou na segurança, chama o comportamento padrão do pai (Navegar)
        super.handleEdit(item);
    }

    // O Pai chama este método automaticamente quando clicam em "Excluir"
    handleDelete(item) {
        // 1. Verificação de Segurança
        if (!this.checkPermission(item)) {
            return;
        }

        // 2. Se passou, chama o comportamento padrão do pai (Modal de confirmação + Exclusão)
        super.handleDelete(item);
    }

    // --- LÓGICA DE NEGÓCIO (Permissões) ---
    checkPermission(targetUser) {
        if (!this.currentUser) return false;

        const myRole = (this.currentUser.tipo || '').toLowerCase();
        const targetRole = (targetUser.tipo || '').toLowerCase();
        
        // Admin pode tudo
        if (myRole.includes('admin')) return true;

        // Técnico só mexe em usuários comuns
        if (myRole.includes('técnico') || myRole.includes('tecnico')) {
            if (targetRole.includes('usuário') || targetRole.includes('comum')) {
                return true;
            }
            showToast('Acesso Negado: Técnicos gerenciam apenas Usuários Comuns.', 'error');
            return false;
        }

        return false;
    }
}

new UsuariosPage().init();
==================================================
CAMINHO: .\js\services\auth.service.js
==================================================
/* js/services/auth.service.js */
import { ROUTES, NavigationService } from './navigation.service.js';
import { STORAGE_KEYS } from '../config/constants.js';
import { HttpClient } from '../core/HttpClient.js'; 

class AuthServiceClass {
    constructor() {
        this.http = new HttpClient('auth'); 
        this.tokenKey = STORAGE_KEYS.TOKEN;
        this.userKey = STORAGE_KEYS.USER;
    }

    async login(cpf, password) {
        try {
            // Chama a API (Real ou Mock)
            const response = await this.http.login({ cpf, password });
            
            if (response.token && response.user) {
                localStorage.setItem(this.tokenKey, response.token);
                localStorage.setItem(this.userKey, JSON.stringify(response.user));

                // --- CORREÇÃO: REGISTRAR LOG MANUALMENTE ---
                // Num backend real, o servidor faria isso. No Mock, fazemos aqui.
                // Usamos import dinâmico para evitar Travamento Cíclico (Auth <-> Log)
                try {
                    const { LogService } = await import('./log.service.js');
                    await LogService.add('LOGIN', 'Sistema', `Usuário ${response.user.nome} entrou.`);
                } catch (e) {
                    console.warn('Não foi possível registrar o log de login:', e);
                }
                
                // Redirecionamento
                const tipo = response.user.tipo.toLowerCase();
                if (tipo.includes('usuário') || tipo.includes('comum')) {
                    window.location.href = ROUTES.USER_PANEL;
                } else {
                    return true; 
                }
            }
        } catch (error) {
            console.error(error);
            throw new Error('CPF ou Senha inválidos.');
        }
    }

    getUser() {
        const data = localStorage.getItem(this.userKey);
        return data ? JSON.parse(data) : null;
    }

    isAuthenticated() {
        return !!localStorage.getItem(this.tokenKey);
    }
    
    logout() {
        localStorage.removeItem(this.tokenKey);
        localStorage.removeItem(this.userKey);
        NavigationService.navigate(ROUTES.LOGIN);
    }
}

export const AuthService = new AuthServiceClass();
==================================================
CAMINHO: .\js\services\equipamento.service.js
==================================================
/* js/services/equipamento.service.js */
import { BaseService } from '../core/BaseService.js';
import { MockDatabase } from '../core/MockDatabase.js';
import { APP_CONFIG } from '../config/constants.js'; // Importante para verificar o modo

class EquipamentoServiceClass extends BaseService {
    constructor() {
        super('equipments', 'Equipamento');
    }

    // --- LEITURA HIDRATADA (JOIN) ---
    async getAll() {
        // SE FOR API REAL: O Backend já deve retornar os dados com joins feitos (DTO)
        if (!APP_CONFIG.USE_MOCK_DATA) {
            return this.http.get();
        }

        // --- LÓGICA DO MOCK (JOIN MANUAL) ---
        const equips = await MockDatabase.get('equipments');
        const sectors = await MockDatabase.get('sectors');
        const users = await MockDatabase.get('users');

        const hydratedData = equips.map(eq => {
            const sec = sectors.find(s => String(s.id) === String(eq.id_setor));
            
            // Resolve Usuário
            let userName = eq.usuario || '-'; 
            if (eq.id_usuario) {
                const u = users.find(user => String(user.id) === String(eq.id_usuario));
                if (u) userName = u.nome;
            }

            return {
                ...eq,
                // Nome para exibir na tabela
                setor: sec ? sec.nome : 'N/A',
                // Nome do usuário resolvido
                usuario: userName,
                
                // IDs mantidos para formulários
                id_setor: eq.id_setor,
                id_usuario: eq.id_usuario
            };
        });

        // Ordenação (Computadores primeiro)
        return hydratedData.sort((a, b) => {
            if (a.tipo === b.tipo) return 0;
            return a.tipo === 'computador' ? -1 : 1;
        });
    }

    // --- ESCRITA ---
    async add(data) {
        return await this.save(data); // Usa o método save do BaseService
    }

    async update(id, data) {
        // Garante que o ID esteja no objeto para o save() identificar que é update
        return await this.save({ ...data, id });
    }

    // --- FILTROS ---
    async getBySector(sectorName) {
        const data = await this.getAll();
        return data.filter(e => e.setor === sectorName);
    }

    async getPrintersByParentId(parentId) {
        const data = await this.getAll();
        return data.filter(e => e.tipo === 'impressora' && String(e.connectedTo) === String(parentId));
    }

    // --- HISTÓRICO DE ERROS ---
    async getErrorHistory(equipId) {
        // Se for API Real, chamaria algo como /api/equipments/{id}/errors
        if (!APP_CONFIG.USE_MOCK_DATA) {
            return this.http.http.get(`${this.endpoint}/${equipId}/errors`); 
            // Nota: Acessei this.http.http porque o wrapper BaseService encapsula o HttpClient
            // Mas idealmente o HttpClient teria um método request genérico.
            // Para simplificar aqui, vamos assumir que o MockDatabase lida com isso.
        }

        const allErrors = await MockDatabase.get('log_erros');
        
        return allErrors.filter(err => 
            String(err.id_computador) === String(equipId) || 
            String(err.id_impressora) === String(equipId)
        ).sort((a, b) => new Date(b.data_hora) - new Date(a.data_hora));
    }

    // --- VERIFICAÇÕES DE INTEGRIDADE ---
    async checkDependencies(id) {
        const childPrinters = await this.getPrintersByParentId(id);
        
        if (childPrinters.length > 0) {
            return {
                allowed: false,
                message: `Possui ${childPrinters.length} impressora(s) conectada(s).`
            };
        }

        // Import dinâmico para evitar dependência circular
        const { OsService } = await import('./os.service.js');
        const allOs = await OsService.getAll();
        
        const hasOpenOs = allOs.some(os => 
            (String(os.id_computador) === String(id) || String(os.id_impressora) === String(id)) 
            && os.status === 'Aberto'
        );

        if (hasOpenOs) {
            return {
                allowed: false,
                message: 'Existe O.S. ABERTA para este equipamento.'
            };
        }

        return { allowed: true };
    }
}

export const EquipamentoService = new EquipamentoServiceClass();
==================================================
CAMINHO: .\js\services\error_log.service.js
==================================================
/* js/services/error_log.service.js */
import { BaseService } from '../core/BaseService.js';
import { MockDatabase } from '../core/MockDatabase.js';
import { APP_CONFIG } from '../config/constants.js';

class ErrorLogServiceClass extends BaseService {
    constructor() {
        super('log_erros', 'Log de Erros');
    }

    async getActiveErrors() {
        if (!APP_CONFIG.USE_MOCK_DATA) {
            // API Real: GET /api/log_erros?active=true (Exemplo)
            // Aqui assumimos que o getAll da API já retorna o necessário ou filtramos depois
            const errors = await this.http.get(); 
            return errors.filter(e => e.resolvido === false); // Filtro no cliente por garantia
        }

        // --- LÓGICA DO MOCK ---
        const errors = await MockDatabase.get('log_erros');
        const equipments = await MockDatabase.get('equipments');

        // 1. Filtra apenas NÃO RESOLVIDOS
        const activeErrors = errors.filter(e => e.resolvido === false);

        // 2. Hidratação (Join)
        const enriched = activeErrors.map(err => {
            const equipId = err.id_computador || err.id_impressora;
            const equip = equipments.find(e => String(e.id) === String(equipId));

            return {
                ...err,
                equipamentoNome: equip ? `${equip.tipo.toUpperCase()} - ${equip.modelo}` : 'Desconhecido',
                equipamentoSala: equip ? equip.sala : '-',
                id_equipamento_alvo: equipId
            };
        });

        // 3. Ordenação (Crítico > Alerta > Info)
        const priority = { 'Crítico': 0, 'Alerta': 1, 'Info': 2 };
        
        return enriched.sort((a, b) => {
            const pA = priority[a.severidade] !== undefined ? priority[a.severidade] : 99;
            const pB = priority[b.severidade] !== undefined ? priority[b.severidade] : 99;
            
            if (pA === pB) {
                return new Date(b.data_hora) - new Date(a.data_hora);
            }
            return pA - pB;
        });
    }

    // --- NOVO MÉTODO CENTRALIZADO ---
    async resolveError(id) {
        if (APP_CONFIG.USE_MOCK_DATA) {
            // Lógica Mock: Atualiza LocalStorage
            const errors = await MockDatabase.get('log_erros');
            const index = errors.findIndex(e => String(e.id) === String(id));
            if (index !== -1) {
                errors[index].resolvido = true;
                localStorage.setItem('app_log_erros', JSON.stringify(errors));
                
                // Opcional: Logar auditoria
                this._logAction('UPDATE', `Erro #${id} marcado como resolvido manualmente.`);
                return true;
            }
            return false;
        } else {
            // Lógica API Real: PUT /api/log_erros/{id}/resolve
            // O BaseService não tem um método customizado genérico, então usamos o put parcial ou endpoint específico
            // Aqui simulamos um update parcial enviando apenas o campo resolvido
            return await this.save({ id, resolvido: true });
        }
    }
}

export const ErrorLogService = new ErrorLogServiceClass();
==================================================
CAMINHO: .\js\services\log.service.js
==================================================
/* js/services/log.service.js */
import { BaseService } from '../core/BaseService.js';
import { AuthService } from './auth.service.js';

class LogServiceClass extends BaseService {
    constructor() {
        super('logs', null); 
    }

    async add(action, resource, details) {
        const currentUser = AuthService.getUser();
        
        // Dados para salvar
        const userName = currentUser && currentUser.nome ? currentUser.nome : 'Sistema';
        const userId = currentUser && currentUser.id ? currentUser.id : null;

        const logEntry = {
            data_hora: new Date().toISOString(), // SQL: data_hora
            
            // Campos de Texto
            acao: action,       // SQL: acao
            recurso: resource,  // SQL: recurso
            detalhes: details,  // SQL: detalhes
            
            // Dados do Usuário (Para preencher a tabela corretamente)
            usuario_nome: userName, // SQL: usuario_nome
            id_usuario: userId      // SQL: id_usuario (Foreign Key)
        };

        await this.save(logEntry);
    }

    async getRecent() {
        const logs = await this.getAll();
        // Mapeia data_hora (SQL) para date (Frontend) se necessário, ou ajusta o config
        return logs.map(l => ({
            ...l,
            date: l.data_hora, 
            user: l.usuario_nome,
            action: l.acao,
            resource: l.recurso,
            details: l.detalhes
        })).sort((a, b) => new Date(b.date) - new Date(a.date));
    }
}

export const LogService = new LogServiceClass();
==================================================
CAMINHO: .\js\services\navigation.service.js
==================================================
/* js/services/navigation.service.js */
import { ROUTES } from '../config/constants.js';

export { ROUTES };

export const NavigationService = {
    navigate(url, params = null) {
        if (!params) {
            window.location.href = url;
            return;
        }
        const queryString = new URLSearchParams(params).toString();
        window.location.href = `${url}?${queryString}`;
    },

    reload() {
        window.location.reload();
    },

    getQueryParam(key) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(key);
    },

    // --- CORREÇÃO DEFINITIVA ---
    isCurrentPage(route) {
        if (!route) return false;
        
        // Pega apenas o nome do arquivo da URL atual (ex: "usuarios.html")
        const currentFile = window.location.pathname.split('/').pop();
        
        // Pega apenas o nome do arquivo da rota desejada
        // (Isso previne que "/pages/os.html" seja confundido se a rota for só "os.html")
        const routeFile = route.split('/').pop();

        // Comparação exata
        return currentFile === routeFile;
    }
};
==================================================
CAMINHO: .\js\services\os.service.js
==================================================
/* js/services/os.service.js */
import { BaseService } from '../core/BaseService.js';
import { MockDatabase } from '../core/MockDatabase.js';
import { AuthService } from './auth.service.js';
import { APP_CONFIG } from '../config/constants.js'; // Importante para checar o modo

class OsServiceClass extends BaseService {
    constructor() {
        super('os', 'Ordem de Serviço');
    }

    // --- LEITURA HIDRATADA (JOIN) ---
    async getAll() {
        // SE FOR API REAL: O Backend já deve retornar os dados com joins feitos (DTO)
        if (!APP_CONFIG.USE_MOCK_DATA) {
            return this.http.get();
        }

        // --- LÓGICA DO MOCK (JOIN MANUAL) ---
        const osList = await MockDatabase.get('os');
        const sectors = await MockDatabase.get('sectors');
        const equipments = await MockDatabase.get('equipments');
        const users = await MockDatabase.get('users');

        return osList.map(os => {
            // 1. Resolver Setor
            const sec = sectors.find(s => String(s.id) === String(os.id_setor));
            
            // 2. Resolver Equipamento
            const equipId = os.id_computador || os.id_impressora || os.equipamentoId;
            const equip = equipments.find(e => String(e.id) === String(equipId));
            
            // 3. RESOLVER SOLICITANTE (Quem pediu a O.S.)
            const solUser = users.find(u => String(u.id) === String(os.id_usuario_solicitante));
            const nomeSolicitante = solUser ? solUser.nome : (os.solicitante || 'Usuário Desconhecido');

            // 4. RESOLVER RESPONSÁVEL (Técnico que está atendendo)
            const tecUser = users.find(u => String(u.id) === String(os.id_usuario_responsavel));
            const nomeTecnico = tecUser ? tecUser.nome : '-';

            return {
                ...os,
                id: os.id,
                
                // Colunas da Tabela
                setor: sec ? sec.nome : 'N/A',
                equipamentoName: equip 
                    ? `${equip.tipo === 'computador' ? 'PC' : 'IMP'} - ${equip.modelo}` 
                    : (os.equipamentoName || 'Genérico'),
                
                equipamentoSala: equip && equip.sala ? equip.sala : '-',
                descricao: os.descricao_problema || os.descricao,
                
                solicitante: nomeSolicitante,
                responsavel: nomeTecnico,
                
                dataAbertura: os.data_abertura || os.dataAbertura,
                dataFechamento: os.data_fechamento || os.dataFechamento,
                
                status: os.status,
                solucao: os.solucao
            };
        });
    }

    // --- ESCRITA ---
    async add(osData) {
        const payload = {
            ...osData,
            descricao_problema: osData.descricao,
            data_abertura: osData.dataAbertura,
            status: 'Aberto',
            
            // IDs
            id_setor: osData.id_setor,
            id_usuario_solicitante: osData.id_usuario_solicitante,
            id_usuario_responsavel: null, // Nova OS começa sem técnico
            
            id_computador: osData.id_computador,
            id_impressora: osData.id_impressora
        };
        
        // CORREÇÃO: Usa this.save() para abstrair Mock/API
        return await this.save(payload);
    }

    async update(id, osData) {
        const payload = { ...osData };
        
        if(osData.descricao) payload.descricao_problema = osData.descricao;
        if(osData.dataAbertura) payload.data_abertura = osData.dataAbertura;
        if(osData.dataFechamento) payload.data_fechamento = osData.dataFechamento;
        
        if(osData.id_usuario_responsavel !== undefined) {
            payload.id_usuario_responsavel = osData.id_usuario_responsavel;
        }

        // CORREÇÃO: Usa this.save() e garante o ID no objeto
        return await this.save({ ...payload, id });
    }

    async toggleStatus(id) {
        const item = await this.getById(id);
        if (!item) return null;
        
        const novoStatus = item.status === 'Aberto' ? 'Fechado' : 'Aberto';
        const closeDate = novoStatus === 'Fechado' ? new Date().toISOString() : null;
        
        let updateData = {
            status: novoStatus, 
            data_fechamento: closeDate
        };

        // Lógica: Ao FECHAR, o usuário logado vira o RESPONSÁVEL (se já não tiver um)
        if (novoStatus === 'Fechado') {
            const currentUser = AuthService.getUser();
            updateData.solucao = `Concluído por ${currentUser ? currentUser.nome : 'Sistema'}.`;
            
            if (!item.id_usuario_responsavel && currentUser) {
                updateData.id_usuario_responsavel = currentUser.id;
            }
        } else {
            updateData.solucao = ''; 
        }

        await this.update(id, updateData);
        return { ...item, ...updateData };
    }

    async getByUser(userIdOrName) {
        const all = await this.getAll();
        // Filtra onde o usuário é o solicitante OU o responsável
        return all.filter(os => 
            String(os.id_usuario_solicitante) === String(userIdOrName) || 
            String(os.id_usuario_responsavel) === String(userIdOrName) ||
            os.solicitante === userIdOrName 
        );
    }
}

export const OsService = new OsServiceClass();
==================================================
CAMINHO: .\js\services\setor.service.js
==================================================
/* js/services/setor.service.js */
import { BaseService } from '../core/BaseService.js';
import { MockDatabase } from '../core/MockDatabase.js'; 
import { APP_CONFIG } from '../config/constants.js'; // Importante para checar o modo

class SetorServiceClass extends BaseService {
    constructor() { super('sectors', 'Setor'); }

    // --- LEITURA (JOIN) ---
    async getAll() {
        // SE FOR API REAL: Retorna direto (Backend deve entregar o DTO hidratado)
        if (!APP_CONFIG.USE_MOCK_DATA) {
            return this.http.get();
        }

        // --- LÓGICA DO MOCK (JOIN MANUAL) ---
        const sectors = await MockDatabase.get('sectors');
        const companies = await MockDatabase.get('companies');
        const cities = await MockDatabase.get('cities');

        return sectors.map(sec => {
            const comp = companies.find(c => String(c.id) === String(sec.id_empresa));
            const city = comp ? cities.find(c => String(c.id) === String(comp.id_cidade)) : null;

            return {
                ...sec,
                nome_empresa: comp ? comp.nome : 'N/A',
                nome_cidade: city ? city.nome : 'N/A',
                // Compatibilidade com componentes que esperam 'empresa' e 'cidade' como nomes
                empresa: comp ? comp.nome : 'N/A',
                cidade: city ? city.nome : 'N/A'
            };
        });
    }

    // --- HELPERS E DROPDOWNS ---
    // (Estes métodos auxiliares continuam lendo do Mock por enquanto, 
    // pois não temos Services dedicados para Cidades/Empresas ainda)
    
    async getCitiesForDropdown() { return await MockDatabase.get('cities'); }

    async getCompaniesByCityId(cityId) {
        const comps = await MockDatabase.get('companies');
        return comps.filter(c => String(c.id_cidade) === String(cityId));
    }

    async getUniqueCities() { 
        const cities = await MockDatabase.get('cities');
        return cities.map(c => c.nome);
    }

    async getCitiesFull() { 
        const cities = await MockDatabase.get('cities');
        return cities.map(c => ({
            ...c,
            uf: c.estado || c.uf 
        }));
    }
    
    async getCompaniesFull() {
        const comps = await MockDatabase.get('companies');
        const cities = await MockDatabase.get('cities');
        return comps.map(c => {
            const city = cities.find(ct => String(ct.id) === String(c.id_cidade));
            return { ...c, cidade_vinculada: city ? city.nome : '?' };
        });
    }

    // --- ESCRITA (IDS) ---

    async add(data) {
        // Prepara o payload correto para o Backend/Mock
        const payload = {
            nome: data.nome,
            localizacao: data.localizacao,
            observacao: data.observacao,
            id_empresa: data.empresa // Mapeia o select 'empresa' para 'id_empresa'
        };
        // Usa o save do BaseService para abstrair a chamada
        return await this.save(payload);
    }

    async update(id, data) {
        const payload = {
            nome: data.nome,
            localizacao: data.localizacao,
            observacao: data.observacao,
            id_empresa: data.empresa
        };
        // Usa o save do BaseService (com ID, ele entende que é PUT)
        return await this.save({ ...payload, id });
    }

    // --- DELETES ---
    async delete(id) { 
        // Usa o delete do BaseService (que trata API ou Mock)
        return await super.delete(id); 
    }

    // --- MÉTODOS AUXILIARES DE GERENCIAMENTO (MANTIDOS NO MOCK POR ENQUANTO) ---
    // Em um cenário real completo, teríamos CityService e CompanyService.
    
    async addCity(data) {
        return await MockDatabase.post('cities', { 
            nome: data.nome, 
            estado: data.uf || data.estado 
        });
    }

    async updateCity(id, nome, uf) {
        return await MockDatabase.put('cities', id, { nome: nome, estado: uf });
    }

    async addCompany(data) {
        return await MockDatabase.post('companies', {
            nome: data.nome,
            cnpj: data.cnpj,
            descricao: data.descricao,
            observacao: data.observacao,
            id_cidade: data.cidade_vinculada
        });
    }

    async updateCompany(id, dataObj) {
        return await MockDatabase.put('companies', id, dataObj);
    }
    
    async deleteCity(id) {
        await MockDatabase.delete('cities', id);
        // Em um backend real, o CASCADE do banco faria isso. No Mock fazemos manual.
        const companies = await MockDatabase.get('companies');
        const toDelete = companies.filter(c => String(c.id_cidade) === String(id));
        for (const c of toDelete) await this.deleteCompany(c.id);
    }

    async deleteCompany(id) {
        await MockDatabase.delete('companies', id);
        const sectors = await MockDatabase.get('sectors');
        const toDelete = sectors.filter(s => String(s.id_empresa) === String(id));
        for (const s of toDelete) await MockDatabase.delete('sectors', s.id);
    }

    // --- ÁRVORE (SIDEBAR) ---
    async getTreeStructure() {
        // Nota: Idealmente o backend teria um endpoint /tree structure
        // Por enquanto, montamos manualmente com os dados disponíveis
        const cities = await MockDatabase.get('cities');
        const companies = await MockDatabase.get('companies');
        const sectors = await this.getAll(); // Usa o getAll (que pode vir da API)

        const tree = [];
        cities.forEach(city => tree.push({ name: city.nome, children: [] }));

        companies.forEach(comp => {
            const cityOwner = cities.find(c => String(c.id) === String(comp.id_cidade));
            if (cityOwner) {
                const cityNode = tree.find(n => n.name === cityOwner.nome);
                if (cityNode) cityNode.children.push({ name: comp.nome, children: [] });
            }
        });

        sectors.forEach(sec => {
            const cityNode = tree.find(n => n.name === sec.cidade);
            if (cityNode) {
                const compNode = cityNode.children.find(n => n.name === sec.empresa);
                if (compNode) compNode.children.push(sec.nome);
            }
        });
        return tree;
    }

    async getSectorsUnder(nodeName) {
        const tree = await this.getTreeStructure();
        const traverse = (nodes) => {
            for (const node of nodes) {
                if (typeof node === 'string') {
                    if (node === nodeName) return [node];
                } else {
                    if (node.name === nodeName) return this._collectAllLeaves(node);
                    if (node.children) {
                        const result = traverse(node.children);
                        if (result.length > 0) return result;
                    }
                }
            }
            return [];
        };
        return traverse(tree);
    }
    
    _collectAllLeaves(node) {
        let leaves = [];
        if (node.children) {
            node.children.forEach(child => {
                if (typeof child === 'string') leaves.push(child);
                else leaves = leaves.concat(this._collectAllLeaves(child));
            });
        }
        return leaves;
    }
}

export const SetorService = new SetorServiceClass();
==================================================
CAMINHO: .\js\services\usuarios.service.js
==================================================
/* js/services/usuarios.service.js */
import { BaseService } from '../core/BaseService.js';
import { EquipamentoService } from './equipamento.service.js';
import { MockDatabase } from '../core/MockDatabase.js';
import { APP_CONFIG } from '../config/constants.js'; // Importante para verificar o modo

class UsuariosServiceClass extends BaseService {
    constructor() {
        super('users', 'Usuário');
    }

    // --- LEITURA HIDRATADA (JOIN) ---
    async getAll() {
        // SE FOR API REAL: Retorna direto (Backend entrega DTO pronto)
        if (!APP_CONFIG.USE_MOCK_DATA) {
            return this.http.get();
        }

        // --- LÓGICA DO MOCK (JOIN MANUAL) ---
        const users = await MockDatabase.get('users');
        const sectors = await MockDatabase.get('sectors');

        return users.map(user => {
            // Busca o setor onde o ID bate
            const sectorObj = sectors.find(s => String(s.id) === String(user.id_setor));
            
            return {
                ...user,
                // Campo 'setor' vira o Nome (para a coluna da tabela)
                setor: sectorObj ? sectorObj.nome : 'N/A', 
                // Mantém 'id_setor' original para edição
                id_setor: user.id_setor
            };
        });
    }

    // --- ESCRITA (Padronizada via BaseService) ---
    
    async add(userData) {
        // Recebe { nome, cpf, senha, tipo, id_setor }
        // this.save lida com a decisão Mock vs API
        return await this.save(userData);
    }

    async update(id, userData) {
        // Garante envio do ID para ser tratado como PUT
        return await this.save({ ...userData, id });
    }

    // --- MANUTENÇÃO / FILTROS ---
    
    async getBySector(sectorName) {
        // Filtra os usuários que, após a hidratação, possuem esse nome de setor
        const all = await this.getAll();
        return all.filter(u => u.setor === sectorName);
    }

    // Verifica se pode excluir (Regra de Negócio)
    async checkDependencies(id) {
        const userToDelete = await this.getById(id);
        if (!userToDelete) return { allowed: true };

        const allEquipments = await EquipamentoService.getAll();
        
        // Verifica se existe algum equipamento vinculado a este usuário.
        // Checagem Híbrida:
        // 1. Pelo Nome (eq.usuario) -> Como o Mock atual funciona
        // 2. Pelo ID (eq.id_usuario) -> Como o Banco Relacional funciona
        const hasEquipment = allEquipments.some(eq => 
            eq.usuario === userToDelete.nome || 
            String(eq.id_usuario) === String(id)
        );

        if (hasEquipment) {
            return { 
                allowed: false, 
                message: 'Este usuário possui equipamentos vinculados. Transfira-os antes de excluir.' 
            };
        }
        
        return { allowed: true };
    }
}

export const UsuariosService = new UsuariosServiceClass();